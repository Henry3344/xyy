<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Survival English Guide v25.5</title>
    <style>
        /* --- V31.6 æ ·å¼è¡¨ï¼šå¼ºé˜»å°¼ + æœºå™¨äººæ°”æ³¡ --- */
        :root {
            --bg-body: #f2f2f7; --bg-card: #ffffff; --text-main: #1c1c1e; --text-sub: #8e8e93;
            --primary: #007aff; --primary-light: #e5f1ff; --border: #c6c6c8;
            --chip-bg: #ffffff; --chip-border: #d1d1d6; --nav-bg: rgba(255,255,255,0.95);
            --shadow: rgba(0,0,0,0.08); --display-area: #f2f2f7; --danger: #ff3b30; --accent: #5856d6;
            --hint-bg: rgba(255, 255, 255, 0.85);
        }
        [data-theme="dark"] {
            --bg-body: #000000; --bg-card: #1c1c1e; --text-main: #ffffff; --text-sub: #aeaeb2;
            --primary: #0a84ff; --primary-light: #1c1c1e; --border: #38383a; --chip-bg: #2c2c2e;
            --chip-border: #3a3a3c; --nav-bg: rgba(28,28,30,0.95); --shadow: rgba(255,255,255,0.05);
            --display-area: #2c2c2e; --danger: #ff453a; --accent: #5e5ce6;
            --hint-bg: rgba(28, 28, 30, 0.85);
        }

        html, body { height: 100%; overflow: hidden; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg-body); color: var(--text-main); display: flex; flex-direction: column; transition: background 0.3s; -webkit-tap-highlight-color: transparent; }
        
        .header-container { flex: 0 0 auto; background: var(--nav-bg); backdrop-filter: blur(15px); z-index: 1000; border-bottom: 1px solid var(--border); padding-top: env(safe-area-inset-top); }
        .top-row { display: flex; align-items: center; justify-content: space-between; padding: 10px 15px; max-width: 650px; margin: 0 auto; }
        .app-title { font-size: 1.1em; font-weight: 800; margin: 0; }
        .header-actions { display: flex; gap: 12px; }
        .icon-btn { background: none; border: 1px solid var(--border); color: var(--text-main); width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .icon-btn.danger { border-color: var(--danger); color: var(--danger); }
        .search-row { padding: 0 15px 8px 15px; max-width: 650px; margin: 0 auto; }
        .search-input { width: 100%; padding: 8px 12px; border-radius: 10px; border: 1px solid var(--border); background: var(--bg-body); color: var(--text-main); box-sizing: border-box; outline: none; transition: color 0.5s; }
        .search-input.fade-text { color: transparent; }
        .nav-scroll { display: flex; overflow-x: auto; padding: 0 15px 10px 15px; gap: 8px; max-width: 650px; margin: 0 auto; scrollbar-width: none; }
        .nav-scroll::-webkit-scrollbar { display: none; }
        .nav-btn { flex: 0 0 auto; background: var(--primary-light); color: var(--primary); padding: 5px 10px; border-radius: 14px; font-weight: 600; font-size: 0.8em; text-decoration: none; cursor: pointer; }
        [data-theme="dark"] .nav-btn { border: 1px solid var(--border); }
        .nav-btn.active-nav { background: var(--primary); color: white; }

        #content-area { flex: 1; display: flex; overflow-x: auto; scroll-snap-type: x mandatory; padding: 15px 0; gap: 15px; align-items: flex-start; scroll-behavior: smooth; }
        #content-area::-webkit-scrollbar { display: none; }
        .snap-spacer { flex: 0 0 7.5vw; } 
        
        /* æ ¸å¿ƒä¿®æ”¹ï¼šå¢åŠ  scroll-snap-stop: always å®ç°å¼ºé˜»å°¼ */
        .unit-card { 
            flex: 0 0 85vw; max-width: 500px; background: var(--bg-card); 
            border-radius: 20px; padding: 20px; box-shadow: 0 8px 30px var(--shadow); 
            border: 1px solid var(--border); 
            scroll-snap-align: center; 
            scroll-snap-stop: always; /* å…³é”®ï¼šå¼ºåˆ¶æ¯æ¬¡åªæ»‘ä¸€å¼  */
            height: 98%; max-height: 85vh; overflow-y: auto; position: relative; 
            padding-bottom: 60px; box-sizing: border-box; 
        }
        .unit-header { font-size: 1.3em; font-weight: 800; color: var(--primary); margin-bottom: 15px; border-bottom: 2px solid var(--display-area); padding-bottom: 10px; display: flex; justify-content: space-between; }
        .sort-rank { font-size: 0.6em; color: var(--text-sub); opacity: 0.5; }

        .step-container { margin-bottom: 20px; width: 100%; }
        .step-label { font-size: 0.75em; color: var(--text-sub); font-weight: 700; margin-bottom: 6px; display: block; text-transform: uppercase; }
        .pattern-box { font-family: "Menlo", monospace; color: #d63031; background: #ffeaea; padding: 2px 6px; border-radius: 4px; font-size: 1em; margin-left: 5px; border: 1px solid #ffcccc; display: inline-block; }
        [data-theme="dark"] .pattern-box { background: #3e1a1a; border-color: #5c1e1e; color: #ff6b6b; }

        .display-area { background-color: var(--display-area); padding: 12px; border-radius: 12px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; gap: 8px; border: 1px solid var(--border); width: 100%; box-sizing: border-box; }
        .text-content { flex-grow: 1; min-width: 0; margin-right: 4px; }
        .english-sentence { font-size: 1.2em; font-weight: 600; line-height: 1.25; color: var(--text-main); margin-bottom: 4px; white-space: normal; word-wrap: break-word; }
        .highlight { color: var(--primary); text-decoration: underline; text-decoration-thickness: 3px; cursor: pointer; }
        .translation { color: var(--text-sub); font-size: 0.9em; white-space: normal; }

        .action-group { display: flex; gap: 6px; flex-shrink: 0; align-items: center; }
        .btn-mini { width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1em; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); box-shadow: 0 1px 3px var(--shadow); transition: all 0.2s; }
        .btn-mini:active { transform: scale(0.92); }
        .btn-mini.listening { background: var(--danger); color: white; border-color: var(--danger); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255,59,48,0.4); } 70% { box-shadow: 0 0 0 6px rgba(255,59,48,0); } 100% { box-shadow: 0 0 0 0 rgba(255,59,48,0); } }

        .chips-container { display: flex; flex-wrap: wrap; gap: 8px; width: 100%; align-items: flex-start; }
        .chip { background: var(--chip-bg); border: 1px solid var(--chip-border); padding: 6px 12px; border-radius: 16px; font-size: 0.9em; cursor: pointer; font-weight: 600; color: var(--text-main); }
        .chip.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        .add-btn-wrapper { display: flex; flex-direction: column; align-items: center; position: relative; } 
        .add-chip-btn { border: 1px dashed var(--text-sub); background: transparent; padding: 6px 10px; color: var(--text-sub); }
        
        /* çº¢è‰²æ°”æ³¡ (å¡ç‰‡å†…) */
        .bubble-tip { 
            position: relative; display: block; margin-top: 10px; 
            background: var(--danger); color: white; padding: 8px 12px; border-radius: 8px; 
            font-size: 0.8em; font-weight: bold; 
            width: max-content; max-width: 200px; 
            white-space: normal; line-height: 1.3; text-align: center; 
            animation: popUp 0.3s ease-out; box-shadow: 0 4px 10px rgba(255, 59, 48, 0.4); 
            z-index: 200;
        }
        .bubble-tip::after { 
            content: ''; position: absolute; bottom: 100%; left: 50%; margin-left: -6px; 
            border-width: 6px; border-style: solid; 
            border-color: transparent transparent var(--danger) transparent; 
        }
        .bubble-tip.fade-out { opacity: 0; margin-top: 0; padding: 0; height: 0; overflow: hidden; transition: all 0.5s ease; }
        @keyframes popUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .scroll-hint { position: absolute; bottom: 0; left: 0; width: 100%; text-align: center; color: var(--primary); font-size: 0.85em; padding: 12px 0; background: var(--hint-bg); backdrop-filter: blur(8px); border-radius: 0 0 20px 20px; opacity: 0; pointer-events: none; z-index: 50; transition: opacity 0.3s; font-weight: bold; }
        .scroll-hint.visible { opacity: 1; animation: float-hint 2s ease-in-out infinite; }
        @keyframes float-hint { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(5px); } }

        .divider { height: 1px; background: var(--border); margin: 20px 0; border: none; }
        .combo-box { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 15px; border-radius: 16px; margin-top: 20px; position: relative; }
        .combo-title { font-size: 0.8em; font-weight: bold; opacity: 0.8; margin-bottom: 8px; display: flex; justify-content: space-between; }
        .combo-text { padding-right: 40px; font-weight: 600; margin-bottom: 10px; line-height: 1.4; }
        .combo-audio-btn { position: absolute; top: 15px; right: 15px; background: #27ae60; border: none; color: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.1em; cursor: pointer; }

        /* æ‚¬æµ®çƒåŒºåŸŸ */
        .float-controls { position: fixed; bottom: 40px; right: 20px; display: flex; flex-direction: column; gap: 15px; z-index: 2000; align-items: flex-end; }
        .fab-btn, .fab-quiz, .fab-random, .fab-robot, .fab-tools { width: 42px; height: 42px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.3em; border: none; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.2); position: relative; }
        .fab-quiz { background: var(--danger); color: white; width: auto; padding: 8px 16px; border-radius: 30px; font-size: 0.85em; }
        .fab-random { background: var(--accent); color: white; }
        
        .fab-robot { background: #000; color: white; border: 2px solid #00ff00; }
        /* æœºå™¨äººæ°”æ³¡ï¼šæŒ‡å‘å³ä¾§çš„æœºå™¨äºº */
        .robot-speech-bubble {
            position: absolute; bottom: 0; right: 55px; /* åœ¨æœºå™¨äººå·¦ä¾§ */
            background: var(--bg-card); border: 1px solid var(--border); color: var(--text-main);
            padding: 8px 12px; border-radius: 12px 12px 0 12px; 
            font-size: 0.85em; font-weight: bold; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            width: max-content; max-width: 160px;
            opacity: 0; transform: translateX(10px); transition: all 0.3s ease; pointer-events: none;
        }
        .robot-speech-bubble.visible { opacity: 1; transform: translateX(0); }
        /* ç®­å¤´æŒ‡å‘å³è¾¹ */
        .robot-speech-bubble::after {
            content: ''; position: absolute; bottom: 10px; right: -6px;
            border-width: 6px; border-style: solid; 
            border-color: transparent transparent transparent var(--bg-card); /* æŒ‡å‘å³ */
        }
        /* å¤œé—´æ¨¡å¼é€‚é…ç®­å¤´ */
        [data-theme="dark"] .robot-speech-bubble::after { border-left-color: var(--bg-card); }

        .robot-badge { position: absolute; top: -5px; right: -5px; width: 12px; height: 12px; background: #ff3b30; border-radius: 50%; border: 2px solid #fff; display: none; }
        .fab-tools { background: #ff9f0a; color: white; }

        .quiz-active-text, body.quiz-mode .quiz-default-text { display: none; }
        body.quiz-mode .quiz-active-text { display: inline; }
        body.quiz-mode .english-sentence { color: transparent !important; text-shadow: 0 0 13px rgba(128,128,128,0.5); user-select: none; }
        body.quiz-mode .english-sentence:active { color: var(--text-main) !important; text-shadow: none; }
        body.quiz-mode .pattern-box { color: transparent !important; background-color: var(--border); }
        body.quiz-mode .pattern-box:active { color: #d63031 !important; background-color: #ffeaea; }
        body.quiz-mode .combo-text { color: transparent !important; text-shadow: 0 0 10px rgba(255,255,255,0.5); }
        body.quiz-mode .combo-text:active { color: white !important; text-shadow: none; }

        .emergency-overlay, .modal-overlay, .show-card-overlay, .tool-overlay, .chat-overlay { display: none; }
        .emergency-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; flex-direction: column; padding: 20px; box-sizing: border-box; }
        .emergency-overlay.active { display: flex; }
        .emergency-close { position: absolute; top: 20px; right: 20px; color: white; font-size: 2em; cursor: pointer; }
        .emergency-card { flex: 1; display: flex; align-items: center; justify-content: center; text-align: center; border-bottom: 1px solid #333; cursor: pointer; }
        .emergency-text { font-size: 2.2em; color: #ff3b30; font-weight: bold; margin-bottom: 10px; }
        .emergency-sub { font-size: 1.2em; color: #aaa; }

        .chat-overlay { position: fixed; bottom: 90px; right: 20px; width: 85vw; max-width: 350px; height: 60vh; background: var(--bg-card); border-radius: 20px; box-shadow: 0 5px 30px rgba(0,0,0,0.3); flex-direction: column; z-index: 9999; border: 1px solid var(--border); overflow: hidden; }
        .chat-header { padding: 12px 15px; background: var(--bg-body); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; font-weight: bold; align-items: center; }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: var(--bg-body); }
        .chat-footer { padding: 10px; border-top: 1px solid var(--border); background: var(--bg-card); display: flex; gap: 10px; justify-content: center; }
        .msg { max-width: 85%; padding: 8px 12px; border-radius: 12px; font-size: 0.9em; line-height: 1.4; }
        .msg.bot { align-self: flex-start; background: var(--bg-card); border: 1px solid var(--border); }
        .msg.user { align-self: flex-end; background: var(--primary); color: white; }
        .msg-btn-group { display: flex; flex-wrap: wrap; gap: 5px; }
        .msg-chip { background: var(--primary-light); color: var(--primary); padding: 5px 10px; border-radius: 15px; font-size: 0.8em; cursor: pointer; }
        .mic-wave { width: 45px; height: 45px; border-radius: 50%; background: var(--danger); color: white; border: none; font-size: 1.2em; display: flex; align-items: center; justify-content: center; }
        .mic-wave.active { animation: pulse 1.5s infinite; }

        .show-card-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-body); z-index: 10000; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        .show-card-text { font-size: 3em; font-weight: 800; line-height: 1.2; margin-bottom: 15px; word-wrap: break-word; }
        .show-card-sub { font-size: 1.5em; color: var(--text-sub); }
        .show-card-hint { position: absolute; bottom: 30px; opacity: 0.5; font-size: 0.8em; }

        .tool-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: flex-end; justify-content: center; }
        .tool-card { background: var(--bg-card); width: 100%; max-width: 500px; border-radius: 20px 20px 0 0; padding: 25px; box-sizing: border-box; }
        .tool-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .tool-tab { flex: 1; text-align: center; padding: 8px; font-weight: bold; color: var(--text-sub); cursor: pointer; }
        .tool-tab.active { background: var(--primary-light); color: var(--primary); border-radius: 8px; }
        .tool-section { display: none; }
        .tool-section.active { display: block; }
        .calc-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; gap: 10px; }
        .calc-input { width: 80px; padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--display-area); color: var(--text-main); text-align: center; font-weight: bold; }
        .tip-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 15px; }
        .tip-box { background: var(--display-area); padding: 10px; border-radius: 10px; text-align: center; border: 1px solid var(--border); }
        .tip-val { font-size: 1.1em; font-weight: 800; color: var(--primary); display: block; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 5000; align-items: center; justify-content: center; }
        .modal-card { background: var(--bg-card); width: 85%; max-width: 400px; padding: 25px; border-radius: 20px; text-align: center; border: 1px solid var(--border); }
        .modal-title { font-size: 1.2em; font-weight: bold; margin-bottom: 20px; }
        .modal-actions { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
        .modal-btn { padding: 8px 16px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; }
        .btn-reveal { background: var(--primary); color: white; }
        .btn-close { background: var(--border); color: var(--text-main); }
        .speech-result-toast { position: fixed; top: 20%; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 20px; font-size: 0.9em; z-index: 11000; display: none; text-align: center; max-width: 80%; }

        .fixed-footer { flex: 0 0 auto; text-align: center; color: var(--text-sub); font-size: 0.6em; padding: 3px 0; border-top: 1px solid var(--border); background: var(--bg-body); opacity: 0.5; }
    </style>

</head>
<body>

    <div class="header-container" id="mainHeader">
        <div class="top-row">
            <div class="app-title">ğŸ‡ºğŸ‡¸ Survival English Guide</div>
            <div class="header-actions">
                <button class="icon-btn danger" onclick="toggleEmergency()" title="åº”æ€¥æ¨¡å¼">âš¡</button>
                <button class="icon-btn" onclick="toggleTheme()" title="åˆ‡æ¢æ¨¡å¼">ğŸŒ—</button>
            </div>
        </div>
        
        <div class="search-row">
            <input type="text" class="search-input" id="searchBox" placeholder="ğŸ” æœç´¢åœºæ™¯ (å¦‚: é€€è´§, coffee...)" onkeyup="filterUnits()">
        </div>

        <div class="nav-scroll">
            <a onclick="scrollToUnit('u1')" class="nav-btn">é‚»å±…</a>
            <a onclick="scrollToUnit('u2')" class="nav-btn">ä½ç½®</a>
            <a onclick="scrollToUnit('u3')" class="nav-btn">æ´—æ‰‹é—´</a>
            <a onclick="scrollToUnit('u4')" class="nav-btn">é“¶è¡Œ</a>
            <a onclick="scrollToUnit('u5')" class="nav-btn">ç»“è´¦</a>
            <a onclick="scrollToUnit('u6')" class="nav-btn">ç‚¹é¤</a>
            <a onclick="scrollToUnit('u7')" class="nav-btn">èšé¤</a>
            <a onclick="scrollToUnit('u8')" class="nav-btn">å™æ—§</a>
            <a onclick="scrollToUnit('u9')" class="nav-btn">æ‰“è½¦</a>
            <a onclick="scrollToUnit('u10')" class="nav-btn">æ€¥æ•‘</a>
            <a onclick="scrollToUnit('u11')" class="nav-btn">æ²¡å¬æ‡‚</a>
            <a onclick="scrollToUnit('u12')" class="nav-btn">é€€è´§</a>
            <a onclick="scrollToUnit('u13')" class="nav-btn">é¢„çº¦</a>
        </div>
    </div>

    <div class="emergency-overlay" id="emergencyOverlay">
        <div class="emergency-close" onclick="toggleEmergency()">âœ•</div>
        <div class="emergency-card" onclick="speakDirect('I need help! Please call 911.')">
            <div>
                <div class="emergency-text" style="color: #ff3b30;">I NEED HELP!<br>CALL 911</div>
                <div class="emergency-sub">æ•‘å‘½ï¼è¯·æ‰“911</div>
            </div>
        </div>
        <div class="emergency-card" onclick="speakDirect('I do not speak English. Please use a translation app.')">
            <div>
                <div class="emergency-text">I DON'T SPEAK ENGLISH</div>
                <div class="emergency-sub">æˆ‘ä¸ä¼šè‹±è¯­ (è¯·ç”¨ç¿»è¯‘è½¯ä»¶)</div>
            </div>
        </div>
        <div class="emergency-card" onclick="speakDirect('I am lost. Can you help me?')">
            <div>
                <div class="emergency-text">I AM LOST<br>CAN YOU HELP?</div>
                <div class="emergency-sub">æˆ‘è¿·è·¯äº†ï¼Œèƒ½å¸®æˆ‘å—ï¼Ÿ</div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="randomModal">
        <div class="modal-card">
            <div class="modal-title">ğŸ² éšæœºåœºæ™¯æŒ‘æˆ˜</div>
            <div class="modal-content-text" id="modalQuestion" style="font-weight:bold; font-size: 1.4em;">...</div>
            <div class="modal-actions">
                <button class="modal-btn btn-close" onclick="closeModal('randomModal')">å…³é—­</button>
                <button class="modal-btn btn-reveal" onclick="revealRandomAnswer()">æŸ¥çœ‹ç­”æ¡ˆ</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="reportModal">
        <div class="modal-card">
            <div class="modal-title">ğŸ“… æœˆåº¦æš–å¿ƒå°ç»“</div>
            <div class="modal-content-text" id="reportContent" style="text-align: left; font-size: 1em;">...</div>
            <div class="modal-actions">
                <button class="modal-btn btn-reveal" onclick="closeModal('reportModal')">ç»§ç»­åŠ æ²¹ï¼</button>
            </div>
        </div>
    </div>

    <div class="float-controls">
        <button class="fab-random" onclick="startRandomDrill()" title="éšæœºæŠ½æŸ¥">ğŸ²</button>
        <button class="fab-quiz" onclick="toggleQuizMode()">
            <span class="quiz-default-text">ğŸ‘ï¸ é®æŒ¡ç‰¹è®­</span>
            <span class="quiz-active-text">âœ… æ¢å¤æ˜¾ç¤º</span>
        </button>
    </div>

    <div id="content-area">
    <div class="unit-card" id="u1" data-name="é‚»å±…æ‰“æ‹›å‘¼" data-keywords="é‚»å±… æ‰“æ‹›å‘¼ ä»‹ç» neighbor">
            <div class="unit-header">é‚»å±…æ‰“æ‹›å‘¼<span class="sort-rank"></span></div>
            <div class="step-container">
                <span class="step-label">Step 1: ä»‹ç» <span class="pattern-box">Hi, I'm ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">Hi, I'm <span class="highlight" id="u1-s1-word">your new neighbor</span>.</div><div class="translation" id="u1-s1-trans">å—¨ï¼Œæˆ‘æ˜¯ä½ çš„æ–°é‚»å±…ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u1-s1-word', 'Hi, I am', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u1-s1-chips">
                    <div class="chip active" onclick="updateUnit(1, 1, 'your new neighbor', 'ä½ çš„æ–°é‚»å±…', 'Hi, I am', '', this)">your new neighbor</div>
                    <div class="chip" onclick="updateUnit(1, 1, 'Henry', 'Henry', 'Hi, I am', '', this)">Henry</div>
                    <div class="chip" onclick="updateUnit(1, 1, 'moving in', 'åˆšæ¬è¿›æ¥', 'Hi, I am', '', this)">moving in</div>
                    <div class="chip" onclick="updateUnit(1, 1, 'living next door', 'ä½éš”å£çš„', 'Hi, I am', '', this)">living next door</div>
                    <div class="chip" onclick="updateUnit(1, 1, 'new here', 'æ–°æ¥çš„', 'Hi, I am', '', this)">new here</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(1, 1, 'Hi, I am', '')">ï¼‹</button></div>
                </div>
            </div>
            <hr class="divider">
            <div class="step-container">
                <span class="step-label">Step 2: ä½å€ <span class="pattern-box">I live in ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">I live in <span class="highlight" id="u1-s2-word">Apt 302</span>.</div><div class="translation" id="u1-s2-trans">æˆ‘ä½åœ¨302å®¤ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u1-s2-word', 'I live in', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u1-s2-chips">
                    <div class="chip active" onclick="updateUnit(1, 2, 'Apt 302', '302å®¤', 'I live in', '', this)">Apt 302</div>
                    <div class="chip" onclick="updateUnit(1, 2, 'next door', 'éš”å£', 'I live', '', this)">next door</div>
                    <div class="chip" onclick="updateUnit(1, 2, 'downstairs', 'æ¥¼ä¸‹', 'I live', '', this)">downstairs</div>
                    <div class="chip" onclick="updateUnit(1, 2, 'upstairs', 'æ¥¼ä¸Š', 'I live', '', this)">upstairs</div>
                    <div class="chip" onclick="updateUnit(1, 2, 'this building', 'è¿™æ ‹æ¥¼', 'I live in', '', this)">this building</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(1, 2, 'I live in', '')">ï¼‹</button></div>
                </div>
            </div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ é€»è¾‘æ„é€ </div>
                <div class="combo-text">"Hi, I'm Henry. I live next door, nice to meet you."</div>
                <button class="combo-audio-btn" onclick="speakDirect('Hi, I am Henry. I live next door, nice to meet you.')">ğŸ”Š</button>
            </div>
            <div class="scroll-hint">â¬‡ï¸ å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š</div>
        </div>

        <div class="unit-card" id="u2" data-name="è¯¢é—®ä½ç½®" data-keywords="ä½ç½® æ‰¾è·¯ é—®è·¯ location looking for">
            <div class="unit-header">è¯¢é—®ä½ç½®</div>
            <div class="step-container">
                <span class="step-label">Step 1: ç›®çš„ <span class="pattern-box">I'm looking for ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">Excuse me, I'm looking for <span class="highlight" id="u2-s1-word">Unit 5B</span>.</div><div class="translation" id="u2-s1-trans">æ‰“æ‰°ä¸€ä¸‹ï¼Œæˆ‘åœ¨æ‰¾5Bå•å…ƒã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u2-s1-word', 'Excuse me, I am looking for', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u2-s1-chips">
                    <div class="chip active" onclick="updateUnit(2, 1, 'Unit 5B', '5Bå•å…ƒ', 'Excuse me, I am looking for', '', this)">Unit 5B</div>
                    <div class="chip" onclick="updateUnit(2, 1, 'the exit', 'å‡ºå£', 'Excuse me, I am looking for', '', this)">the exit</div>
                    <div class="chip" onclick="updateUnit(2, 1, 'the elevator', 'ç”µæ¢¯', 'Excuse me, I am looking for', '', this)">the elevator</div>
                    <div class="chip" onclick="updateUnit(2, 1, 'the mailroom', 'æ”¶å‘å®¤', 'Excuse me, I am looking for', '', this)">the mailroom</div>
                    <div class="chip" onclick="updateUnit(2, 1, 'the gym', 'å¥èº«æˆ¿', 'Excuse me, I am looking for', '', this)">the gym</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(2, 1, 'Excuse me, I am looking for', '')">ï¼‹</button></div>
                </div>
            </div>
            <hr class="divider">
            <div class="step-container">
                <span class="step-label">Step 2: æé—® <span class="pattern-box">Could you tell me ... ?</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">Could you tell me <span class="highlight" id="u2-s2-word">how to get there</span>?</div><div class="translation" id="u2-s2-trans">èƒ½å‘Šè¯‰æˆ‘æ€ä¹ˆèµ°å—ï¼Ÿ</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u2-s2-word', 'Could you tell me', '?')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u2-s2-chips">
                    <div class="chip active" onclick="updateUnit(2, 2, 'how to get there', 'æ€ä¹ˆèµ°', 'Could you tell me', 'å—', this)">how to get there</div>
                    <div class="chip" onclick="updateUnit(2, 2, 'where it is', 'å®ƒåœ¨å“ª', 'Could you tell me', 'å—', this)">where it is</div>
                    <div class="chip" onclick="updateUnit(2, 2, 'which way', 'å“ªè¾¹èµ°', 'Could you tell me', 'å—', this)">which way</div>
                    <div class="chip" onclick="updateUnit(2, 2, 'the address', 'å…·ä½“åœ°å€', 'Could you tell me', 'å—', this)">the address</div>
                    <div class="chip" onclick="updateUnit(2, 2, 'if it is far', 'è¿œä¸è¿œ', 'Could you tell me', 'å—', this)">if it is far</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(2, 2, 'Could you tell me', '?')">ï¼‹</button></div>
                </div>
            </div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ é€»è¾‘æ„é€ </div>
                <div class="combo-text">"Excuse me, I'm looking for the mailroom. Could you tell me where it is?"</div>
                <button class="combo-audio-btn" onclick="speakDirect('Excuse me, I am looking for the mailroom. Could you tell me where it is?')">ğŸ”Š</button>
            </div>
            <div class="scroll-hint">â¬‡ï¸ å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š</div>
        </div>

        <div class="unit-card" id="u3" data-name="å€Ÿç”¨æ´—æ‰‹é—´" data-keywords="æ´—æ‰‹é—´ å•æ‰€ ç´§æ€¥ restroom urgent">
            <div class="unit-header">å€Ÿç”¨æ´—æ‰‹é—´</div>
            <div class="step-container">
                <span class="step-label">Step 1: ç¤¼è²Œè¯·æ±‚ <span class="pattern-box">Could I use ... ?</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">Could I use your <span class="highlight" id="u3-s1-word">restroom</span>?</div><div class="translation" id="u3-s1-trans">æˆ‘èƒ½å€Ÿç”¨ä¸€ä¸‹æ‚¨çš„æ´—æ‰‹é—´å—ï¼Ÿ</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u3-s1-word', 'Could I use your', '?')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u3-s1-chips">
                    <div class="chip active" onclick="updateUnit(3, 1, 'restroom', 'æ´—æ‰‹é—´', 'Could I use your', 'å—', this)">restroom</div>
                    <div class="chip" onclick="updateUnit(3, 1, 'bathroom', 'å«ç”Ÿé—´', 'Could I use your', 'å—', this)">bathroom</div>
                    <div class="chip" onclick="updateUnit(3, 1, 'charger', 'å……ç”µå™¨', 'Could I use your', 'å—', this)">charger</div>
                    <div class="chip" onclick="updateUnit(3, 1, 'phone', 'ç”µè¯', 'Could I use your', 'å—', this)">phone</div>
                    <div class="chip" onclick="updateUnit(3, 1, 'wifi', 'WiFi', 'Could I use your', 'å—', this)">wifi</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(3, 1, 'Could I use your', '?')">ï¼‹</button></div>
                </div>
            </div>
            <hr class="divider">
            <div class="step-container">
                <span class="step-label">Step 2: è¡¥å……è¯´æ˜ <span class="pattern-box">It's really ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">It's really <span class="highlight" id="u3-s2-word">urgent</span>.</div><div class="translation" id="u3-s2-trans">çœŸçš„å¾ˆç´§æ€¥ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u3-s2-word', 'It is really', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u3-s2-chips">
                    <div class="chip active" onclick="updateUnit(3, 2, 'urgent', 'ç´§æ€¥', 'It is really', '', this)">urgent</div>
                    <div class="chip" onclick="updateUnit(3, 2, 'quick', 'å¿«(å¾ˆå¿«å°±å¥½)', 'It will be really', '', this)">quick</div>
                    <div class="chip" onclick="updateUnit(3, 2, 'important', 'é‡è¦', 'It is really', '', this)">important</div>
                    <div class="chip" onclick="updateUnit(3, 2, 'necessary', 'æœ‰å¿…è¦', 'It is really', '', this)">necessary</div>
                    <div class="chip" onclick="updateUnit(3, 2, 'an emergency', 'æ€¥äº‹', 'It is', '', this)">an emergency</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(3, 2, 'It is really', '.')">ï¼‹</button></div>
                </div>
            </div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ é€»è¾‘æ„é€ </div>
                <div class="combo-text">"Sorry to bother you, could I use your restroom? It's really urgent."</div>
                <button class="combo-audio-btn" onclick="speakDirect('Sorry to bother you, could I use your restroom? It is really urgent.')">ğŸ”Š</button>
            </div>
            <div class="scroll-hint">â¬‡ï¸ å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š</div>
        </div>

        <div class="unit-card" id="u4" data-name="é“¶è¡ŒåŠäº‹" data-keywords="é“¶è¡Œ å¼€æˆ· å­˜æ¬¾ bank">
            <div class="unit-header">é“¶è¡ŒåŠäº‹</div>
            <div class="step-container">
                <span class="step-label">Step 1: éœ€æ±‚ <span class="pattern-box">I'd like to ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">I'd like to <span class="highlight" id="u4-s1-word">open an account</span>.</div><div class="translation" id="u4-s1-trans">æˆ‘æƒ³å¼€ä¸€ä¸ªè´¦æˆ·ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u4-s1-word', 'I would like to', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u4-s1-chips">
                    <div class="chip active" onclick="updateUnit(4, 1, 'open an account', 'å¼€ä¸ªè´¦æˆ·', 'I would like to', '', this)">open an account</div>
                    <div class="chip" onclick="updateUnit(4, 1, 'deposit money', 'å­˜é’±', 'I would like to', '', this)">deposit money</div>
                    <div class="chip" onclick="updateUnit(4, 1, 'withdraw cash', 'å–é’±', 'I would like to', '', this)">withdraw cash</div>
                    <div class="chip" onclick="updateUnit(4, 1, 'exchange currency', 'æ¢æ±‡', 'I would like to', '', this)">exchange currency</div>
                    <div class="chip" onclick="updateUnit(4, 1, 'wire money', 'æ±‡æ¬¾', 'I would like to', '', this)">wire money</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(4, 1, 'I would like to', '.')">ï¼‹</button></div>
                </div>
            </div>
            <hr class="divider">
            <div class="step-container">
                <span class="step-label">Step 2: æä¾›è¯ä»¶ <span class="pattern-box">Here is my ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">Here is my <span class="highlight" id="u4-s2-word">ID card</span>.</div><div class="translation" id="u4-s2-trans">è¿™æ˜¯æˆ‘çš„èº«ä»½è¯ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u4-s2-word', 'Here is my', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u4-s2-chips">
                    <div class="chip active" onclick="updateUnit(4, 2, 'ID card', 'èº«ä»½è¯', 'Here is my', '', this)">ID card</div>
                    <div class="chip" onclick="updateUnit(4, 2, 'passport', 'æŠ¤ç…§', 'Here is my', '', this)">passport</div>
                    <div class="chip" onclick="updateUnit(4, 2, 'debit card', 'å€Ÿè®°å¡', 'Here is my', '', this)">debit card</div>
                    <div class="chip" onclick="updateUnit(4, 2, 'check', 'æ”¯ç¥¨', 'Here is my', '', this)">check</div>
                    <div class="chip" onclick="updateUnit(4, 2, 'application form', 'ç”³è¯·è¡¨', 'Here is my', '', this)">application form</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(4, 2, 'Here is my', '.')">ï¼‹</button></div>
                </div>
            </div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ é€»è¾‘æ„é€ </div>
                <div class="combo-text">"I'd like to open an account. Here is my passport."</div>
                <button class="combo-audio-btn" onclick="speakDirect('I would like to open an account. Here is my passport.')">ğŸ”Š</button>
            </div>
            <div class="scroll-hint">â¬‡ï¸ å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š</div>
        </div>
        <div class="unit-card" id="u5" data-name="è¶…å¸‚ç»“è´¦" data-keywords="è¶…å¸‚ ç»“è´¦ æ”¯ä»˜ checkout">
            <div class="unit-header">è¶…å¸‚ç»“è´¦</div>
            <div class="step-container">
                <span class="step-label">Step 1: æ”¯ä»˜æ–¹å¼ <span class="pattern-box">I'd like to pay by ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">I'd like to pay by <span class="highlight" id="u5-s1-word">credit card</span>.</div><div class="translation" id="u5-s1-trans">æˆ‘æƒ³ç”¨ä¿¡ç”¨å¡æ”¯ä»˜ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u5-s1-word', 'I would like to pay by', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u5-s1-chips">
                    <div class="chip active" onclick="updateUnit(5, 1, 'credit card', 'ä¿¡ç”¨å¡', 'I would like to pay by', '', this)">credit card</div>
                    <div class="chip" onclick="updateUnit(5, 1, 'cash', 'ç°é‡‘', 'I would like to pay by', '', this)">cash</div>
                    <div class="chip" onclick="updateUnit(5, 1, 'Apple Pay', 'Apple Pay', 'I would like to pay by', '', this)">Apple Pay</div>
                    <div class="chip" onclick="updateUnit(5, 1, 'debit card', 'å€Ÿè®°å¡', 'I would like to pay by', '', this)">debit card</div>
                    <div class="chip" onclick="updateUnit(5, 1, 'gift card', 'ç¤¼å“å¡', 'I would like to pay by', '', this)">gift card</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(5, 1, 'I would like to pay by', '.')">ï¼‹</button></div>
                </div>
            </div>
            <hr class="divider">
            <div class="step-container">
                <span class="step-label">Step 2: è¯¢é—® <span class="pattern-box">Do you offer ... ?</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">Do you offer <span class="highlight" id="u5-s2-word">plastic bags</span>?</div><div class="translation" id="u5-s2-trans">ä½ ä»¬æä¾›å¡‘æ–™è¢‹å—ï¼Ÿ</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u5-s2-word', 'Do you offer', '?')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u5-s2-chips">
                    <div class="chip active" onclick="updateUnit(5, 2, 'plastic bags', 'å¡‘æ–™è¢‹', 'Do you offer', 'å—', this)">plastic bags</div>
                    <div class="chip" onclick="updateUnit(5, 2, 'a receipt', 'æ”¶æ®', 'Do you offer', 'å—', this)">a receipt</div>
                    <div class="chip" onclick="updateUnit(5, 2, 'cash back', 'ç°é‡‘è¿”è¿˜', 'Do you offer', 'å—', this)">cash back</div>
                    <div class="chip" onclick="updateUnit(5, 2, 'gift wrapping', 'ç¤¼å“åŒ…è£…', 'Do you offer', 'å—', this)">gift wrapping</div>
                    <div class="chip" onclick="updateUnit(5, 2, 'discounts', 'æŠ˜æ‰£', 'Do you offer', 'å—', this)">discounts</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(5, 2, 'Do you offer', '?')">ï¼‹</button></div>
                </div>
            </div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ é€»è¾‘æ„é€ </div>
                <div class="combo-text">"I'll pay by credit card. Do you offer a receipt?"</div>
                <button class="combo-audio-btn" onclick="speakDirect('I will pay by credit card. Do you offer a receipt?')">ğŸ”Š</button>
            </div>
            <div class="scroll-hint">â¬‡ï¸ å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š</div>
        </div>

        <div class="unit-card" id="u6" data-name="é¤å…ç‚¹é¤" data-keywords="ç‚¹é¤ åƒé¥­ é¤å… order food">
            <div class="unit-header">é¤å…ç‚¹é¤</div>
            <div class="step-container">
                <span class="step-label">Step 1: æˆ‘æƒ³è¦ <span class="pattern-box">I'd like ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">I'd like <span class="highlight" id="u6-s1-word">the steak</span>.</div><div class="translation" id="u6-s1-trans">æˆ‘æƒ³è¦ç‰›æ’ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u6-s1-word', 'I would like', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u6-s1-chips">
                    <div class="chip active" onclick="updateUnit(6, 1, 'the steak', 'ç‰›æ’', 'I would like', '', this)">the steak</div>
                    <div class="chip" onclick="updateUnit(6, 1, 'a salad', 'æ²™æ‹‰', 'I would like', '', this)">a salad</div>
                    <div class="chip" onclick="updateUnit(6, 1, 'a burger', 'æ±‰å ¡', 'I would like', '', this)">a burger</div>
                    <div class="chip" onclick="updateUnit(6, 1, 'the pasta', 'æ„é¢', 'I would like', '', this)">the pasta</div>
                    <div class="chip" onclick="updateUnit(6, 1, 'some water', 'ä¸€äº›æ°´', 'I would like', '', this)">some water</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(6, 1, 'I would like', '.')">ï¼‹</button></div>
                </div>
            </div>
            <hr class="divider">
            <div class="step-container">
                <span class="step-label">Step 2: å¿Œå£ <span class="pattern-box">No ... please.</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">No <span class="highlight" id="u6-s2-word">onions</span> please.</div><div class="translation" id="u6-s2-trans">è¯·ä¸è¦æ´‹è‘±ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u6-s2-word', 'No', 'please.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u6-s2-chips">
                    <div class="chip active" onclick="updateUnit(6, 2, 'onions', 'æ´‹è‘±', 'No', 'please', this)">onions</div>
                    <div class="chip" onclick="updateUnit(6, 2, 'ice', 'å†°', 'No', 'please', this)">ice</div>
                    <div class="chip" onclick="updateUnit(6, 2, 'spice', 'è¾£', 'No', 'please', this)">spice</div>
                    <div class="chip" onclick="updateUnit(6, 2, 'sugar', 'ç³–', 'No', 'please', this)">sugar</div>
                    <div class="chip" onclick="updateUnit(6, 2, 'cilantro', 'é¦™èœ', 'No', 'please', this)">cilantro</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(6, 2, 'No', 'please.')">ï¼‹</button></div>
                </div>
            </div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ é€»è¾‘æ„é€ </div>
                <div class="combo-text">"I'd like the burger. No onions please."</div>
                <button class="combo-audio-btn" onclick="speakDirect('I would like the burger. No onions please.')">ğŸ”Š</button>
            </div>
            <div class="scroll-hint">â¬‡ï¸ å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š</div>
        </div>

        <div class="unit-card" id="u7" data-name="æœ‹å‹èšé¤" data-keywords="èšé¤ ä¹°å• AAåˆ¶ split bill">
            <div class="unit-header">æœ‹å‹èšé¤</div>
            <div class="step-container">
                <span class="step-label">Step 1: æè®® <span class="pattern-box">Let's ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">Let's <span class="highlight" id="u7-s1-word">split the bill</span>.</div><div class="translation" id="u7-s1-trans">å’±ä»¬AAåˆ¶å§ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u7-s1-word', 'Let us', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u7-s1-chips">
                    <div class="chip active" onclick="updateUnit(7, 1, 'split the bill', 'AAåˆ¶', 'Let us', '', this)">split the bill</div>
                    <div class="chip" onclick="updateUnit(7, 1, 'share this', 'åˆ†ç€åƒè¿™ä¸ª', 'Let us', '', this)">share this</div>
                    <div class="chip" onclick="updateUnit(7, 1, 'get dessert', 'ç‚¹ä¸ªç”œç‚¹', 'Let us', '', this)">get dessert</div>
                    <div class="chip" onclick="updateUnit(7, 1, 'grab a drink', 'å–ä¸€æ¯', 'Let us', '', this)">grab a drink</div>
                    <div class="chip" onclick="updateUnit(7, 1, 'go dutch', 'å„ä»˜å„çš„', 'Let us', '', this)">go dutch</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(7, 1, 'Let us', '.')">ï¼‹</button></div>
                </div>
            </div>
            <hr class="divider">
            <div class="step-container">
                <span class="step-label">Step 2: è¯·å®¢ <span class="pattern-box">It's on ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">It's on <span class="highlight" id="u7-s2-word">me</span>.</div><div class="translation" id="u7-s2-trans">æˆ‘è¯·å®¢ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u7-s2-word', 'It is on', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u7-s2-chips">
                    <div class="chip active" onclick="updateUnit(7, 2, 'me', 'æˆ‘(è¯·å®¢)', 'It is on', '', this)">me</div>
                    <div class="chip" onclick="updateUnit(7, 2, 'the house', 'è€æ¿(å…å•)', 'It is on', '', this)">the house</div>
                    <div class="chip" onclick="updateUnit(7, 2, 'Henry', 'Henry', 'It is on', '', this)">Henry</div>
                    <div class="chip" onclick="updateUnit(7, 2, 'my treat', 'æˆ‘è¯·å®¢(åŒä¹‰)', 'This is', '', this)">my treat</div>
                    <div class="chip" onclick="updateUnit(7, 2, 'the company', 'å…¬å¸(æŠ¥é”€)', 'It is on', '', this)">the company</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(7, 2, 'It is on', '.')">ï¼‹</button></div>
                </div>
            </div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ é€»è¾‘æ„é€ </div>
                <div class="combo-text">"No need to split. It's on me tonight."</div>
                <button class="combo-audio-btn" onclick="speakDirect('No need to split. It is on me tonight.')">ğŸ”Š</button>
            </div>
            <div class="scroll-hint">â¬‡ï¸ å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š</div>
        </div>

        <div class="unit-card" id="u8" data-name="å¶é‡å™æ—§" data-keywords="å™æ—§ èŠå¤© å¯’æš„ long time">
            <div class="unit-header">å¶é‡å™æ—§</div>
            <div class="step-container">
                <span class="step-label">Step 1: é—®å€™ <span class="pattern-box">How's ... ?</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">Long time no see! How's <span class="highlight" id="u8-s1-word">everything</span>?</div><div class="translation" id="u8-s1-trans">å¥½ä¹…ä¸è§ï¼ä¸€åˆ‡éƒ½å¥½å—ï¼Ÿ</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u8-s1-word', 'Long time no see! How is', '?')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u8-s1-chips">
                    <div class="chip active" onclick="updateUnit(8, 1, 'everything', 'ä¸€åˆ‡', 'How is', '?', this)">everything</div>
                    <div class="chip" onclick="updateUnit(8, 1, 'your family', 'å®¶äºº', 'How is', '?', this)">your family</div>
                    <div class="chip" onclick="updateUnit(8, 1, 'work', 'å·¥ä½œ', 'How is', '?', this)">work</div>
                    <div class="chip" onclick="updateUnit(8, 1, 'life', 'ç”Ÿæ´»', 'How is', '?', this)">life</div>
                    <div class="chip" onclick="updateUnit(8, 1, 'your dog', 'ä½ çš„ç‹—', 'How is', '?', this)">your dog</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(8, 1, 'How is', '?')">ï¼‹</button></div>
                </div>
            </div>
            <hr class="divider">
            <div class="step-container">
                <span class="step-label">Step 2: çº¦å®š <span class="pattern-box">We should ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">We should <span class="highlight" id="u8-s2-word">catch up</span>.</div><div class="translation" id="u8-s2-trans">æˆ‘ä»¬åº”è¯¥å™å™æ—§ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u8-s2-word', 'We should', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u8-s2-chips">
                    <div class="chip active" onclick="updateUnit(8, 2, 'catch up', 'å™å™æ—§', 'We should', '', this)">catch up</div>
                    <div class="chip" onclick="updateUnit(8, 2, 'hang out', 'å‡ºæ¥ç©', 'We should', '', this)">hang out</div>
                    <div class="chip" onclick="updateUnit(8, 2, 'grab coffee', 'å–æ¯å’–å•¡', 'We should', '', this)">grab coffee</div>
                    <div class="chip" onclick="updateUnit(8, 2, 'keep in touch', 'ä¿æŒè”ç³»', 'We should', '', this)">keep in touch</div>
                    <div class="chip" onclick="updateUnit(8, 2, 'have dinner', 'åƒä¸ªé¥­', 'We should', '', this)">have dinner</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(8, 2, 'We should', '.')">ï¼‹</button></div>
                </div>
            </div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ é€»è¾‘æ„é€ </div>
                <div class="combo-text">"Long time no see! We should grab coffee sometime."</div>
                <button class="combo-audio-btn" onclick="speakDirect('Long time no see! We should grab coffee sometime.')">ğŸ”Š</button>
            </div>
            <div class="scroll-hint">â¬‡ï¸ å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š</div>
        </div>
        <div class="unit-card" id="u9" data-name="æ‰“è½¦å‡ºè¡Œ" data-keywords="æ‰“è½¦ å¸æœº taxi uber ride">
            <div class="unit-header">æ‰“è½¦å‡ºè¡Œ</div>
            <div class="step-container">
                <span class="step-label">Step 1: ç›®çš„åœ° <span class="pattern-box">I'm going to ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">I'm going to <span class="highlight" id="u9-s1-word">JFK Airport</span>.</div><div class="translation" id="u9-s1-trans">æˆ‘è¦å»JFKæœºåœºã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u9-s1-word', 'I am going to', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u9-s1-chips">
                    <div class="chip active" onclick="updateUnit(9, 1, 'JFK Airport', 'JFKæœºåœº', 'I am going to', '', this)">JFK Airport</div>
                    <div class="chip" onclick="updateUnit(9, 1, 'Times Square', 'æ—¶ä»£å¹¿åœº', 'I am going to', '', this)">Times Square</div>
                    <div class="chip" onclick="updateUnit(9, 1, 'this address', 'è¿™ä¸ªåœ°å€', 'I am going to', '', this)">this address</div>
                    <div class="chip" onclick="updateUnit(9, 1, 'Flushing', 'æ³•æ‹‰ç››', 'I am going to', '', this)">Flushing</div>
                    <div class="chip" onclick="updateUnit(9, 1, 'Main Street', 'ä¸»è¡—', 'I am going to', '', this)">Main Street</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(9, 1, 'I am going to', '.')">ï¼‹</button></div>
                </div>
            </div>
            <hr class="divider">
            <div class="step-container">
                <span class="step-label">Step 2: ä¸‹è½¦ç‚¹ <span class="pattern-box">Drop me off ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">Drop me off <span class="highlight" id="u9-s2-word">here</span>.</div><div class="translation" id="u9-s2-trans">å°±åœ¨è¿™å„¿ä¸‹ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u9-s2-word', 'Drop me off', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u9-s2-chips">
                    <div class="chip active" onclick="updateUnit(9, 2, 'here', 'è¿™å„¿', 'Drop me off', '', this)">here</div>
                    <div class="chip" onclick="updateUnit(9, 2, 'at the corner', 'è·¯å£', 'Drop me off', '', this)">at the corner</div>
                    <div class="chip" onclick="updateUnit(9, 2, 'across the street', 'è¡—å¯¹é¢', 'Drop me off', '', this)">across the street</div>
                    <div class="chip" onclick="updateUnit(9, 2, 'by the light', 'çº¢ç»¿ç¯æ—', 'Drop me off', '', this)">by the light</div>
                    <div class="chip" onclick="updateUnit(9, 2, 'in front of the hotel', 'é…’åº—é—¨å£', 'Drop me off', '', this)">in front of the hotel</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(9, 2, 'Drop me off', '.')">ï¼‹</button></div>
                </div>
            </div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ é€»è¾‘æ„é€ </div>
                <div class="combo-text">"I'm going to Main Street. Drop me off at the corner."</div>
                <button class="combo-audio-btn" onclick="speakDirect('I am going to Main Street. Drop me off at the corner.')">ğŸ”Š</button>
            </div>
            <div class="scroll-hint">â¬‡ï¸ å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š</div>
        </div>

        <div class="unit-card" id="u10" data-name="ç´§æ€¥æ±‚åŠ©" data-keywords="æ€¥æ•‘ åŒ»ç”Ÿ è­¦å¯Ÿ help 911">
            <div class="unit-header">ç´§æ€¥æ±‚åŠ©</div>
            <div class="step-container">
                <span class="step-label">Step 1: éœ€æ±‚ <span class="pattern-box">I need ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">I need <span class="highlight" id="u10-s1-word">a doctor</span>.</div><div class="translation" id="u10-s1-trans">æˆ‘éœ€è¦åŒ»ç”Ÿã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u10-s1-word', 'I need', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u10-s1-chips">
                    <div class="chip active" onclick="updateUnit(10, 1, 'a doctor', 'åŒ»ç”Ÿ', 'I need', '', this)">a doctor</div>
                    <div class="chip" onclick="updateUnit(10, 1, 'help', 'å¸®åŠ©', 'I need', '', this)">help</div>
                    <div class="chip" onclick="updateUnit(10, 1, 'an ambulance', 'æ•‘æŠ¤è½¦', 'I need', '', this)">an ambulance</div>
                    <div class="chip" onclick="updateUnit(10, 1, 'the police', 'è­¦å¯Ÿ', 'I need', '', this)">the police</div>
                    <div class="chip" onclick="updateUnit(10, 1, 'a translator', 'ç¿»è¯‘', 'I need', '', this)">a translator</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(10, 1, 'I need', '.')">ï¼‹</button></div>
                </div>
            </div>
            <hr class="divider">
            <div class="step-container">
                <span class="step-label">Step 2: çŠ¶å†µ <span class="pattern-box">I feel ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">I feel <span class="highlight" id="u10-s2-word">dizzy</span>.</div><div class="translation" id="u10-s2-trans">æˆ‘å¤´æ™•ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u10-s2-word', 'I feel', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u10-s2-chips">
                    <div class="chip active" onclick="updateUnit(10, 2, 'dizzy', 'å¤´æ™•', 'I feel', '', this)">dizzy</div>
                    <div class="chip" onclick="updateUnit(10, 2, 'pain', 'ç–¼', 'I feel', '', this)">pain</div>
                    <div class="chip" onclick="updateUnit(10, 2, 'sick', 'æ¶å¿ƒ/ç”Ÿç—…', 'I feel', '', this)">sick</div>
                    <div class="chip" onclick="updateUnit(10, 2, 'hurt', 'å—ä¼¤äº†', 'I am', '', this)">hurt</div>
                    <div class="chip" onclick="updateUnit(10, 2, 'cannot breathe', 'æ— æ³•å‘¼å¸', 'I', '', this)">cannot breathe</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(10, 2, 'I feel', '.')">ï¼‹</button></div>
                </div>
            </div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ é€»è¾‘æ„é€ </div>
                <div class="combo-text">"I need an ambulance. I cannot breathe."</div>
                <button class="combo-audio-btn" onclick="speakDirect('I need an ambulance. I cannot breathe.')">ğŸ”Š</button>
            </div>
            <div class="scroll-hint">â¬‡ï¸ å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š</div>
        </div>

        <div class="unit-card" id="u11" data-name="æ²¡å¬æ‡‚" data-keywords="å¬ä¸æ‡‚ é‡å¤ æ…¢ç‚¹ understand">
            <div class="unit-header">æ²¡å¬æ‡‚</div>
            <div class="step-container">
                <span class="step-label">Step 1: è¯·æ±‚ <span class="pattern-box">Could you ... ?</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">Could you <span class="highlight" id="u11-s1-word">say that again</span>?</div><div class="translation" id="u11-s1-trans">èƒ½å†è¯´ä¸€éå—ï¼Ÿ</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u11-s1-word', 'Could you', '?')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u11-s1-chips">
                    <div class="chip active" onclick="updateUnit(11, 1, 'say that again', 'å†è¯´ä¸€é', 'Could you', '?', this)">say that again</div>
                    <div class="chip" onclick="updateUnit(11, 1, 'speak slower', 'è¯´æ…¢ç‚¹', 'Could you', '?', this)">speak slower</div>
                    <div class="chip" onclick="updateUnit(11, 1, 'write it down', 'å†™ä¸‹æ¥', 'Could you', '?', this)">write it down</div>
                    <div class="chip" onclick="updateUnit(11, 1, 'show me', 'æŒ‡ç»™æˆ‘çœ‹', 'Could you', '?', this)">show me</div>
                    <div class="chip" onclick="updateUnit(11, 1, 'translate', 'ç¿»è¯‘ä¸€ä¸‹', 'Could you', '?', this)">translate</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(11, 1, 'Could you', '?')">ï¼‹</button></div>
                </div>
            </div>
            <hr class="divider">
            <div class="step-container">
                <span class="step-label">Step 2: è¯´æ˜ <span class="pattern-box">I don't ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">I don't <span class="highlight" id="u11-s2-word">understand</span>.</div><div class="translation" id="u11-s2-trans">æˆ‘ä¸æ˜ç™½ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u11-s2-word', 'I do not', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u11-s2-chips">
                    <div class="chip active" onclick="updateUnit(11, 2, 'understand', 'æ˜ç™½', 'I do not', '', this)">understand</div>
                    <div class="chip" onclick="updateUnit(11, 2, 'speak English', 'ä¼šè¯´è‹±è¯­', 'I do not', 'well', this)">speak English</div>
                    <div class="chip" onclick="updateUnit(11, 2, 'know', 'çŸ¥é“', 'I do not', '', this)">know</div>
                    <div class="chip" onclick="updateUnit(11, 2, 'get it', 'æ‡‚', 'I do not', '', this)">get it</div>
                    <div class="chip" onclick="updateUnit(11, 2, 'hear you', 'å¬æ¸…', 'I did not', '', this)">hear you</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(11, 2, 'I do not', '.')">ï¼‹</button></div>
                </div>
            </div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ é€»è¾‘æ„é€ </div>
                <div class="combo-text">"Sorry, I don't speak English well. Could you write it down?"</div>
                <button class="combo-audio-btn" onclick="speakDirect('Sorry, I do not speak English well. Could you write it down?')">ğŸ”Š</button>
            </div>
            <div class="scroll-hint">â¬‡ï¸ å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š</div>
        </div>

        <div class="unit-card" id="u12" data-name="è´­ç‰©é€€è´§" data-keywords="é€€è´§ é€€æ¬¾ æ¢è´§ return refund">
            <div class="unit-header">è´­ç‰©é€€è´§</div>
            <div class="step-container">
                <span class="step-label">Step 1: ç›®çš„ <span class="pattern-box">I'd like to ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">I'd like to <span class="highlight" id="u12-s1-word">return this</span>.</div><div class="translation" id="u12-s1-trans">æˆ‘æƒ³é€€è´§ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u12-s1-word', 'I would like to', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u12-s1-chips">
                    <div class="chip active" onclick="updateUnit(12, 1, 'return this', 'é€€è´§', 'I would like to', '', this)">return this</div>
                    <div class="chip" onclick="updateUnit(12, 1, 'exchange this', 'æ¢è´§', 'I would like to', '', this)">exchange this</div>
                    <div class="chip" onclick="updateUnit(12, 1, 'get a refund', 'é€€æ¬¾', 'I would like to', '', this)">get a refund</div>
                    <div class="chip" onclick="updateUnit(12, 1, 'try this on', 'è¯•ç©¿', 'I would like to', '', this)">try this on</div>
                    <div class="chip" onclick="updateUnit(12, 1, 'cancel this', 'å–æ¶ˆè¿™ä¸ª', 'I would like to', '', this)">cancel this</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(12, 1, 'I would like to', '.')">ï¼‹</button></div>
                </div>
            </div>
            <hr class="divider">
            <div class="step-container">
                <span class="step-label">Step 2: ç†ç”± <span class="pattern-box">It's ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">It's <span class="highlight" id="u12-s2-word">broken</span>.</div><div class="translation" id="u12-s2-trans">å®ƒåäº†ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u12-s2-word', 'It is', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u12-s2-chips">
                    <div class="chip active" onclick="updateUnit(12, 2, 'broken', 'åäº†', 'It is', '', this)">broken</div>
                    <div class="chip" onclick="updateUnit(12, 2, 'too small', 'å¤ªå°äº†', 'It is', '', this)">too small</div>
                    <div class="chip" onclick="updateUnit(12, 2, 'the wrong size', 'å°ºç ä¸å¯¹', 'It is', '', this)">the wrong size</div>
                    <div class="chip" onclick="updateUnit(12, 2, 'not working', 'åäº†/ä¸å·¥ä½œ', 'It is', '', this)">not working</div>
                    <div class="chip" onclick="updateUnit(12, 2, 'expired', 'è¿‡æœŸäº†', 'It is', '', this)">expired</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(12, 2, 'It is', '.')">ï¼‹</button></div>
                </div>
            </div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ é€»è¾‘æ„é€ </div>
                <div class="combo-text">"I'd like to return this. It is too small."</div>
                <button class="combo-audio-btn" onclick="speakDirect('I would like to return this. It is too small.')">ğŸ”Š</button>
            </div>
            <div class="scroll-hint">â¬‡ï¸ å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š</div>
        </div>

        <div class="unit-card" id="u13" data-name="é¢„çº¦æ—¶é—´" data-keywords="é¢„çº¦ æ—¶é—´ å®‰æ’ appointment">
            <div class="unit-header">é¢„çº¦æ—¶é—´</div>
            <div class="step-container">
                <span class="step-label">Step 1: åŠ¨ä½œ <span class="pattern-box">I'd like to ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">I'd like to <span class="highlight" id="u13-s1-word">make an appointment</span>.</div><div class="translation" id="u13-s1-trans">æˆ‘æƒ³é¢„çº¦ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u13-s1-word', 'I would like to', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u13-s1-chips">
                    <div class="chip active" onclick="updateUnit(13, 1, 'make an appointment', 'é¢„çº¦', 'I would like to', '', this)">make an appointment</div>
                    <div class="chip" onclick="updateUnit(13, 1, 'reschedule', 'æ”¹æœŸ', 'I would like to', '', this)">reschedule</div>
                    <div class="chip" onclick="updateUnit(13, 1, 'cancel', 'å–æ¶ˆ', 'I would like to', '', this)">cancel</div>
                    <div class="chip" onclick="updateUnit(13, 1, 'confirm', 'ç¡®è®¤', 'I would like to', '', this)">confirm</div>
                    <div class="chip" onclick="updateUnit(13, 1, 'book a table', 'è®¢ä½(åƒé¥­)', 'I would like to', '', this)">book a table</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(13, 1, 'I would like to', '.')">ï¼‹</button></div>
                </div>
            </div>
            <hr class="divider">
            <div class="step-container">
                <span class="step-label">Step 2: æ—¶é—´ <span class="pattern-box">At ...</span></span>
                <div class="display-area">
                    <div class="text-content"><div class="english-sentence">At <span class="highlight" id="u13-s2-word">2 PM</span>.</div><div class="translation" id="u13-s2-trans">åœ¨ä¸‹åˆ2ç‚¹ã€‚</div></div>
                    <button class="btn-audio" onclick="speakWholeSentence('u13-s2-word', 'At', '.')">ğŸ”Š</button>
                </div>
                <div class="chips-container" id="u13-s2-chips">
                    <div class="chip active" onclick="updateUnit(13, 2, '2 PM', 'ä¸‹åˆ2ç‚¹', 'At', '', this)">2 PM</div>
                    <div class="chip" onclick="updateUnit(13, 2, '3:30', '3ç‚¹åŠ', 'At', '', this)">3:30</div>
                    <div class="chip" onclick="updateUnit(13, 2, 'noon', 'ä¸­åˆ', 'At', '', this)">noon</div>
                    <div class="chip" onclick="updateUnit(13, 2, 'tomorrow morning', 'æ˜å¤©æ—©ä¸Š', 'On', '', this)">tomorrow morning</div>
                    <div class="chip" onclick="updateUnit(13, 2, 'next week', 'ä¸‹å‘¨', 'In', '', this)">next week</div>
                    <div class="add-btn-wrapper"><button class="chip add-chip-btn" onclick="addCustomChip(13, 2, 'At', '.')">ï¼‹</button></div>
                </div>
            </div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ é€»è¾‘æ„é€ </div>
                <div class="combo-text">"I'd like to make an appointment. At 2 PM, please."</div>
                <button class="combo-audio-btn" onclick="speakDirect('I would like to make an appointment. At 2 PM, please.')">ğŸ”Š</button>
            </div>
            <div class="scroll-hint">â¬‡ï¸ å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š</div>
        </div>

    </div> <div class="fixed-footer">
        <p>&copy; <span id="year"></span> Henry's Survival English Guide.</p>
    </div>

    <script>
        // === æ ¸å¿ƒé€»è¾‘ (V33.2: åº•éƒ¨å–‡å­å…¨å±€å§”æ‰˜ä¿®å¤ç‰ˆ) ===
        let usageData = {};
        let currentRandomUnit = null;
        let pressTimer;
        let recognition = null; 
        
        let aiState = { active: false, currentUnit: null, currentStep: 0, score: 0, total: 0, currentTargetEng: "", currentTargetCn: "", waitingForSpeech: false, silenceTimer: null, idleTimer: null };

        // æ‰©å……è¯åº“ (Unit -> Step -> [{e:è‹±æ–‡, c:ä¸­æ–‡}])
        const extraVocab = {
            1: { 1: [{e:"new neighbor", c:"æ–°é‚»å±…"}, {e:"from 3B", c:"3Bçš„ä½æˆ·"}, {e:"just moved in", c:"åˆšæ¬æ¥çš„"}, {e:"Henry", c:"Henry"}, {e:"living downstairs", c:"ä½æ¥¼ä¸‹çš„"}, {e:"the new guy", c:"æ–°æ¥çš„é‚£ä¸ª"}], 2: [{e:"down the hall", c:"èµ°å»Šå°½å¤´"}, {e:"upstairs", c:"æ¥¼ä¸Š"}, {e:"next door", c:"éš”å£"}, {e:"in unit 402", c:"402å®¤"}, {e:"across the street", c:"é©¬è·¯å¯¹é¢"}] },
            2: { 1: [{e:"the subway", c:"åœ°é“ç«™"}, {e:"the restroom", c:"æ´—æ‰‹é—´"}, {e:"the exit", c:"å‡ºå£"}, {e:"an elevator", c:"ç”µæ¢¯"}, {e:"a pharmacy", c:"è¯æˆ¿"}, {e:"the bus stop", c:"å…¬äº¤ç«™"}], 2: [{e:"where it is", c:"å®ƒåœ¨å“ª"}, {e:"which floor", c:"åœ¨å‡ æ¥¼"}, {e:"the direction", c:"æ–¹å‘"}, {e:"how to get there", c:"æ€ä¹ˆèµ°"}] },
            3: { 1: [{e:"phone charger", c:"æ‰‹æœºå……ç”µå™¨"}, {e:"wifi password", c:"WiFiå¯†ç "}, {e:"pen", c:"ç¬”"}, {e:"lighter", c:"æ‰“ç«æœº"}, {e:"umbrella", c:"é›¨ä¼"}, {e:"power bank", c:"å……ç”µå®"}], 2: [{e:"urgent", c:"ç´§æ€¥"}, {e:"an emergency", c:"æ€¥äº‹"}, {e:"dying", c:"å¿«æ²¡ç”µäº†"}, {e:"running low", c:"ç”µé‡ä½"}, {e:"important", c:"å¾ˆé‡è¦"}] },
            4: { 1: [{e:"deposit cash", c:"å­˜ç°é‡‘"}, {e:"withdraw money", c:"å–é’±"}, {e:"transfer funds", c:"è½¬è´¦"}, {e:"open an account", c:"å¼€æˆ·"}, {e:"change PIN", c:"æ”¹å¯†ç "}], 2: [{e:"ID card", c:"èº«ä»½è¯"}, {e:"passport", c:"æŠ¤ç…§"}, {e:"debit card", c:"å€Ÿè®°å¡"}, {e:"check", c:"æ”¯ç¥¨"}, {e:"account number", c:"è´¦å·"}] },
            5: { 1: [{e:"credit card", c:"ä¿¡ç”¨å¡"}, {e:"Apple Pay", c:"Apple Pay"}, {e:"cash", c:"ç°é‡‘"}, {e:"Venmo", c:"Venmo"}, {e:"Zelle", c:"Zelle"}, {e:"AliPay", c:"æ”¯ä»˜å®"}], 2: [{e:"a receipt", c:"æ”¶æ®"}, {e:"a discount", c:"æŠ˜æ‰£"}, {e:"cash back", c:"è¿”ç°"}, {e:"small change", c:"é›¶é’±"}, {e:"a bag", c:"è¢‹å­"}] },
            6: { 1: [{e:"tap water", c:"è‡ªæ¥æ°´"}, {e:"the menu", c:"èœå•"}, {e:"napkins", c:"é¤å·¾çº¸"}, {e:"a refill", c:"ç»­æ¯"}, {e:"chopsticks", c:"ç­·å­"}, {e:"a box", c:"æ‰“åŒ…ç›’"}], 2: [{e:"add sugar", c:"åŠ ç³–"}, {e:"make it spicy", c:"åšæˆè¾£çš„"}, {e:"add ice", c:"åŠ å†°"}, {e:"put cilantro", c:"æ”¾é¦™èœ"}, {e:"rush it", c:"å¿«ä¸€ç‚¹"}] },
            7: { 1: [{e:"split the bill", c:"å¹³æ‘Š"}, {e:"share the cost", c:"åˆ†æ‹…è´¹ç”¨"}, {e:"go Dutch", c:"AAåˆ¶"}, {e:"treat you", c:"è¯·ä½ "}], 2: [{e:"on me", c:"æˆ‘è¯·å®¢"}, {e:"my treat", c:"æˆ‘ä¹°å•"}, {e:"my turn", c:"è½®åˆ°æˆ‘äº†"}, {e:"covered by me", c:"æˆ‘åŒ…äº†"}] },
            8: { 1: [{e:"no see", c:"æ²¡è§"}, {e:"no talk", c:"æ²¡èŠ"}, {e:"since college", c:"å¤§å­¦å"}, {e:"since last year", c:"å»å¹´å"}], 2: [{e:"catch up", c:"å™å™æ—§"}, {e:"hang out", c:"èšèš"}, {e:"get coffee", c:"å–æ¯å’–å•¡"}, {e:"keep in touch", c:"å¸¸è”ç³»"}, {e:"exchange numbers", c:"äº¤æ¢å·ç "}] },
            9: { 1: [{e:"JFK airport", c:"JFKæœºåœº"}, {e:"Main Street", c:"Mainè¡—"}, {e:"the hotel", c:"é…’åº—"}, {e:"this address", c:"è¿™ä¸ªåœ°å€"}, {e:"Flushing", c:"æ³•æ‹‰ç››"}], 2: [{e:"right here", c:"å°±åœ¨è¿™"}, {e:"at the corner", c:"åœ¨è·¯å£"}, {e:"at the light", c:"åœ¨çº¢ç»¿ç¯"}, {e:"by the sign", c:"æ ‡å¿—ç‰Œæ—"}] },
            10: { 1: [{e:"a doctor", c:"åŒ»ç”Ÿ"}, {e:"an ambulance", c:"æ•‘æŠ¤è½¦"}, {e:"painkillers", c:"æ­¢ç—›è¯"}, {e:"some ice", c:"å†°å—"}, {e:"help", c:"å¸®åŠ©"}], 2: [{e:"dizzy", c:"å¤´æ™•"}, {e:"nauseous", c:"æ¶å¿ƒ"}, {e:"feverish", c:"å‘çƒ§"}, {e:"terrible", c:"å¾ˆç³Ÿ"}, {e:"weak", c:"è™šå¼±"}] },
            11: { 1: [{e:"speak slowly", c:"è¯´æ…¢ç‚¹"}, {e:"say that again", c:"å†è¯´ä¸€æ¬¡"}, {e:"write it down", c:"å†™ä¸‹æ¥"}, {e:"use Google Translate", c:"ç”¨è°·æ­Œç¿»è¯‘"}], 2: [{e:"understand", c:"å¬æ‡‚"}, {e:"hear you", c:"å¬æ¸…"}, {e:"get it", c:"æ˜ç™½"}, {e:"know that word", c:"æ‡‚é‚£ä¸ªè¯"}] },
            12: { 1: [{e:"return this", c:"é€€è¿™ä¸ª"}, {e:"exchange this", c:"æ¢è¿™ä¸ª"}, {e:"get a refund", c:"é€€æ¬¾"}, {e:"speak to manager", c:"æ‰¾ç»ç†"}], 2: [{e:"is broken", c:"åäº†"}, {e:"is expired", c:"è¿‡æœŸäº†"}, {e:"doesn't fit", c:"ä¸åˆèº«"}, {e:"is the wrong color", c:"é¢œè‰²é”™äº†"}] },
            13: { 1: [{e:"book a table", c:"è®¢ä½"}, {e:"make a reservation", c:"é¢„çº¦"}, {e:"cancel my appointment", c:"å–æ¶ˆé¢„çº¦"}, {e:"reschedule", c:"æ”¹æœŸ"}], 2: [{e:"7:00 PM", c:"æ™šä¸Š7ç‚¹"}, {e:"noon", c:"ä¸­åˆ"}, {e:"tomorrow morning", c:"æ˜æ—©"}, {e:"next Monday", c:"ä¸‹å‘¨ä¸€"}] }
        };

        window.onload = function() {
            document.getElementById('year').innerText = new Date().getFullYear();
            loadTheme();
            injectExtraChips();
            loadCustomChips();
            loadUsageData();
            injectSmartKeywords();
            injectShowCardDOM();
            injectChatDOM();
            injectToolboxDOM(); 
            initSpeechRecognition();
            checkMonthlyReport(); 
            autoSortUnits(); 
            
            for (let i = 1; i <= 13; i++) {
                if(document.getElementById(`u${i}`)) {
                    restoreSelection(i, 1);
                    restoreSelection(i, 2);
                }
            }
            
            setTimeout(() => { initBubbleTip(); }, 1000);
            initScrollHints();
            rebuildActionButtons(); 
            
            // ğŸš€ æ ¸å¿ƒä¿®å¤ï¼šæ³¨å†Œå…¨å±€ç‚¹å‡»ç›‘å¬ï¼Œè§£å†³æ‰€æœ‰æŒ‰é’®ï¼ˆå«å…‹éš†ä½“ï¼‰çš„ç‚¹å‡»å¤±æ•ˆé—®é¢˜
            initGlobalClickListeners();
            
            addFloatingControls(); 
            startSmartSearchAnimation();
            
            resetIdleTimer();
            ['touchstart','click','scroll'].forEach(e => document.addEventListener(e, resetIdleTimer));
        };

        // --- ğŸš€ å…¨å±€äº‹ä»¶å§”æ‰˜ (è§£å†³å…‹éš†ä½“ç‚¹å‡»å¤±æ•ˆ + åº•éƒ¨å–‡å­ä¿®å¤) ---
        function initGlobalClickListeners() {
            document.body.addEventListener('click', function(e) {
                // 1. ç›‘å¬åº•éƒ¨â€œé€»è¾‘æ„é€ â€çš„å–‡å­ (.combo-audio-btn)
                const comboBtn = e.target.closest('.combo-audio-btn');
                if (comboBtn) {
                    e.stopPropagation();
                    triggerHaptic();
                    const container = comboBtn.closest('.combo-box');
                    if (container) {
                        // æ‰¾åŒçº§é‡Œçš„æ–‡å­—
                        const textEl = container.querySelector('.combo-text');
                        if (textEl) speakDirect(textEl.innerText);
                    }
                    return;
                }
                
                // 2. è¿™é‡Œä¹Ÿå¯ä»¥æ‰©å±•ç›‘å¬å…¶ä»–åŠ¨æ€ç”Ÿæˆçš„å…ƒç´ ...
            });
        }

        // --- åœºæ™¯æœç´¢å¼•å¯¼ ---
        function startSmartSearchAnimation() {
            const input = document.getElementById('searchBox');
            const hour = new Date().getHours();
            
            let prompts = [
                { t: "å®Œå…¨å¬ä¸æ‡‚å¯¹æ–¹è¯´ä»€ä¹ˆï¼Ÿ", k: "ç¿»è¯‘" },
                { t: "æ‰¾ä¸åˆ°æ´—æ‰‹é—´å¾ˆå°´å°¬ï¼Ÿ", k: "å†…æ€¥" }
            ];

            if (hour >= 5 && hour < 10) { 
                prompts.push({ t: "èµ¶æ—¶é—´ä¸Šç­æ€•è¿Ÿåˆ°ï¼Ÿ", k: "æ‰“è½¦" });
                prompts.push({ t: "åˆšæ¬æ¥è¿˜æ²¡è®¤è¯†é‚»å±…ï¼Ÿ", k: "é‚»å±…" });
            } else if (hour >= 11 && hour < 14) { 
                prompts.push({ t: "ä¸çŸ¥é“è¯¥æ€ä¹ˆç‚¹é¤ï¼Ÿ", k: "ç‚¹é¤" });
                prompts.push({ t: "å’ŒåŒäº‹åƒé¥­æ€•å†·åœºï¼Ÿ", k: "èŠå¤©" });
                prompts.push({ t: "ä¹°å•æ—¶æƒ³AAåˆ¶ï¼Ÿ", k: "AA" });
            } else if (hour >= 14 && hour < 18) { 
                prompts.push({ t: "ä¸‹ç­æƒ³å»å–æ¯å’–å•¡ï¼Ÿ", k: "å’–å•¡" });
                prompts.push({ t: "é“¶è¡ŒæŸœå‘˜æ²¡æœ‰ä¸­æ–‡æœåŠ¡ï¼Ÿ", k: "é“¶è¡Œ" });
                prompts.push({ t: "ä¹°çš„ä¸œè¥¿ä¸åˆé€‚æƒ³é€€ï¼Ÿ", k: "é€€è´§" });
            } else if (hour >= 18 && hour < 22) { 
                prompts.push({ t: "æ™šä¸Šèšä¼šæƒ³è¯·å®¢ï¼Ÿ", k: "ä¹°å•" });
                prompts.push({ t: "ä¸æƒ³åšé¥­æƒ³å«å¤–å–ï¼Ÿ", k: "å¤–å–" });
            } else { 
                prompts.push({ t: "åŠå¤œå›å®¶è¦æ‰“Uberï¼Ÿ", k: "æ‰“è½¦" });
                prompts.push({ t: "èº«ä½“ä¸èˆ’æœæƒ³çœ‹åŒ»ç”Ÿï¼Ÿ", k: "æ•‘å‘½" });
                prompts.push({ t: "é‡åˆ°ç´§æ€¥æƒ…å†µï¼Ÿ", k: "è­¦å¯Ÿ" });
            }

            prompts.sort(() => Math.random() - 0.5);
            let idx = 0;
            updatePlaceholder();

            setInterval(() => {
                if (document.activeElement === input && input.value !== "") return; 
                input.classList.add('fade-text');
                setTimeout(() => {
                    idx = (idx + 1) % prompts.length;
                    updatePlaceholder();
                    input.classList.remove('fade-text');
                }, 500); 
            }, 5000);

            function updatePlaceholder() {
                const item = prompts[idx];
                input.setAttribute('placeholder', `${item.t} æœ "${item.k}" è¯•è¯•...`);
            }
        }

        // --- å…¶ä»–é€»è¾‘ä¿æŒ V33.0 ç¨³å®šç‰ˆ ---
        function speakWholeSentence(wordId, p, x) {
            const wordEl = document.getElementById(wordId);
            if(wordEl) {
                const container = wordEl.closest('.text-content');
                if (container) speakDirect(container.innerText);
            }
        }
        function injectExtraChips() { for (let u = 1; u <= 13; u++) { for (let s = 1; s <= 2; s++) { const container = document.getElementById(`u${u}-s${s}-chips`); if (!container || !extraVocab[u] || !extraVocab[u][s]) continue; const existing = Array.from(container.querySelectorAll('.chip')).map(c => c.innerText); const wrapper = container.querySelector('.add-btn-wrapper'); extraVocab[u][s].forEach(item => { if (!existing.includes(item.e)) { const btn = document.createElement('div'); btn.className = 'chip'; btn.innerText = item.e; btn.onclick = function() { updateUnit(u, s, item.e, item.c, "", "", this); }; if(wrapper) container.insertBefore(btn, wrapper); else container.appendChild(btn); } }); } } }
        function initBubbleTip(targetCard) { if (!targetCard) targetCard = document.querySelector('#content-area .unit-card:not(.clone)'); if (!targetCard) return; const wrapper = targetCard.querySelector('.step-container .chips-container .add-btn-wrapper'); if (wrapper) { if(wrapper.querySelector('.bubble-tip')) return; const bubble = document.createElement('div'); bubble.className = 'bubble-tip'; bubble.innerText = 'æ²¡æ‰¾åˆ°ä½ æƒ³è¦çš„ï¼Ÿç°åœ¨å¯ä»¥ç‚¹å‡»æ·»åŠ ï¼'; wrapper.appendChild(bubble); setTimeout(() => { dismissBubble(bubble); }, 15000); } }
        function dismissBubble(element) { if(element) { element.classList.add('fade-out'); setTimeout(() => { element.remove(); }, 600); } }
        function autoSortUnits() { const container = document.getElementById('content-area'); const cards = Array.from(container.querySelectorAll('.unit-card:not(.clone)')); const hour = new Date().getHours(); let timeWeights = {}; if (hour >= 5 && hour < 10) { timeWeights = { 1: 50, 9: 40, 4: 30 }; } else if (hour >= 11 && hour < 14) { timeWeights = { 6: 50, 7: 40, 5: 30 }; } else if (hour >= 17 && hour < 21) { timeWeights = { 8: 50, 7: 40, 6: 30 }; } else if (hour >= 21 || hour < 4) { timeWeights = { 9: 60, 10: 50, 3: 40 }; } cards.sort((a, b) => { const idA = parseInt(a.id.replace('u', '')); const idB = parseInt(b.id.replace('u', '')); let scoreA = usageData[idA] || 0; let scoreB = usageData[idB] || 0; scoreA += (timeWeights[idA] || 0); scoreB += (timeWeights[idB] || 0); return scoreB - scoreA; }); container.innerHTML = ""; cards.forEach(card => container.appendChild(card)); initInfiniteLoop(container, cards); }
        function initInfiniteLoop(container, cards) { container.querySelectorAll('.snap-spacer, .unit-card.clone').forEach(el => el.remove()); if (cards.length < 2) return; const firstCard = cards[0]; const lastCard = cards[cards.length - 1]; setTimeout(() => initBubbleTip(firstCard), 500); const cloneFirst = firstCard.cloneNode(true); const cloneLast = lastCard.cloneNode(true); [cloneFirst, cloneLast].forEach(el => { el.classList.add('clone'); el.id = ""; el.querySelectorAll('[id]').forEach(c => c.removeAttribute('id')); }); const spacerStart = document.createElement('div'); spacerStart.className = 'snap-spacer'; const spacerEnd = document.createElement('div'); spacerEnd.className = 'snap-spacer'; container.insertBefore(spacerStart, container.firstChild); container.insertBefore(cloneLast, container.firstChild.nextSibling); container.appendChild(cloneFirst); container.appendChild(spacerEnd); requestAnimationFrame(() => { container.style.scrollBehavior = 'auto'; const offset = firstCard.offsetLeft - container.offsetLeft - (window.innerWidth * 0.075); container.scrollLeft = offset; setTimeout(() => { container.style.scrollBehavior = 'smooth'; }, 50); }); container.onscroll = () => { const sl = container.scrollLeft; const sw = container.scrollWidth; const cw = container.clientWidth; const buf = 10; if (sw - (sl + cw) < buf) { container.style.scrollBehavior = 'auto'; container.scrollLeft = firstCard.offsetLeft - (window.innerWidth * 0.075); requestAnimationFrame(() => { setTimeout(() => container.style.scrollBehavior = 'smooth', 50); }); } if (sl < buf) { container.style.scrollBehavior = 'auto'; container.scrollLeft = lastCard.offsetLeft - (window.innerWidth * 0.075); requestAnimationFrame(() => { setTimeout(() => container.style.scrollBehavior = 'smooth', 50); }); } }; }
        function rebuildActionButtons() { for(let i=1; i<=13; i++) { const card = document.getElementById(`u${i}`); if(!card) continue; const steps = card.querySelectorAll('.step-container'); steps.forEach((step, index) => { const displayArea = step.querySelector('.display-area'); if(displayArea) { const s = index + 1; const oldBtns = displayArea.querySelectorAll('button'); oldBtns.forEach(b => b.remove()); let group = displayArea.querySelector('.action-group'); if(!group) { group = document.createElement('div'); group.className = 'action-group'; displayArea.appendChild(group); } const btnAudio = createMiniBtn('ğŸ”Š', () => { const wordEl = document.getElementById(`u${i}-s${s}-word`); if(wordEl) speakWholeSentence(wordEl.id, "", ""); }); group.appendChild(btnAudio); const btnMic = createMiniBtn('ğŸ™ï¸', function(e) { const wordEl = document.getElementById(`u${i}-s${s}-word`); if(wordEl) startSimpleListening(this, wordEl.parentElement.innerText); }); btnMic.classList.add('btn-mic'); group.appendChild(btnMic); const btnShow = createMiniBtn('ğŸ‘ï¸', () => { const wordEl = document.getElementById(`u${i}-s${s}-word`); const transEl = document.getElementById(`u${i}-s${s}-trans`); if(wordEl && transEl) openShowCard(wordEl.parentElement.innerText, transEl.innerText); }); group.appendChild(btnShow); } }); } }
        function createMiniBtn(icon, onClick) { const btn = document.createElement('button'); btn.className = 'btn-mini'; btn.innerHTML = icon; btn.onclick = (e) => { e.stopPropagation(); triggerHaptic(); onClick.call(btn, e); }; return btn; }
        let simpleTarget = "";
        function startSimpleListening(btn, text) { if (!recognition) { alert("Browser not supported"); return; } triggerHaptic(); simpleTarget = text.toLowerCase().replace(/[.,?!]/g, '').trim(); recognition.onresult = (e) => { const spoken = e.results[e.results.length-1][0].transcript; handleSimpleResult(spoken); btn.classList.remove('listening'); }; recognition.onend = () => btn.classList.remove('listening'); document.querySelectorAll('.btn-mic').forEach(b => b.classList.remove('listening')); btn.classList.add('listening'); try { recognition.start(); showToast("ğŸ¤ è¯·å¤§å£°æœ—è¯»..."); } catch(e){} }
        function handleSimpleResult(spoken) { const cleanSpoken = spoken.toLowerCase().replace(/[.,?!]/g, '').trim(); if (cleanSpoken.includes(simpleTarget) || simpleTarget.includes(cleanSpoken)) { showToast(`ğŸ‰ å¤ªæ£’äº†ï¼å®Œç¾å‘éŸ³ï¼\n"${spoken}"`); triggerHaptic(); } else { showToast(`ğŸ¤” å†è¯•ä¸€æ¬¡ï¼Œå¬èµ·æ¥åƒï¼š\n"${spoken}"`); } }
        function addBotMsg(text, chips=[], autoMic=false, callback=null) { const body = document.getElementById('chatBody'); const d = document.createElement('div'); d.className='msg bot'; d.innerText=text; body.appendChild(d); if(chips.length>0){ const g = document.createElement('div'); g.className='msg-btn-group'; chips.forEach(c=>{const b=document.createElement('div');b.className='msg-chip';b.innerText=c.text;b.onclick=()=>c.action();g.appendChild(b);}); body.appendChild(g); } speakDirect(text, ()=>{ if(autoMic) startChatListening(); if(callback) callback(); }); body.scrollTop = body.scrollHeight; }
        function processAnswer(spokenText) { aiState.waitingForSpeech = false; if(aiState.silenceTimer) clearTimeout(aiState.silenceTimer); addUserMsg(spokenText); const target = aiState.currentTargetEng.toLowerCase().replace(/[^a-z ]/g, ""); const spoken = spokenText.toLowerCase().replace(/[^a-z ]/g, ""); const targetWords = target.split(" "); let matchCount = 0; targetWords.forEach(w => { if(spoken.includes(w)) matchCount++; }); const accuracy = matchCount / targetWords.length; if(accuracy >= 0.5) { aiState.score++; triggerHaptic(); addBotMsg("âœ… å›ç­”æ­£ç¡®ï¼å¤ªæ£’äº†ï¼", [], false, () => { setTimeout(() => { aiState.currentStep++; askQuestion(); }, 2000); }); } else { triggerHaptic(); if(navigator.vibrate) navigator.vibrate(100); addBotMsg(`âŒ å·®ç‚¹æ„æ€ï¼Œæ­£ç¡®è¯»æ³•æ˜¯ï¼š\n"${aiState.currentTargetEng}"`, [], false, () => { speakDirect(aiState.currentTargetEng, () => { setTimeout(() => { aiState.currentStep++; askQuestion(); }, 3000); }); }); } aiState.total++; }
        function endChat(completed) { aiState.active = false; if(aiState.silenceTimer) clearTimeout(aiState.silenceTimer); if(recognition) try { recognition.abort(); } catch(e){} document.getElementById('chatMicBtn').classList.remove('active'); let msg = "ç»ƒä¹ ç»“æŸï¼Œä¸‹æ¬¡ç»§ç»­ï¼"; if(completed && aiState.total > 0) { const pct = Math.round((aiState.score / aiState.total) * 100); msg = `ç»ƒä¹ å®Œæˆï¼ğŸ‰\næ­£ç¡®ç‡ ${pct}%ã€‚ç»§ç»­åŠ æ²¹ï¼`; } addBotMsg(msg, [], false, () => { setTimeout(() => { const overlay = document.getElementById('chatOverlay'); if(overlay) overlay.style.display = 'none'; }, 6000); }); }
        function askQuestion() { if(!aiState.active) return; const u = aiState.currentUnit; const s = aiState.currentStep; const wordEl = document.getElementById(`u${u}-s${s}-word`); const transEl = document.getElementById(`u${u}-s${s}-trans`); if(!wordEl || s > 2) { endChat(true); return; } const targetEng = wordEl.parentElement.innerText; aiState.currentTargetEng = targetEng; let targetCn = transEl.innerText; const savedData = JSON.parse(localStorage.getItem(`u${u}-s${s}`)); if(savedData) targetCn = getFullChineseSentence(u, s, savedData.cnWord, savedData.suffix); aiState.currentTargetCn = targetCn; addBotMsg(`Please translate:\n"${targetCn}"`, [], true); aiState.waitingForSpeech = true; if(aiState.silenceTimer) clearTimeout(aiState.silenceTimer); aiState.silenceTimer = setTimeout(() => { if(aiState.waitingForSpeech && aiState.active) { speakDirect("Are you there?", () => { startChatListening(); }); } }, 20000); }
        function manualMicClick() { if(aiState.waitingForSpeech) startChatListening(); else showToast("Wait for my question!"); }
        function initSpeechRecognition() { if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) { const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition; recognition = new SpeechRecognition(); recognition.lang = 'en-US'; recognition.interimResults = false; recognition.maxAlternatives = 1; recognition.onresult = (e) => { console.log(e.results[0][0].transcript); }; } }
        function speakDirect(text, callback) { window.speechSynthesis.cancel(); const hasEnglishContext = /[a-zA-Z]{2,}/.test(text); const utterance = new SpeechSynthesisUtterance(text); utterance.lang = hasEnglishContext ? 'en-US' : 'zh-CN'; utterance.rate = 0.9; if(callback) utterance.onend = callback; window.speechSynthesis.speak(utterance); }
        function injectChatDOM() { const div = document.createElement('div'); div.id = 'chatOverlay'; div.className = 'chat-overlay'; div.innerHTML = `<div class="chat-header"><span>ğŸ¤– AI Oral Tutor</span><span onclick="toggleChat()" style="cursor:pointer;font-size:1.2em;">âœ•</span></div><div class="chat-body" id="chatBody"></div><div class="chat-footer"><button id="chatMicBtn" class="mic-wave" onclick="manualMicClick()">ğŸ™ï¸</button><button class="nav-btn" onclick="endChat(false)" style="background:#ff3b30;color:white;border:none;">End</button></div>`; document.body.appendChild(div); }
        function addUserMsg(text) { const b=document.getElementById('chatBody'); const d=document.createElement('div'); d.className='msg user'; d.innerText=text; b.appendChild(d); b.scrollTop=b.scrollHeight; }
        function startChatListening() { if (!recognition) return; if (!aiState.active) return; const btn = document.getElementById('chatMicBtn'); btn.classList.add('active'); try { recognition.start(); } catch(e) {} recognition.onresult = (event) => { const last = event.results.length - 1; const text = event.results[last][0].transcript; processAnswer(text); }; recognition.onend = () => { btn.classList.remove('active'); }; }
        function getFullChineseSentence(u, s, cnWord, suffix) { let cw = cnWord; let sfx = suffix || "ã€‚"; let full = ""; if(sfx === 'å—' || sfx === '?') sfx = "å—ï¼Ÿ"; switch(u) { case 1: full = (s===1) ? `å—¨ï¼Œæˆ‘æ˜¯${cw}ã€‚` : `æˆ‘ä½åœ¨${cw}ã€‚`; break; case 2: full = (s===1) ? `æ‰“æ‰°ä¸€ä¸‹ï¼Œæˆ‘åœ¨æ‰¾${cw}ã€‚` : `èƒ½å‘Šè¯‰æˆ‘${cw}${sfx}`; break; case 3: full = (s===1) ? `æˆ‘èƒ½å€Ÿç”¨ä¸€ä¸‹æ‚¨çš„${cw}${sfx}` : `çœŸçš„å¾ˆæœ‰${cw}ã€‚`; break; case 4: full = (s===1) ? `æˆ‘æƒ³${cw}ã€‚` : `è¿™æ˜¯æˆ‘çš„${cw}ã€‚`; break; case 5: full = (s===1) ? `æˆ‘æƒ³ç”¨${cw}æ”¯ä»˜ã€‚` : `ä½ ä»¬æä¾›${cw}${sfx}`; break; case 6: full = (s===1) ? `æˆ‘æƒ³è¦${cw}ã€‚` : `è¯·ä¸è¦${cw}ã€‚`; break; case 7: full = (s===1) ? `å’±ä»¬${cw}å§ã€‚` : `ä»Šå¤©${cw}ã€‚`; break; case 8: full = (s===1) ? `å¥½ä¹…ä¸è§ï¼${cw}æ€ä¹ˆæ ·ï¼Ÿ` : `æˆ‘ä»¬åº”è¯¥${cw}ã€‚`; break; case 9: full = (s===1) ? `æˆ‘è¦å»${cw}ã€‚` : `å°±åœ¨${cw}ä¸‹è½¦ã€‚`; break; case 10: full = (s===1) ? `æˆ‘éœ€è¦${cw}ã€‚` : `æˆ‘æ„Ÿåˆ°${cw}ã€‚`; break; case 11: full = (s===1) ? `èƒ½${cw}å—ï¼Ÿ` : `æˆ‘ä¸${cw}ã€‚`; break; case 12: full = (s===1) ? `æˆ‘æƒ³${cw}ã€‚` : `å®ƒ${cw}ã€‚`; break; case 13: full = (s===1) ? `æˆ‘æƒ³${cw}ã€‚` : `åœ¨${cw}ã€‚`; break; default: full = cw + sfx; } if(u===3 && s===2) { if(cw.includes('æ€¥')) full = "çœŸçš„å¾ˆç´§æ€¥ã€‚"; if(cw.includes('å¿«')) full = "ä¼šå¾ˆå¿«å°±å¥½ã€‚"; } return full; }
        function startAiSession() { aiState.active = true; aiState.score = 0; aiState.total = 0; document.getElementById('chatBody').innerHTML = ''; addBotMsg("Hi there! I'm your AI tutor. Want to practice English?", [{ text: "Yes, let's go!", action: askForScenario }, { text: "Not now", action: () => { toggleChat(); aiState.active = false; } }]); }
        function askForScenario() { addUserMsg("Yes, let's go!"); let ops = []; for(let i=1; i<=13; i++) { const c = document.getElementById(`u${i}`); if(c) { const name = c.getAttribute('data-name'); ops.push({ text: name, action: () => startUnitPractice(i) }); } } addBotMsg("Great! Which scenario do you want to practice?", ops); }
        function startUnitPractice(uid) { addUserMsg(`Unit ${uid}`); aiState.currentUnit = uid; aiState.currentStep = 1; addBotMsg("Awesome choice! Let's start!"); setTimeout(askQuestion, 1500); }
        function resetIdleTimer() { if(aiState.active) return; if(aiState.idleTimer) clearTimeout(aiState.idleTimer); aiState.idleTimer = setTimeout(triggerIdleAlert, 60000); }
        let idleLoopTimer = null;
        function triggerIdleAlert() { if(aiState.active) return; document.getElementById('robotBadge').style.display = 'block'; const bubble = document.getElementById('robotBubble'); if(bubble) { bubble.classList.add('visible'); triggerHaptic(); setTimeout(() => { bubble.classList.remove('visible'); idleLoopTimer = setTimeout(triggerIdleAlert, 60000); }, 10000); } }
        function addFloatingControls() { const c=document.querySelector('.float-controls'); const w=document.createElement('div'); w.style.position='relative'; const b=document.createElement('div'); b.id='robotBubble'; b.className='robot-speech-bubble'; b.innerText='å˜¿ï¼æƒ³ç»ƒç»ƒå£è¯­å—ï¼Ÿç‚¹æˆ‘ï¼'; w.appendChild(b); const btn=document.createElement('button'); btn.className='fab-robot'; btn.innerHTML='ğŸ¤–<div class="robot-badge" id="robotBadge"></div>'; btn.title="AI é™ªç»ƒ"; btn.onclick=()=>{ triggerHaptic(); resetIdleTimer(); toggleChat(); if(document.getElementById('chatBody').innerHTML.trim()==="") startAiSession(); }; w.appendChild(btn); c.insertBefore(w, c.firstChild); const t=document.createElement('button'); t.className='fab-tools'; t.innerHTML='ğŸ§°'; t.onclick=openToolbox; c.insertBefore(t, c.firstChild); }
        function toggleChat() { const el = document.getElementById('chatOverlay'); const isHidden = el.style.display === 'none' || el.style.display === ''; el.style.display = isHidden ? 'flex' : 'none'; document.getElementById('robotBadge').style.display = 'none'; if(isHidden) { const body = document.getElementById('chatBody'); body.scrollTop = body.scrollHeight; } }
        function injectToolboxDOM(){if(document.getElementById('toolOverlay'))return;const d=document.createElement('div');d.id='toolOverlay';d.className='tool-overlay';d.onclick=(e)=>{if(e.target===d)d.style.display='none';};d.innerHTML=`<div class="tool-card"><div class="tool-tabs"><div class="tool-tab active" onclick="switchTool(0)">ğŸŒ¡ï¸ æ¢ç®—</div><div class="tool-tab" onclick="switchTool(1)">ğŸ’µ å°è´¹</div></div><div class="tool-section active" id="tool-calc"><div class="calc-row"><input type="number" class="calc-input" id="inp-f" placeholder="Â°F" oninput="convert('f')"><span class="calc-label">Â°F</span><span class="calc-eq">â‡Œ</span><input type="number" class="calc-input" id="inp-c" placeholder="Â°C" oninput="convert('c')"><span class="calc-label">Â°C</span></div><div class="calc-row"><input type="number" class="calc-input" id="inp-lb" placeholder="lb" oninput="convert('lb')"><span class="calc-label">lb</span><span class="calc-eq">â‡Œ</span><input type="number" class="calc-input" id="inp-kg" placeholder="kg" oninput="convert('kg')"><span class="calc-label">kg</span></div><div class="calc-row"><input type="number" class="calc-input" id="inp-oz" placeholder="oz" oninput="convert('oz')"><span class="calc-label">oz</span><span class="calc-eq">â‡Œ</span><input type="number" class="calc-input" id="inp-ml" placeholder="ml" oninput="convert('ml')"><span class="calc-label">ml</span></div></div><div class="tool-section" id="tool-tip"><div class="calc-row" style="justify-content:center;"><span style="font-weight:bold;">æ¶ˆè´¹ $</span><input type="number" class="calc-input" id="inp-bill" placeholder="0.00" style="width:150px;" oninput="calcTip()"></div><div class="tip-grid"><div class="tip-box"><span class="tip-pct">15%</span><span class="tip-val" id="tip-15">$0</span></div><div class="tip-box"><span class="tip-pct">18%</span><span class="tip-val" id="tip-18">$0</span></div><div class="tip-box"><span class="tip-pct">20%</span><span class="tip-val" id="tip-20">$0</span></div></div></div></div>`;document.body.appendChild(d);}
        function switchTool(idx){triggerHaptic();document.querySelectorAll('.tool-tab').forEach((t,i)=>t.classList.toggle('active',i===idx));document.querySelectorAll('.tool-section').forEach((s,i)=>s.classList.toggle('active',i===idx));}
        function convert(t){const f=document.getElementById('inp-f'),c=document.getElementById('inp-c'),lb=document.getElementById('inp-lb'),kg=document.getElementById('inp-kg'),oz=document.getElementById('inp-oz'),ml=document.getElementById('inp-ml');if(t==='f')c.value=f.value?((f.value-32)*5/9).toFixed(1):'';if(t==='c')f.value=c.value?((c.value*9/5)+32).toFixed(1):'';if(t==='lb')kg.value=lb.value?(lb.value*0.453).toFixed(1):'';if(t==='kg')lb.value=kg.value?(kg.value/0.453).toFixed(1):'';if(t==='oz')ml.value=oz.value?(oz.value*29.57).toFixed(1):'';if(t==='ml')oz.value=ml.value?(ml.value/29.57).toFixed(1):'';}
        function calcTip(){const b=parseFloat(document.getElementById('inp-bill').value)||0;document.getElementById('tip-15').innerText='$'+(b*1.15).toFixed(2);document.getElementById('tip-18').innerText='$'+(b*1.18).toFixed(2);document.getElementById('tip-20').innerText='$'+(b*1.20).toFixed(2);}
        function openToolbox(){triggerHaptic();document.getElementById('toolOverlay').style.display='flex';}
        function closeToolbox(){document.getElementById('toolOverlay').style.display='none';}
        function injectSmartKeywords(){/*...*/}
        function injectShowCardDOM(){if(!document.getElementById('showCardOverlay')){const d=document.createElement('div');d.id='showCardOverlay';d.className='show-card-overlay';d.onclick=closeShowCard;d.innerHTML=`<div class="show-card-text" id="showCardEng"></div><div class="show-card-sub" id="showCardCn"></div><div class="show-card-hint">ç‚¹å‡»ä»»æ„å¤„å…³é—­</div>`;document.body.appendChild(d);}}
        function openShowCard(e,c){document.getElementById('showCardEng').innerText=e;document.getElementById('showCardCn').innerText=c;document.getElementById('showCardOverlay').style.display='flex';}
        function closeShowCard(){document.getElementById('showCardOverlay').style.display='none';}
        function showToast(m){let t=document.getElementById('speechToast');if(!t){t=document.createElement('div');t.id='speechToast';t.className='speech-result-toast';document.body.appendChild(t);}t.innerText=m;t.style.display='block';setTimeout(()=>{t.style.display='none';},3000);}
        function triggerHaptic(){if(navigator.vibrate)navigator.vibrate(15);}
        function initScrollHints(){const cards=document.querySelectorAll('.unit-card');cards.forEach(card=>{if(card.scrollHeight>card.clientHeight)card.querySelector('.scroll-hint')?.classList.add('visible');card.addEventListener('scroll',function(){this.querySelector('.scroll-hint')?.classList.remove('visible');});});}
        function dismissBubble(e){if(e){e.classList.add('fade-out');setTimeout(()=>{e.remove();},1000);}}
        function addCustomChip(u,s,p,x){triggerHaptic();const e=prompt("English:");if(!e)return;const c=prompt("Chinese:");if(!c)return;const d={unitNum:u,stepNum:s,eng:e,cn:c,prefix:p,suffix:x};const k=`custom_chips_u${u}_s${s}`;let l=JSON.parse(localStorage.getItem(k)||"[]");l.push(d);localStorage.setItem(k,JSON.stringify(l));renderAndClickChip(d,true);}
        function toggleEmergency(){triggerHaptic();document.getElementById('emergencyOverlay').classList.toggle('active');}
        function loadUsageData(){usageData=JSON.parse(localStorage.getItem('unit_usage')||"{}");}
        function incrementUsage(u){usageData[u]=(usageData[u]||0)+1;localStorage.setItem('unit_usage',JSON.stringify(usageData));}
        function checkMonthlyReport(){/*...*/ }
        function showMonthlySummary(m){/*...*/ }
        function startRandomDrill(){triggerHaptic();const u=Math.floor(Math.random()*13)+1;const c=document.getElementById(`u${u}`);if(!c){startRandomDrill();return;}document.getElementById('modalQuestion').innerText=c.querySelector('.unit-header').innerText;document.getElementById('randomModal').style.display='flex';currentRandomUnit=u;}
        function closeModal(id){document.getElementById(id).style.display='none';}
        function revealRandomAnswer(){closeModal('randomModal');scrollToUnit(`u${currentRandomUnit}`);}
        function scrollToUnit(id){document.getElementById(id)?.scrollIntoView({behavior:'smooth',block:'nearest',inline:'center'});}
        function toggleTheme(){triggerHaptic();const h=document.documentElement;const n=h.getAttribute('data-theme')==='light'?'dark':'light';h.setAttribute('data-theme',n);localStorage.setItem('theme',n);}
        function loadTheme(){const s=localStorage.getItem('theme');if(s)document.documentElement.setAttribute('data-theme',s);}
        function filterUnits(){const filter=document.getElementById('searchBox').value.toLowerCase();const cards=document.getElementsByClassName('unit-card');for(let card of cards){const text=card.innerText.toLowerCase();const keys=card.getAttribute('data-keywords')||"";card.style.display=(text.includes(filter)||keys.includes(filter))?"":"none";} document.getElementById('content-area').scrollTo(0,0);}
        function loadCustomChips(){for(let u=1;u<=13;u++)for(let s=1;s<=2;s++)JSON.parse(localStorage.getItem(`custom_chips_u${u}_s${s}`)||"[]").forEach(d=>renderAndClickChip(d,false));}
        function renderAndClickChip(d,t){const c=document.getElementById(`u${d.unitNum}-s${d.stepNum}-chips`);if(!c)return;const b=document.createElement('div');b.className='chip';b.innerText=d.eng;b.onclick=()=>{updateUnit(d.unitNum,d.stepNum,d.eng,d.cn,d.prefix,d.suffix,b);};const w=c.querySelector('.add-btn-wrapper');c.insertBefore(b,w||c.firstChild);if(t)b.click();}
        function updateCustomChipInStorage(d,n){const k=`custom_chips_u${d.unitNum}_s${d.stepNum}`;let l=JSON.parse(localStorage.getItem(k)||"[]");if(n==="")l=l.filter(i=>i.eng!==d.eng);else{const i=l.findIndex(x=>x.eng===d.eng);if(i>-1)l[i].eng=n;}localStorage.setItem(k,JSON.stringify(l));}
        function toggleQuizMode(){triggerHaptic();document.body.classList.toggle('quiz-mode');}
        function updateUnit(unitNum,stepNum,engWord,cnWord,prefixEng,suffixCn,element,playSound=true){triggerHaptic();incrementUsage(unitNum);const wordId=`u${unitNum}-s${stepNum}-word`;const displayEl=document.getElementById(wordId);if(displayEl)displayEl.innerText=engWord;const fullCn=getFullChineseSentence(unitNum,stepNum,cnWord,suffixCn);document.getElementById(`u${unitNum}-s${stepNum}-trans`).innerText=fullCn;let container=element.parentElement;container.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));if(element.classList.contains('chip'))element.classList.add('active');localStorage.setItem(`u${unitNum}-s${stepNum}`,JSON.stringify({engWord,cnWord,prefix:prefixEng,suffix:suffixCn}));if(playSound)speakDirect(engWord);}
        function restoreSelection(unitNum,stepNum){const savedData=localStorage.getItem(`u${unitNum}-s${stepNum}`);if(savedData){const data=JSON.parse(savedData);const container=document.getElementById(`u${unitNum}-s${stepNum}-chips`);if(container){const chips=container.querySelectorAll('.chip');for(let chip of chips){if(chip.innerText===data.engWord){updateUnit(unitNum,stepNum,data.engWord,data.cnWord,data.prefix,data.suffix,chip,false);break;}}}}}
        function speakWholeSentence(wordId,p,x){const wordEl=document.getElementById(wordId);if(wordEl)speakDirect(wordEl.parentElement.innerText);}
    </script>
</body>
</html>
      
