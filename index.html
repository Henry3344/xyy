<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Survival English Guide</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ç”Ÿå­˜è‹±è¯­">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1c1c1e">
    
    <style>
        /* === V36.0 æœ€ç»ˆå®Œæ•´æ ·å¼è¡¨ === */
        :root {
            --bg-body: #f2f2f7; --bg-card: #ffffff; --text-main: #1c1c1e; --text-sub: #8e8e93;
            --primary: #007aff; --primary-light: #e5f1ff; --border: #c6c6c8;
            --chip-bg: #ffffff; --chip-border: #d1d1d6; --nav-bg: rgba(255,255,255,0.95);
            --shadow: rgba(0,0,0,0.08); --display-area: #f2f2f7; --danger: #ff3b30; --accent: #5856d6;
            --hint-bg: rgba(255, 255, 255, 0.85); --gold: #ffcc00;
        }
        [data-theme="dark"] {
            --bg-body: #000000; --bg-card: #1c1c1e; --text-main: #ffffff; --text-sub: #aeaeb2;
            --primary: #0a84ff; --primary-light: #1c1c1e; --border: #38383a; --chip-bg: #2c2c2e;
            --chip-border: #3a3a3c; --nav-bg: rgba(28,28,30,0.95); --shadow: rgba(255,255,255,0.05);
            --display-area: #2c2c2e; --danger: #ff453a; --accent: #5e5ce6;
            --hint-bg: rgba(28, 28, 30, 0.85); --gold: #ffd60a;
        }

        html, body { height: 100%; overflow: hidden; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg-body); color: var(--text-main); display: flex; flex-direction: column; transition: background 0.3s; -webkit-tap-highlight-color: transparent; }
        
        /* é¡¶éƒ¨å¯¼èˆªä¿®å¤ */
        .header-container { flex: 0 0 auto; background: var(--nav-bg); backdrop-filter: blur(15px); z-index: 1000; border-bottom: 1px solid var(--border); padding-top: env(safe-area-inset-top); }
        .top-row { display: flex; align-items: center; justify-content: space-between; padding: 10px 15px; max-width: 650px; margin: 0 auto; }
        
        /* æ ‡é¢˜ç»„ï¼šè§£å†³é”™ä½é—®é¢˜çš„æ ¸å¿ƒ */
        .title-group { display: flex; align-items: center; gap: 8px; }
        .app-title { font-size: 1.1em; font-weight: 800; margin: 0; }
        .level-badge { background: var(--gold); color: black; padding: 2px 8px; border-radius: 10px; font-size: 0.7em; font-weight: 900; box-shadow: 0 2px 5px rgba(255, 204, 0, 0.3); transition: transform 0.2s; cursor: default; }
        .level-badge.bump { transform: scale(1.3); }

        .header-actions { display: flex; gap: 12px; }
        .icon-btn { background: none; border: 1px solid var(--border); color: var(--text-main); width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .icon-btn.danger { border-color: var(--danger); color: var(--danger); }
        
        .search-row { padding: 0 15px 8px 15px; max-width: 650px; margin: 0 auto; }
        .search-input { width: 100%; padding: 8px 12px; border-radius: 10px; border: 1px solid var(--border); background: var(--bg-body); color: var(--text-main); box-sizing: border-box; outline: none; transition: color 0.5s; }
        .search-input.fade-text { color: transparent; }
        
        .nav-scroll { display: flex; overflow-x: auto; padding: 0 15px 10px 15px; gap: 8px; max-width: 650px; margin: 0 auto; scrollbar-width: none; }
        .nav-scroll::-webkit-scrollbar { display: none; }
        .nav-btn { flex: 0 0 auto; background: var(--primary-light); color: var(--primary); padding: 5px 10px; border-radius: 14px; font-weight: 600; font-size: 0.8em; text-decoration: none; cursor: pointer; }
        [data-theme="dark"] .nav-btn { border: 1px solid var(--border); }
        .nav-btn.active-nav { background: var(--primary); color: white; }

        /* å†…å®¹åŒº */
        #content-area { flex: 1; display: flex; overflow-x: auto; scroll-snap-type: x mandatory; padding: 15px 0; gap: 15px; align-items: flex-start; scroll-behavior: smooth; }
        #content-area::-webkit-scrollbar { display: none; }
        .snap-spacer { flex: 0 0 7.5vw; } 
        
        .unit-card { 
            flex: 0 0 85vw; max-width: 500px; background: var(--bg-card); 
            border-radius: 20px; padding: 20px; box-shadow: 0 8px 30px var(--shadow); 
            border: 1px solid var(--border); scroll-snap-align: center; scroll-snap-stop: always; 
            height: 98%; max-height: 85vh; overflow-y: auto; position: relative; 
            padding-bottom: 120px; /* é¿è®©åº•éƒ¨æŒ‰é’® */
            box-sizing: border-box; 
        }
        .unit-header { font-size: 1.3em; font-weight: 800; color: var(--primary); margin-bottom: 15px; border-bottom: 2px solid var(--display-area); padding-bottom: 10px; display: flex; justify-content: space-between; }
        .sort-rank { font-size: 0.6em; color: var(--text-sub); opacity: 0.5; }

        .step-container { margin-bottom: 20px; width: 100%; }
        .step-label { font-size: 0.75em; color: var(--text-sub); font-weight: 700; margin-bottom: 6px; display: block; text-transform: uppercase; }
        .pattern-box { font-family: "Menlo", monospace; color: #d63031; background: #ffeaea; padding: 2px 6px; border-radius: 4px; font-size: 1em; margin-left: 5px; border: 1px solid #ffcccc; display: inline-block; }
        [data-theme="dark"] .pattern-box { background: #3e1a1a; border-color: #5c1e1e; color: #ff6b6b; }

        .display-area { background-color: var(--display-area); padding: 12px; border-radius: 12px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; gap: 8px; border: 1px solid var(--border); width: 100%; box-sizing: border-box; }
        .text-content { flex-grow: 1; min-width: 0; margin-right: 4px; }
        .english-sentence { font-size: 1.2em; font-weight: 600; line-height: 1.25; color: var(--text-main); margin-bottom: 4px; white-space: normal; word-wrap: break-word; }
        .highlight { color: var(--primary); text-decoration: underline; text-decoration-thickness: 3px; cursor: pointer; }
        .translation { color: var(--text-sub); font-size: 0.9em; white-space: normal; }

        .action-group { display: flex; gap: 6px; flex-shrink: 0; align-items: center; }
        .btn-mini { width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1em; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); box-shadow: 0 1px 3px var(--shadow); transition: all 0.2s; }
        .btn-mini:active { transform: scale(0.92); }
        .btn-mini.listening { background: var(--danger); color: white; border-color: var(--danger); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255,59,48,0.4); } 70% { box-shadow: 0 0 0 6px rgba(255,59,48,0); } 100% { box-shadow: 0 0 0 0 rgba(255,59,48,0); } }

        .chips-container { display: flex; flex-wrap: wrap; gap: 8px; width: 100%; align-items: flex-start; }
        .chip { background: var(--chip-bg); border: 1px solid var(--chip-border); padding: 6px 12px; border-radius: 16px; font-size: 0.9em; cursor: pointer; font-weight: 600; color: var(--text-main); }
        .chip.active { background: var(--primary); color: white; border-color: var(--primary); }
        .add-btn-wrapper { display: flex; flex-direction: column; align-items: center; position: relative; } 
        .add-chip-btn { border: 1px dashed var(--text-sub); background: transparent; padding: 6px 10px; color: var(--text-sub); }
        
        .bubble-tip { position: relative; display: block; margin-top: 10px; background: var(--danger); color: white; padding: 8px 12px; border-radius: 8px; font-size: 0.8em; font-weight: bold; width: max-content; max-width: 200px; white-space: normal; line-height: 1.3; text-align: center; animation: popUp 0.3s ease-out; box-shadow: 0 4px 10px rgba(255, 59, 48, 0.4); z-index: 200; }
        .bubble-tip::after { content: ''; position: absolute; bottom: 100%; left: 50%; margin-left: -6px; border-width: 6px; border-style: solid; border-color: transparent transparent var(--danger) transparent; }
        .bubble-tip.fade-out { opacity: 0; margin-top: 0; padding: 0; height: 0; overflow: hidden; transition: all 0.5s ease; }
        @keyframes popUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .scroll-hint { position: absolute; bottom: 0; left: 0; width: 100%; text-align: center; color: var(--primary); font-size: 0.85em; padding: 12px 0; background: var(--hint-bg); backdrop-filter: blur(8px); border-radius: 0 0 20px 20px; opacity: 0; pointer-events: none; z-index: 50; transition: opacity 0.3s; font-weight: bold; }
        .scroll-hint.visible { opacity: 1; animation: float-hint 2s ease-in-out infinite; }
        @keyframes float-hint { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(5px); } }

        .divider { height: 1px; background: var(--border); margin: 20px 0; border: none; }
        .combo-box { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 15px; border-radius: 16px; margin-top: 20px; position: relative; }
        .combo-title { font-size: 0.8em; font-weight: bold; opacity: 0.8; margin-bottom: 8px; display: flex; justify-content: space-between; }
        .combo-text { padding-right: 40px; font-weight: 600; margin-bottom: 10px; line-height: 1.4; }
        
        /* åº•éƒ¨åŠŸèƒ½æŒ‰é’® */
        .combo-audio-btn { position: absolute; top: 15px; right: 15px; background: #27ae60; border: none; color: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.1em; cursor: pointer; z-index: 10; }
        .btn-slow { position: absolute; top: 15px; right: 60px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2em; cursor: pointer; z-index: 10; }

        /* æ‚¬æµ®çƒç©¿é€ä¿®å¤ */
        .float-controls { position: fixed; bottom: 40px; right: 20px; display: flex; flex-direction: column; gap: 15px; z-index: 2000; align-items: flex-end; pointer-events: none; }
        .fab-btn, .fab-quiz, .fab-random, .fab-robot, .fab-tools { width: 42px; height: 42px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.3em; border: none; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.2); position: relative; pointer-events: auto; }
        .fab-quiz { background: var(--danger); color: white; width: auto; padding: 8px 16px; border-radius: 30px; font-size: 0.85em; }
        .fab-random { background: var(--accent); color: white; }
        .fab-robot { background: #000; color: white; border: 2px solid #00ff00; }
        .robot-speech-bubble { position: absolute; bottom: 0; right: 55px; background: var(--bg-card); border: 1px solid var(--border); color: var(--text-main); padding: 8px 12px; border-radius: 12px 12px 0 12px; font-size: 0.85em; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.15); width: max-content; max-width: 160px; opacity: 0; transform: translateX(10px); transition: all 0.3s ease; pointer-events: none; }
        .robot-speech-bubble.visible { opacity: 1; transform: translateX(0); }
        .robot-speech-bubble::after { content: ''; position: absolute; bottom: 10px; right: -6px; border-width: 6px; border-style: solid; border-color: transparent transparent transparent var(--bg-card); }
        [data-theme="dark"] .robot-speech-bubble::after { border-left-color: var(--bg-card); }
        .robot-badge { position: absolute; top: -5px; right: -5px; width: 12px; height: 12px; background: #ff3b30; border-radius: 50%; border: 2px solid #fff; display: none; }
        .fab-tools { background: #ff9f0a; color: white; }

        .quiz-active-text, body.quiz-mode .quiz-default-text { display: none; }
        body.quiz-mode .quiz-active-text { display: inline; }
        body.quiz-mode .english-sentence { color: transparent !important; text-shadow: 0 0 13px rgba(128,128,128,0.5); user-select: none; }
        body.quiz-mode .english-sentence:active { color: var(--text-main) !important; text-shadow: none; }
        body.quiz-mode .pattern-box { color: transparent !important; background-color: var(--border); }
        body.quiz-mode .pattern-box:active { color: #d63031 !important; background-color: #ffeaea; }
        body.quiz-mode .combo-text { color: transparent !important; text-shadow: 0 0 10px rgba(255,255,255,0.5); }
        body.quiz-mode .combo-text:active { color: white !important; text-shadow: none; }

        .emergency-overlay, .modal-overlay, .show-card-overlay, .tool-overlay, .chat-overlay { display: none; }
        .emergency-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; flex-direction: column; padding: 20px; box-sizing: border-box; }
        .emergency-overlay.active { display: flex; }
        .emergency-close { position: absolute; top: 20px; right: 20px; color: white; font-size: 2em; cursor: pointer; }
        .emergency-card { flex: 1; display: flex; align-items: center; justify-content: center; text-align: center; border-bottom: 1px solid #333; cursor: pointer; }
        .emergency-text { font-size: 2.2em; color: #ff3b30; font-weight: bold; margin-bottom: 10px; }
        .emergency-sub { font-size: 1.2em; color: #aaa; }

        .chat-overlay { position: fixed; bottom: 90px; right: 20px; width: 85vw; max-width: 350px; height: 60vh; background: var(--bg-card); border-radius: 20px; box-shadow: 0 5px 30px rgba(0,0,0,0.3); flex-direction: column; z-index: 9999; border: 1px solid var(--border); overflow: hidden; }
        .chat-header { padding: 12px 15px; background: var(--bg-body); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; font-weight: bold; align-items: center; }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: var(--bg-body); }
        .chat-footer { padding: 10px; border-top: 1px solid var(--border); background: var(--bg-card); display: flex; gap: 10px; justify-content: center; }
        .msg { max-width: 85%; padding: 8px 12px; border-radius: 12px; font-size: 0.9em; line-height: 1.4; }
        .msg.bot { align-self: flex-start; background: var(--bg-card); border: 1px solid var(--border); }
        .msg.user { align-self: flex-end; background: var(--primary); color: white; }
        .msg-btn-group { display: flex; flex-wrap: wrap; gap: 5px; }
        .msg-chip { background: var(--primary-light); color: var(--primary); padding: 5px 10px; border-radius: 15px; font-size: 0.8em; cursor: pointer; }
        .mic-wave { width: 45px; height: 45px; border-radius: 50%; background: var(--danger); color: white; border: none; font-size: 1.2em; display: flex; align-items: center; justify-content: center; }
        .mic-wave.active { animation: pulse 1.5s infinite; }

        .show-card-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-body); z-index: 10000; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        .show-card-text { font-size: 3em; font-weight: 800; line-height: 1.2; margin-bottom: 15px; word-wrap: break-word; }
        .show-card-sub { font-size: 1.5em; color: var(--text-sub); }
        .show-card-hint { position: absolute; bottom: 30px; opacity: 0.5; font-size: 0.8em; }

        .tool-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: flex-end; justify-content: center; }
        .tool-card { background: var(--bg-card); width: 100%; max-width: 500px; border-radius: 20px 20px 0 0; padding: 25px; box-sizing: border-box; }
        .tool-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .tool-tab { flex: 1; text-align: center; padding: 8px; font-weight: bold; color: var(--text-sub); cursor: pointer; }
        .tool-tab.active { background: var(--primary-light); color: var(--primary); border-radius: 8px; }
        .tool-section { display: none; }
        .tool-section.active { display: block; }
        .calc-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; gap: 10px; }
        .calc-input { width: 80px; padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--display-area); color: var(--text-main); text-align: center; font-weight: bold; }
        .tip-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 15px; }
        .tip-box { background: var(--display-area); padding: 10px; border-radius: 10px; text-align: center; border: 1px solid var(--border); }
        .tip-val { font-size: 1.1em; font-weight: 800; color: var(--primary); display: block; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 5000; align-items: center; justify-content: center; }
        .modal-card { background: var(--bg-card); width: 85%; max-width: 400px; padding: 25px; border-radius: 20px; text-align: center; border: 1px solid var(--border); }
        .modal-title { font-size: 1.2em; font-weight: bold; margin-bottom: 20px; }
        .modal-actions { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
        .modal-btn { padding: 8px 16px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; }
        .btn-reveal { background: var(--primary); color: white; }
        .btn-close { background: var(--border); color: var(--text-main); }
        .speech-result-toast { position: fixed; top: 20%; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 20px; font-size: 0.9em; z-index: 11000; display: none; text-align: center; max-width: 80%; }

        .fixed-footer { flex: 0 0 auto; text-align: center; color: var(--text-sub); font-size: 0.6em; padding: 3px 0; border-top: 1px solid var(--border); background: var(--bg-body); opacity: 0.5; }
    </style>
</head>
<body>
    <div class="header-container">
        <div class="top-row">
            <div class="title-group">
                <div class="app-title">ğŸ‡ºğŸ‡¸ Survival English Guide</div>
                <div class="level-badge" id="userLevel">Lv.1</div>
            </div>
            <div class="header-actions">
                <button class="icon-btn danger" onclick="toggleEmergency()">ğŸ†˜</button>
                <button class="icon-btn" onclick="toggleTheme()">ğŸŒ—</button>
            </div>
        </div>
        
        <div class="search-row">
            <input type="text" class="search-input" id="searchBox" placeholder="ğŸ” æœåœºæ™¯/å•è¯..." oninput="filterUnits()">
        </div>

        <div class="nav-scroll">
            <a class="nav-btn" onclick="scrollToUnit('u1')">é‚»å±…</a>
            <a class="nav-btn" onclick="scrollToUnit('u2')">ä½ç½®</a>
            <a class="nav-btn" onclick="scrollToUnit('u3')">å†…æ€¥</a>
            <a class="nav-btn" onclick="scrollToUnit('u4')">é“¶è¡Œ</a>
            <a class="nav-btn" onclick="scrollToUnit('u5')">ç»“è´¦</a>
            <a class="nav-btn" onclick="scrollToUnit('u6')">ç‚¹é¤</a>
            <a class="nav-btn" onclick="scrollToUnit('u7')">èšé¤</a>
            <a class="nav-btn" onclick="scrollToUnit('u8')">å™æ—§</a>
            <a class="nav-btn" onclick="scrollToUnit('u9')">æ‰“è½¦</a>
            <a class="nav-btn" onclick="scrollToUnit('u10')">æ•‘å‘½</a>
            <a class="nav-btn" onclick="scrollToUnit('u11')">ä¸æ‡‚</a>
            <a class="nav-btn" onclick="scrollToUnit('u12')">é€€è´§</a>
            <a class="nav-btn" onclick="scrollToUnit('u13')">é¢„çº¦</a>
        </div>
    </div>

    <div id="content-area">
        <div class="unit-card" id="u1" data-name="Neighbor" data-keywords="neighbor hello hi greeting æ¬å®¶ è£…ä¿® æ–°æ¥ é™Œç”Ÿäºº é—®å€™">
            <div class="unit-header">
                <span>é‚»å±…æ‰“æ‹›å‘¼</span>
                <span class="sort-rank">#1</span>
            </div>
            
            <div class="step-container">
                <span class="step-label">Step 1: ä»‹ç» <span class="pattern-box">Hi, I'm ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">Hi, I'm <span class="highlight" id="u1-s1-word">your new neighbor</span>.</div>
                        <div class="translation" id="u1-s1-trans">å—¨ï¼Œæˆ‘æ˜¯ä½ çš„æ–°é‚»å±…ã€‚</div>
                    </div>
                    </div>
                <div class="chips-container" id="u1-s1-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(1, 1, 'Hi, I\'m', '.')">+</button></div>
                </div>
            </div>

            <div class="step-container">
                <span class="step-label">Step 2: ä½å€ <span class="pattern-box">I live in ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">I live in <span class="highlight" id="u1-s2-word">Apt 302</span>.</div>
                        <div class="translation" id="u1-s2-trans">æˆ‘ä½åœ¨302å®¤ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u1-s2-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(1, 2, 'I live in', '.')">+</button></div>
                </div>
            </div>

            <div class="divider"></div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ å®Œæ•´å¥å­ï¼ˆç¤ºä¾‹ï¼‰</div>
                <div class="combo-text">Hi, I'm your new neighbor. I live in Apt 302.</div>
            </div>
            <div class="scroll-hint">å‘ä¸‹æ»‘åŠ¨æ˜¾ç¤ºæ›´å¤š â†“</div>
        </div>

        <div class="unit-card" id="u2" data-name="Location" data-keywords="map where lost direction è¿·è·¯ å¯¼èˆª åœ°å›¾ æ€ä¹ˆèµ° ä½ç½®">
            <div class="unit-header">
                <span>è¯¢é—®ä½ç½®</span>
                <span class="sort-rank">#2</span>
            </div>
            
            <div class="step-container">
                <span class="step-label">Step 1: å¯»æ‰¾ <span class="pattern-box">I'm looking for ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">Excuse me, I'm looking for <span class="highlight" id="u2-s1-word">the subway</span>.</div>
                        <div class="translation" id="u2-s1-trans">æ‰“æ‰°ä¸€ä¸‹ï¼Œæˆ‘åœ¨æ‰¾åœ°é“ç«™ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u2-s1-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(2, 1, 'Excuse me, I\'m looking for', '.')">+</button></div>
                </div>
            </div>

            <div class="step-container">
                <span class="step-label">Step 2: è¯¢é—® <span class="pattern-box">Can you tell me ...?</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">Can you tell me <span class="highlight" id="u2-s2-word">where it is</span>?</div>
                        <div class="translation" id="u2-s2-trans">èƒ½å‘Šè¯‰æˆ‘å®ƒåœ¨å“ªå—ï¼Ÿ</div>
                    </div>
                </div>
                <div class="chips-container" id="u2-s2-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(2, 2, 'Can you tell me', '?')">+</button></div>
                </div>
            </div>

            <div class="divider"></div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ å®Œæ•´å¥å­ï¼ˆç¤ºä¾‹ï¼‰</div>
                <div class="combo-text">Excuse me, I'm looking for the subway. Can you tell me where it is?</div>
            </div>
            <div class="scroll-hint">å‘ä¸‹æ»‘åŠ¨æ˜¾ç¤ºæ›´å¤š â†“</div>
        </div>

        <div class="unit-card" id="u3" data-name="Borrowing" data-keywords="toilet restroom battery charge urgent emergency å†…æ€¥ å•æ‰€ æ²¡ç”µ å……ç”µ å€Ÿç”¨">
            <div class="unit-header">
                <span>ç´§æ€¥å€Ÿç”¨</span>
                <span class="sort-rank">#3</span>
            </div>
            <div class="step-container">
                <span class="step-label">Step 1: å€Ÿç”¨ <span class="pattern-box">Could I borrow ...?</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">Could I borrow <span class="highlight" id="u3-s1-word">your phone charger</span>?</div>
                        <div class="translation" id="u3-s1-trans">æˆ‘èƒ½å€Ÿç”¨ä¸€ä¸‹æ‚¨çš„æ‰‹æœºå……ç”µå™¨å—ï¼Ÿ</div>
                    </div>
                </div>
                <div class="chips-container" id="u3-s1-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(3, 1, 'Could I borrow', '?')">+</button></div>
                </div>
            </div>
            <div class="step-container">
                <span class="step-label">Step 2: åŸå›  <span class="pattern-box">It's really ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">It's really <span class="highlight" id="u3-s2-word">urgent</span>.</div>
                        <div class="translation" id="u3-s2-trans">çœŸçš„å¾ˆç´§æ€¥ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u3-s2-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(3, 2, 'It\'s really', '.')">+</button></div>
                </div>
            </div>
            <div class="divider"></div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ å®Œæ•´å¥å­ï¼ˆç¤ºä¾‹ï¼‰</div>
                <div class="combo-text">Could I borrow your phone charger? It's really urgent.</div>
            </div>
            <div class="scroll-hint">å‘ä¸‹æ»‘åŠ¨æ˜¾ç¤ºæ›´å¤š â†“</div>
        </div>

        <div class="unit-card" id="u4" data-name="Bank" data-keywords="money bank cash deposit withdraw é“¶è¡Œ é’± ç°é‡‘ è½¬è´¦ å¼€æˆ·">
            <div class="unit-header">
                <span>é“¶è¡ŒåŠäº‹</span>
                <span class="sort-rank">#4</span>
            </div>
            <div class="step-container">
                <span class="step-label">Step 1: åŠ¨ä½œ <span class="pattern-box">I'd like to ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">I'd like to <span class="highlight" id="u4-s1-word">deposit cash</span>.</div>
                        <div class="translation" id="u4-s1-trans">æˆ‘æƒ³å­˜ç°é‡‘ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u4-s1-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(4, 1, 'I\'d like to', '.')">+</button></div>
                </div>
            </div>
            <div class="step-container">
                <span class="step-label">Step 2: è¯ä»¶ <span class="pattern-box">Here is my ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">Here is my <span class="highlight" id="u4-s2-word">ID card</span>.</div>
                        <div class="translation" id="u4-s2-trans">è¿™æ˜¯æˆ‘çš„èº«ä»½è¯ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u4-s2-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(4, 2, 'Here is my', '.')">+</button></div>
                </div>
            </div>
            <div class="divider"></div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ å®Œæ•´å¥å­ï¼ˆç¤ºä¾‹ï¼‰</div>
                <div class="combo-text">I'd like to deposit cash. Here is my ID card.</div>
            </div>
            <div class="scroll-hint">å‘ä¸‹æ»‘åŠ¨æ˜¾ç¤ºæ›´å¤š â†“</div>
        </div>

        <div class="unit-card" id="u5" data-name="Checkout" data-keywords="pay bill cost credit card ç»“è´¦ ä¹°å• å¤šå°‘é’± åˆ·å¡ æ”¯ä»˜å®">
            <div class="unit-header">
                <span>å•†åº—ç»“è´¦</span>
                <span class="sort-rank">#5</span>
            </div>
            <div class="step-container">
                <span class="step-label">Step 1: æ”¯ä»˜ <span class="pattern-box">I'll pay with ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">I'll pay with <span class="highlight" id="u5-s1-word">credit card</span>.</div>
                        <div class="translation" id="u5-s1-trans">æˆ‘æƒ³ç”¨ä¿¡ç”¨å¡æ”¯ä»˜ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u5-s1-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(5, 1, 'I\'ll pay with', '.')">+</button></div>
                </div>
            </div>
            <div class="step-container">
                <span class="step-label">Step 2: éœ€æ±‚ <span class="pattern-box">Do you offer ...?</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">Do you offer <span class="highlight" id="u5-s2-word">a receipt</span>?</div>
                        <div class="translation" id="u5-s2-trans">ä½ ä»¬æä¾›æ”¶æ®å—ï¼Ÿ</div>
                    </div>
                </div>
                <div class="chips-container" id="u5-s2-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(5, 2, 'Do you offer', '?')">+</button></div>
                </div>
            </div>
            <div class="divider"></div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ å®Œæ•´å¥å­ï¼ˆç¤ºä¾‹ï¼‰</div>
                <div class="combo-text">I'll pay with credit card. Do you offer a receipt?</div>
            </div>
            <div class="scroll-hint">å‘ä¸‹æ»‘åŠ¨æ˜¾ç¤ºæ›´å¤š â†“</div>
        </div>
        <div class="unit-card" id="u6" data-name="Ordering" data-keywords="eat food drink menu spicy hungry ç‚¹é¤ åƒé¥­ èœå• å¿Œå£ å¤–å– æ‰“åŒ…">
            <div class="unit-header">
                <span>é¤å…ç‚¹é¤</span>
                <span class="sort-rank">#6</span>
            </div>
            <div class="step-container">
                <span class="step-label">Step 1: æƒ³è¦ <span class="pattern-box">I'd like ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">I'd like <span class="highlight" id="u6-s1-word">the menu</span>.</div>
                        <div class="translation" id="u6-s1-trans">æˆ‘æƒ³è¦èœå•ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u6-s1-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(6, 1, 'I\'d like', '.')">+</button></div>
                </div>
            </div>
            <div class="step-container">
                <span class="step-label">Step 2: å¿Œå£/è¦æ±‚ <span class="pattern-box">Please don't ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">Please don't <span class="highlight" id="u6-s2-word">add sugar</span>.</div>
                        <div class="translation" id="u6-s2-trans">è¯·ä¸è¦åŠ ç³–ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u6-s2-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(6, 2, 'Please don\'t', '.')">+</button></div>
                </div>
            </div>
            <div class="divider"></div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ å®Œæ•´å¥å­ï¼ˆç¤ºä¾‹ï¼‰</div>
                <div class="combo-text">I'd like the menu. Please don't add sugar.</div>
            </div>
            <div class="scroll-hint">å‘ä¸‹æ»‘åŠ¨æ˜¾ç¤ºæ›´å¤š â†“</div>
        </div>

        <div class="unit-card" id="u7" data-name="Splitting" data-keywords="treat split share dinner party èšé¤ è¯·å®¢ AAåˆ¶ å‡æ‘Š">
            <div class="unit-header">
                <span>èšé¤ä¹°å•</span>
                <span class="sort-rank">#7</span>
            </div>
            <div class="step-container">
                <span class="step-label">Step 1: æè®® <span class="pattern-box">Let's ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">Let's <span class="highlight" id="u7-s1-word">split the bill</span>.</div>
                        <div class="translation" id="u7-s1-trans">å’±ä»¬å¹³æ‘Šå§ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u7-s1-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(7, 1, 'Let\'s', '.')">+</button></div>
                </div>
            </div>
            <div class="step-container">
                <span class="step-label">Step 2: å†³å®š <span class="pattern-box">It's ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">It's <span class="highlight" id="u7-s2-word">on me</span>.</div>
                        <div class="translation" id="u7-s2-trans">ä»Šå¤©æˆ‘è¯·å®¢ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u7-s2-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(7, 2, 'It\'s', '.')">+</button></div>
                </div>
            </div>
            <div class="divider"></div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ å®Œæ•´å¥å­ï¼ˆç¤ºä¾‹ï¼‰</div>
                <div class="combo-text">Let's split the bill. It's on me today.</div>
            </div>
            <div class="scroll-hint">å‘ä¸‹æ»‘åŠ¨æ˜¾ç¤ºæ›´å¤š â†“</div>
        </div>

        <div class="unit-card" id="u8" data-name="Catchup" data-keywords="chat coffee long time contact å™æ—§ èŠå¤© å–èŒ¶ å¾®ä¿¡">
            <div class="unit-header">
                <span>æœ‹å‹å™æ—§</span>
                <span class="sort-rank">#8</span>
            </div>
            <div class="step-container">
                <span class="step-label">Step 1: æ„Ÿå¹ <span class="pattern-box">Long time ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">Long time <span class="highlight" id="u8-s1-word">no see</span>!</div>
                        <div class="translation" id="u8-s1-trans">å¥½ä¹…ä¸è§ï¼æ²¡è§æ€ä¹ˆæ ·ï¼Ÿ</div>
                    </div>
                </div>
                <div class="chips-container" id="u8-s1-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(8, 1, 'Long time', '!')">+</button></div>
                </div>
            </div>
            <div class="step-container">
                <span class="step-label">Step 2: æè®® <span class="pattern-box">We should ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">We should <span class="highlight" id="u8-s2-word">catch up</span>.</div>
                        <div class="translation" id="u8-s2-trans">æˆ‘ä»¬åº”è¯¥å™å™æ—§ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u8-s2-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(8, 2, 'We should', '.')">+</button></div>
                </div>
            </div>
            <div class="divider"></div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ å®Œæ•´å¥å­ï¼ˆç¤ºä¾‹ï¼‰</div>
                <div class="combo-text">Long time no see! We should catch up.</div>
            </div>
            <div class="scroll-hint">å‘ä¸‹æ»‘åŠ¨æ˜¾ç¤ºæ›´å¤š â†“</div>
        </div>

        <div class="unit-card" id="u9" data-name="Taxi" data-keywords="taxi uber ride airport address æ‰“è½¦ å¸æœº æœºåœº è½¦ç«™ èµ¶æ—¶é—´">
            <div class="unit-header">
                <span>æ‰“è½¦å‡ºè¡Œ</span>
                <span class="sort-rank">#9</span>
            </div>
            <div class="step-container">
                <span class="step-label">Step 1: ç›®çš„ <span class="pattern-box">I'm going to ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">I'm going to <span class="highlight" id="u9-s1-word">JFK airport</span>.</div>
                        <div class="translation" id="u9-s1-trans">æˆ‘è¦å»JFKæœºåœºã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u9-s1-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(9, 1, 'I\'m going to', '.')">+</button></div>
                </div>
            </div>
            <div class="step-container">
                <span class="step-label">Step 2: ä¸‹è½¦ <span class="pattern-box">Drop me off ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">Drop me off <span class="highlight" id="u9-s2-word">right here</span>.</div>
                        <div class="translation" id="u9-s2-trans">å°±åœ¨è¿™ä¸‹è½¦ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u9-s2-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(9, 2, 'Drop me off', '.')">+</button></div>
                </div>
            </div>
            <div class="divider"></div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ å®Œæ•´å¥å­ï¼ˆç¤ºä¾‹ï¼‰</div>
                <div class="combo-text">I'm going to JFK airport. Drop me off right here.</div>
            </div>
            <div class="scroll-hint">å‘ä¸‹æ»‘åŠ¨æ˜¾ç¤ºæ›´å¤š â†“</div>
        </div>

        <div class="unit-card" id="u10" data-name="Medical" data-keywords="help sick pain doctor 911 æ•‘å‘½ ç–¼ åŒ»ç”Ÿ åŒ»é™¢ æŠ¥è­¦">
            <div class="unit-header">
                <span>åŒ»ç–—æ•‘å‘½</span>
                <span class="sort-rank">#10</span>
            </div>
            <div class="step-container">
                <span class="step-label">Step 1: éœ€æ±‚ <span class="pattern-box">I need ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">I need <span class="highlight" id="u10-s1-word">a doctor</span>.</div>
                        <div class="translation" id="u10-s1-trans">æˆ‘éœ€è¦åŒ»ç”Ÿã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u10-s1-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(10, 1, 'I need', '.')">+</button></div>
                </div>
            </div>
            <div class="step-container">
                <span class="step-label">Step 2: ç—‡çŠ¶ <span class="pattern-box">I feel ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">I feel <span class="highlight" id="u10-s2-word">dizzy</span>.</div>
                        <div class="translation" id="u10-s2-trans">æˆ‘æ„Ÿåˆ°å¤´æ™•ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u10-s2-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(10, 2, 'I feel', '.')">+</button></div>
                </div>
            </div>
            <div class="divider"></div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ å®Œæ•´å¥å­ï¼ˆç¤ºä¾‹ï¼‰</div>
                <div class="combo-text">I need a doctor. I feel dizzy.</div>
            </div>
            <div class="scroll-hint">å‘ä¸‹æ»‘åŠ¨æ˜¾ç¤ºæ›´å¤š â†“</div>
        </div>

        <div class="unit-card" id="u11" data-name="Confused" data-keywords="what pardon repeat understand å¬ä¸æ‡‚ ç¿»è¯‘ å†è¯´ä¸€é å•¥æ„æ€">
            <div class="unit-header">
                <span>å®Œå…¨å¬ä¸æ‡‚</span>
                <span class="sort-rank">#11</span>
            </div>
            <div class="step-container">
                <span class="step-label">Step 1: è¯·æ±‚ <span class="pattern-box">Could you ...?</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">Could you <span class="highlight" id="u11-s1-word">speak slowly</span>?</div>
                        <div class="translation" id="u11-s1-trans">èƒ½è¯´æ…¢ç‚¹å—ï¼Ÿ</div>
                    </div>
                </div>
                <div class="chips-container" id="u11-s1-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(11, 1, 'Could you', '?')">+</button></div>
                </div>
            </div>
            <div class="step-container">
                <span class="step-label">Step 2: é™ˆè¿° <span class="pattern-box">I don't ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">I don't <span class="highlight" id="u11-s2-word">understand</span>.</div>
                        <div class="translation" id="u11-s2-trans">æˆ‘ä¸å¬æ‡‚ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u11-s2-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(11, 2, 'I don\'t', '.')">+</button></div>
                </div>
            </div>
            <div class="divider"></div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ å®Œæ•´å¥å­ï¼ˆç¤ºä¾‹ï¼‰</div>
                <div class="combo-text">Could you speak slowly? I don't understand.</div>
            </div>
            <div class="scroll-hint">å‘ä¸‹æ»‘åŠ¨æ˜¾ç¤ºæ›´å¤š â†“</div>
        </div>

        <div class="unit-card" id="u12" data-name="Return" data-keywords="return refund exchange broken é€€è´§ é€€æ¬¾ æ¢è´§ åäº† è´¨é‡">
            <div class="unit-header">
                <span>å•†åº—é€€è´§</span>
                <span class="sort-rank">#12</span>
            </div>
            <div class="step-container">
                <span class="step-label">Step 1: æ„å›¾ <span class="pattern-box">I'd like to ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">I'd like to <span class="highlight" id="u12-s1-word">return this</span>.</div>
                        <div class="translation" id="u12-s1-trans">æˆ‘æƒ³é€€è¿™ä¸ªã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u12-s1-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(12, 1, 'I\'d like to', '.')">+</button></div>
                </div>
            </div>
            <div class="step-container">
                <span class="step-label">Step 2: ç†ç”± <span class="pattern-box">Because it ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">Because it <span class="highlight" id="u12-s2-word">is broken</span>.</div>
                        <div class="translation" id="u12-s2-trans">å› ä¸ºå®ƒåäº†ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u12-s2-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(12, 2, 'Because it', '.')">+</button></div>
                </div>
            </div>
            <div class="divider"></div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ å®Œæ•´å¥å­ï¼ˆç¤ºä¾‹ï¼‰</div>
                <div class="combo-text">I'd like to return this. Because it is broken.</div>
            </div>
            <div class="scroll-hint">å‘ä¸‹æ»‘åŠ¨æ˜¾ç¤ºæ›´å¤š â†“</div>
        </div>

        <div class="unit-card" id="u13" data-name="Reservation" data-keywords="schedule time book reserve é¢„çº¦ æ—¶é—´ è®¢ä½ æ”¹æœŸ">
            <div class="unit-header">
                <span>é¢„çº¦/æ”¹æœŸ</span>
                <span class="sort-rank">#13</span>
            </div>
            <div class="step-container">
                <span class="step-label">Step 1: åŠ¨ä½œ <span class="pattern-box">I'd like to ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">I'd like to <span class="highlight" id="u13-s1-word">book a table</span>.</div>
                        <div class="translation" id="u13-s1-trans">æˆ‘æƒ³è®¢ä½ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u13-s1-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(13, 1, 'I\'d like to', '.')">+</button></div>
                </div>
            </div>
            <div class="step-container">
                <span class="step-label">Step 2: æ—¶é—´ <span class="pattern-box">For ...</span></span>
                <div class="display-area">
                    <div class="text-content">
                        <div class="english-sentence">For <span class="highlight" id="u13-s2-word">7:00 PM</span>.</div>
                        <div class="translation" id="u13-s2-trans">åœ¨æ™šä¸Š7ç‚¹ã€‚</div>
                    </div>
                </div>
                <div class="chips-container" id="u13-s2-chips">
                    <div class="add-btn-wrapper"><button class="add-chip-btn" onclick="addCustomChip(13, 2, 'For', '.')">+</button></div>
                </div>
            </div>
            <div class="divider"></div>
            <div class="combo-box">
                <div class="combo-title">ğŸš€ å®Œæ•´å¥å­ï¼ˆç¤ºä¾‹ï¼‰</div>
                <div class="combo-text">I'd like to book a table. For 7:00 PM.</div>
            </div>
            <div class="scroll-hint">å‘ä¸‹æ»‘åŠ¨æ˜¾ç¤ºæ›´å¤š â†“</div>
        </div>
    </div><div class="float-controls"></div>

    <div id="emergencyOverlay" class="emergency-overlay">
        <span class="emergency-close" onclick="toggleEmergency()">âœ•</span>
        <div class="emergency-card" onclick="speakDirect('I need an ambulance! Help!')">
            <div>
                <div class="emergency-text">ğŸš‘ å«æ•‘æŠ¤è½¦</div>
                <div class="emergency-sub">I need an ambulance!</div>
            </div>
        </div>
        <div class="emergency-card" onclick="speakDirect('Call the police! Emergency!')">
            <div>
                <div class="emergency-text">ğŸš“ æŠ¥è­¦ (911)</div>
                <div class="emergency-sub">Call the police!</div>
            </div>
        </div>
        <div class="emergency-card" onclick="speakDirect('I need a translator. Chinese please.')">
            <div>
                <div class="emergency-text">ğŸ—£ï¸ æ‰¾ç¿»è¯‘</div>
                <div class="emergency-sub">I need a Chinese translator.</div>
            </div>
        </div>
    </div>

    <div id="randomModal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-title">ğŸ”¥ çªå‡»æ£€æŸ¥ï¼</div>
            <p id="modalQuestion" style="font-size:1.2em; margin-bottom:20px; color:var(--primary);">...</p>
            <div class="modal-actions">
                <button class="modal-btn btn-close" onclick="closeModal('randomModal')">è·³è¿‡</button>
                <button class="modal-btn btn-reveal" onclick="revealRandomAnswer()">å»çœ‹çœ‹</button>
            </div>
        </div>
    </div>

    <div class="fixed-footer">
        Â© <span id="year">2025</span> Henry's Survival English Guide.
    </div>
    <script>
        // === æ ¸å¿ƒé€»è¾‘ (V36.0: ç­‰çº§ç³»ç»Ÿ + é¾Ÿé€Ÿæ’­æ”¾ + æœç´¢è¦†ç›–ç‰ˆ) ===
        let usageData = {};
        let currentRandomUnit = null;
        let pressTimer;
        let recognition = null; 
        
        // ğŸ† ç»éªŒå€¼ç³»ç»Ÿ
        let userXP = 0;
        
        let aiState = { active: false, currentUnit: null, currentStep: 0, score: 0, total: 0, currentTargetEng: "", currentTargetCn: "", waitingForSpeech: false, silenceTimer: null, idleTimer: null };

        // ğŸ”¥ è¶…å…¨ç”Ÿæ´»åœºæ™¯è¯åº“ (å·²æ˜ å°„ä¸­æ–‡ï¼Œç¡®ä¿å¯æœåˆ°)
        const extraVocab = {
            1: { 1: [{e:"new neighbor", c:"æ–°é‚»å±…"}, {e:"from 3B", c:"3Bçš„ä½æˆ·"}, {e:"just moved in", c:"åˆšæ¬æ¥çš„"}, {e:"Henry", c:"Henry"}, {e:"living downstairs", c:"ä½æ¥¼ä¸‹çš„"}, {e:"the new guy", c:"æ–°æ¥çš„é‚£ä¸ª"}], 2: [{e:"down the hall", c:"èµ°å»Šå°½å¤´"}, {e:"upstairs", c:"æ¥¼ä¸Š"}, {e:"next door", c:"éš”å£"}, {e:"in unit 402", c:"402å®¤"}, {e:"across the street", c:"é©¬è·¯å¯¹é¢"}] },
            2: { 1: [{e:"the subway", c:"åœ°é“ç«™"}, {e:"the restroom", c:"æ´—æ‰‹é—´"}, {e:"the exit", c:"å‡ºå£"}, {e:"an elevator", c:"ç”µæ¢¯"}, {e:"a pharmacy", c:"è¯æˆ¿"}, {e:"the bus stop", c:"å…¬äº¤ç«™"}], 2: [{e:"where it is", c:"å®ƒåœ¨å“ª"}, {e:"which floor", c:"åœ¨å‡ æ¥¼"}, {e:"the direction", c:"æ–¹å‘"}, {e:"how to get there", c:"æ€ä¹ˆèµ°"}] },
            3: { 1: [{e:"phone charger", c:"æ‰‹æœºå……ç”µå™¨"}, {e:"wifi password", c:"WiFiå¯†ç "}, {e:"pen", c:"ç¬”"}, {e:"lighter", c:"æ‰“ç«æœº"}, {e:"umbrella", c:"é›¨ä¼"}, {e:"power bank", c:"å……ç”µå®"}], 2: [{e:"urgent", c:"ç´§æ€¥/å†…æ€¥"}, {e:"an emergency", c:"æ€¥äº‹"}, {e:"dying", c:"å¿«æ²¡ç”µäº†"}, {e:"running low", c:"ç”µé‡ä½"}, {e:"important", c:"å¾ˆé‡è¦"}] },
            4: { 1: [{e:"deposit cash", c:"å­˜ç°é‡‘"}, {e:"withdraw money", c:"å–é’±"}, {e:"transfer funds", c:"è½¬è´¦"}, {e:"open an account", c:"å¼€æˆ·"}, {e:"change PIN", c:"æ”¹å¯†ç "}], 2: [{e:"ID card", c:"èº«ä»½è¯"}, {e:"passport", c:"æŠ¤ç…§"}, {e:"debit card", c:"å€Ÿè®°å¡"}, {e:"check", c:"æ”¯ç¥¨"}, {e:"account number", c:"è´¦å·"}] },
            5: { 1: [{e:"credit card", c:"ä¿¡ç”¨å¡"}, {e:"Apple Pay", c:"Apple Pay"}, {e:"cash", c:"ç°é‡‘"}, {e:"Venmo", c:"Venmo"}, {e:"Zelle", c:"Zelle"}, {e:"AliPay", c:"æ”¯ä»˜å®"}], 2: [{e:"a receipt", c:"æ”¶æ®"}, {e:"a discount", c:"æŠ˜æ‰£"}, {e:"cash back", c:"è¿”ç°"}, {e:"small change", c:"é›¶é’±"}, {e:"a bag", c:"è¢‹å­"}] },
            6: { 1: [{e:"tap water", c:"è‡ªæ¥æ°´"}, {e:"the menu", c:"èœå•"}, {e:"napkins", c:"é¤å·¾çº¸"}, {e:"a refill", c:"ç»­æ¯"}, {e:"chopsticks", c:"ç­·å­"}, {e:"a box", c:"æ‰“åŒ…ç›’"}], 2: [{e:"add sugar", c:"åŠ ç³–"}, {e:"make it spicy", c:"åšæˆè¾£çš„"}, {e:"add ice", c:"åŠ å†°"}, {e:"put cilantro", c:"æ”¾é¦™èœ"}, {e:"rush it", c:"å¿«ä¸€ç‚¹"}] },
            7: { 1: [{e:"split the bill", c:"å¹³æ‘Š"}, {e:"share the cost", c:"åˆ†æ‹…è´¹ç”¨"}, {e:"go Dutch", c:"AAåˆ¶"}, {e:"treat you", c:"è¯·ä½ "}], 2: [{e:"on me", c:"æˆ‘è¯·å®¢"}, {e:"my treat", c:"æˆ‘ä¹°å•"}, {e:"my turn", c:"è½®åˆ°æˆ‘äº†"}, {e:"covered by me", c:"æˆ‘åŒ…äº†"}] },
            8: { 1: [{e:"no see", c:"æ²¡è§"}, {e:"no talk", c:"æ²¡èŠ"}, {e:"since college", c:"å¤§å­¦å"}, {e:"since last year", c:"å»å¹´å"}], 2: [{e:"catch up", c:"å™å™æ—§"}, {e:"hang out", c:"èšèš"}, {e:"get coffee", c:"å–æ¯å’–å•¡"}, {e:"keep in touch", c:"å¸¸è”ç³»"}, {e:"exchange numbers", c:"äº¤æ¢å·ç "}] },
            9: { 1: [{e:"JFK airport", c:"JFKæœºåœº"}, {e:"Main Street", c:"Mainè¡—"}, {e:"the hotel", c:"é…’åº—"}, {e:"this address", c:"è¿™ä¸ªåœ°å€"}, {e:"Flushing", c:"æ³•æ‹‰ç››"}], 2: [{e:"right here", c:"å°±åœ¨è¿™"}, {e:"at the corner", c:"åœ¨è·¯å£"}, {e:"at the light", c:"åœ¨çº¢ç»¿ç¯"}, {e:"by the sign", c:"æ ‡å¿—ç‰Œæ—"}] },
            10: { 1: [{e:"a doctor", c:"åŒ»ç”Ÿ"}, {e:"an ambulance", c:"æ•‘æŠ¤è½¦"}, {e:"painkillers", c:"æ­¢ç—›è¯"}, {e:"some ice", c:"å†°å—"}, {e:"help", c:"å¸®åŠ©"}], 2: [{e:"dizzy", c:"å¤´æ™•"}, {e:"nauseous", c:"æ¶å¿ƒ"}, {e:"feverish", c:"å‘çƒ§"}, {e:"terrible", c:"å¾ˆç³Ÿ"}, {e:"weak", c:"è™šå¼±"}] },
            11: { 1: [{e:"speak slowly", c:"è¯´æ…¢ç‚¹"}, {e:"say that again", c:"å†è¯´ä¸€æ¬¡"}, {e:"write it down", c:"å†™ä¸‹æ¥"}, {e:"use Google Translate", c:"ç”¨è°·æ­Œç¿»è¯‘"}], 2: [{e:"understand", c:"å¬æ‡‚"}, {e:"hear you", c:"å¬æ¸…"}, {e:"get it", c:"æ˜ç™½"}, {e:"know that word", c:"æ‡‚é‚£ä¸ªè¯"}] },
            12: { 1: [{e:"return this", c:"é€€è¿™ä¸ª"}, {e:"exchange this", c:"æ¢è¿™ä¸ª"}, {e:"get a refund", c:"é€€æ¬¾"}, {e:"speak to manager", c:"æ‰¾ç»ç†"}], 2: [{e:"is broken", c:"åäº†"}, {e:"is expired", c:"è¿‡æœŸäº†"}, {e:"doesn't fit", c:"ä¸åˆèº«"}, {e:"is the wrong color", c:"é¢œè‰²é”™äº†"}] },
            13: { 1: [{e:"book a table", c:"è®¢ä½"}, {e:"make a reservation", c:"é¢„çº¦"}, {e:"cancel my appointment", c:"å–æ¶ˆé¢„çº¦"}, {e:"reschedule", c:"æ”¹æœŸ"}], 2: [{e:"7:00 PM", c:"æ™šä¸Š7ç‚¹"}, {e:"noon", c:"ä¸­åˆ"}, {e:"tomorrow morning", c:"æ˜æ—©"}, {e:"next Monday", c:"ä¸‹å‘¨ä¸€"}] }
        };

        window.onload = function() {
            document.getElementById('year').innerText = new Date().getFullYear();
            loadTheme();
            loadXP(); // åŠ è½½ç­‰çº§
            
            // ğŸš€ 1. æ³¨å…¥å†…å®¹ä¸å…³é”®è¯
            injectExtraChips();
            loadCustomChips();
            loadUsageData();
            injectSmartKeywords(); 
            injectShowCardDOM();
            injectChatDOM();
            injectToolboxDOM(); 
            initSpeechRecognition();
            checkMonthlyReport(); 
            
            // ğŸš€ 2. ç¡¬æ ¸æ³¨å…¥åº•éƒ¨æŒ‰é’® (å–‡å­ + ä¹Œé¾Ÿ) - åœ¨æ’åºå‰æ‰§è¡Œï¼
            injectLogicButtons();
            
            // ğŸš€ 3. æ’åº + å¾ªç¯ (æ­¤æ—¶å¡ç‰‡é‡Œå·²ç»æœ‰äº†ç¡¬æ ¸æŒ‰é’®)
            autoSortUnits(); 
            
            for (let i = 1; i <= 13; i++) {
                if(document.getElementById(`u${i}`)) {
                    restoreSelection(i, 1);
                    restoreSelection(i, 2);
                }
            }
            
            setTimeout(() => { initBubbleTip(); }, 1000);
            initScrollHints();
            rebuildActionButtons(); 
            
            // ğŸš€ 4. å…¨å±€ç‚¹å‡»ç›‘å¬ (ä¿åº•)
            initGlobalClickListeners(); 
            
            addFloatingControls(); 
            startSmartSearchAnimation();
            
            resetIdleTimer();
            ['touchstart','click','scroll'].forEach(e => document.addEventListener(e, resetIdleTimer));
        };

        // --- ğŸ† ç­‰çº§ç³»ç»Ÿ ---
        function loadXP() {
            userXP = parseInt(localStorage.getItem('user_xp') || "0");
            updateLevelDisplay();
        }
        function gainXP(amount = 1) {
            userXP += amount;
            localStorage.setItem('user_xp', userXP);
            updateLevelDisplay();
        }
        function updateLevelDisplay() {
            // ç®€å•çš„å‡çº§å…¬å¼ï¼šæ¯10ç‚¹ç»éªŒå‡1çº§ï¼Œæœ€é«˜99
            let level = Math.floor(userXP / 10) + 1;
            if (level > 99) level = 99;
            const badge = document.getElementById('userLevel');
            if (badge) {
                // å¦‚æœå‡çº§äº†ï¼Œé—ªä¸€ä¸‹
                if (badge.innerText !== `Lv.${level}`) {
                    badge.classList.add('bump');
                    setTimeout(() => badge.classList.remove('bump'), 200);
                }
                badge.innerText = `Lv.${level}`;
            }
        }

        // --- ğŸš€ æ ¸å¿ƒï¼šç¡¬æ ¸æ³¨å…¥åº•éƒ¨æŒ‰é’® (å–‡å­ + ä¹Œé¾Ÿ) ---
        function injectLogicButtons() {
            const boxes = document.querySelectorAll('.combo-box');
            boxes.forEach(box => {
                // æ¸…ç†æ—§çš„
                box.querySelectorAll('.combo-audio-btn, .btn-slow').forEach(b => b.remove());
                
                // 1. åˆ›å»ºæ™®é€šå–‡å­
                const btnNormal = document.createElement('button');
                btnNormal.className = 'combo-audio-btn';
                btnNormal.innerHTML = 'ğŸ”Š'; 
                btnNormal.style.zIndex = "10"; 
                // ç›´æ¥å†™å…¥å±æ€§ï¼Œå…‹éš†å…ç–«
                btnNormal.setAttribute('onclick', 'handleLogicClick(event, this, 1.0)'); 
                box.appendChild(btnNormal);

                // 2. åˆ›å»ºä¹Œé¾Ÿ (é¾Ÿé€Ÿ)
                const btnSlow = document.createElement('button');
                btnSlow.className = 'btn-slow';
                btnSlow.innerHTML = 'ğŸ¢'; 
                btnSlow.style.zIndex = "10"; 
                btnSlow.setAttribute('onclick', 'handleLogicClick(event, this, 0.6)'); 
                box.appendChild(btnSlow);
            });
        }

        // --- ğŸš€ å…¨å±€å¤„ç†å‡½æ•° (æ”¯æŒè¯­é€Ÿå‚æ•°) ---
        // å¿…é¡»æŒ‚åœ¨ window ä¸Šï¼Œç¡®ä¿ onclick å±æ€§æ‰¾å¾—åˆ°
        window.handleLogicClick = function(e, btn, rate) {
            e.stopPropagation();
            gainXP(1); // å¢åŠ ç»éªŒå€¼
            if(navigator.vibrate) navigator.vibrate(15);
            
            // ç‚¹å‡»åé¦ˆåŠ¨ç”»
            btn.style.transform = "scale(0.9)";
            setTimeout(() => btn.style.transform = "scale(1)", 150);

            const container = btn.closest('.combo-box');
            if (container) {
                const textEl = container.querySelector('.combo-text');
                if (textEl) {
                    speakDirect(textEl.innerText, null, rate);
                }
            }
        }

        // --- ğŸ” æ™ºèƒ½æœç´¢è¦†ç›– (Smart Keywords) ---
        function injectSmartKeywords() {
            // åŸºç¡€æ˜ å°„ (åŒ…å«ä½ è¦æ±‚çš„å†…æ€¥ã€å¤–å–ç­‰)
            const baseMap = {
                1: "neighbor hello hi greeting æ¬å®¶ è£…ä¿® æ–°æ¥ é™Œç”Ÿäºº é—®å€™",
                2: "map where lost direction è¿·è·¯ å¯¼èˆª åœ°å›¾ æ€ä¹ˆèµ° ä½ç½®",
                3: "toilet restroom battery charge urgent emergency å†…æ€¥ å•æ‰€ æ²¡ç”µ å……ç”µ å€Ÿç”¨ æ‹‰è‚šå­ å¤§å§¨å¦ˆ",
                4: "money bank cash deposit withdraw é“¶è¡Œ é’± ç°é‡‘ è½¬è´¦ å¼€æˆ· æ±‡ç‡",
                5: "pay bill cost credit card ç»“è´¦ ä¹°å• å¤šå°‘é’± åˆ·å¡ æ”¯ä»˜å®",
                6: "eat food drink menu spicy hungry ç‚¹é¤ åƒé¥­ èœå• å¿Œå£ å¤–å– æ‰“åŒ…",
                7: "treat split share dinner party èšé¤ è¯·å®¢ AAåˆ¶ å‡æ‘Š",
                8: "chat coffee long time contact å™æ—§ èŠå¤© å–èŒ¶ å¾®ä¿¡",
                9: "taxi uber ride airport address æ‰“è½¦ å¸æœº æœºåœº è½¦ç«™ èµ¶æ—¶é—´",
                10: "help sick pain doctor 911 æ•‘å‘½ ç–¼ åŒ»ç”Ÿ åŒ»é™¢ æŠ¥è­¦",
                11: "what pardon repeat understand å¬ä¸æ‡‚ ç¿»è¯‘ å†è¯´ä¸€é å•¥æ„æ€",
                12: "return refund exchange broken é€€è´§ é€€æ¬¾ æ¢è´§ åäº† è´¨é‡",
                13: "schedule time book reserve é¢„çº¦ æ—¶é—´ è®¢ä½ æ”¹æœŸ"
            };
            
            // æ‰©å±•æ˜ å°„ (ä» extraVocab é‡Œæå–ä¸­æ–‡)
            for (let u in extraVocab) {
                let keywords = baseMap[u] || "";
                for (let s in extraVocab[u]) {
                    extraVocab[u][s].forEach(item => {
                        keywords += " " + item.c + " " + item.e;
                    });
                }
                const card = document.getElementById(`u${u}`);
                if (card) {
                    // åˆå¹¶åŸæœ‰çš„å’Œæ–°çš„
                    const old = card.getAttribute('data-keywords') || "";
                    card.setAttribute('data-keywords', old + " " + keywords);
                }
            }
        }

        // --- åœºæ™¯æœç´¢å¼•å¯¼ (çº¯å®ç”¨å‘) ---
        function startSmartSearchAnimation() {
            const input = document.getElementById('searchBox');
            const hour = new Date().getHours();
            
            let prompts = [
                { t: "å®Œå…¨å¬ä¸æ‡‚å¯¹æ–¹è¯´ä»€ä¹ˆï¼Ÿ", k: "ç¿»è¯‘" },
                { t: "æ‰¾ä¸åˆ°æ´—æ‰‹é—´å¾ˆå°´å°¬ï¼Ÿ", k: "å†…æ€¥" }
            ];

            if (hour >= 5 && hour < 10) { 
                prompts.push({ t: "èµ¶æ—¶é—´ä¸Šç­æ€•è¿Ÿåˆ°ï¼Ÿ", k: "æ‰“è½¦" });
                prompts.push({ t: "åˆšæ¬æ¥è¿˜æ²¡è®¤è¯†é‚»å±…ï¼Ÿ", k: "é‚»å±…" });
            } else if (hour >= 11 && hour < 14) { 
                prompts.push({ t: "ä¸çŸ¥é“è¯¥æ€ä¹ˆç‚¹é¤ï¼Ÿ", k: "ç‚¹é¤" });
                prompts.push({ t: "å’ŒåŒäº‹åƒé¥­æ€•å†·åœºï¼Ÿ", k: "èŠå¤©" });
                prompts.push({ t: "ä¹°å•æ—¶æƒ³AAåˆ¶ï¼Ÿ", k: "AA" });
            } else if (hour >= 14 && hour < 18) { 
                prompts.push({ t: "ä¸‹ç­æƒ³å»å–æ¯å’–å•¡ï¼Ÿ", k: "å’–å•¡" });
                prompts.push({ t: "é“¶è¡ŒæŸœå‘˜æ²¡æœ‰ä¸­æ–‡æœåŠ¡ï¼Ÿ", k: "é“¶è¡Œ" });
                prompts.push({ t: "ä¹°çš„ä¸œè¥¿ä¸åˆé€‚æƒ³é€€ï¼Ÿ", k: "é€€è´§" });
            } else if (hour >= 18 && hour < 22) { 
                prompts.push({ t: "æ™šä¸Šèšä¼šæƒ³è¯·å®¢ï¼Ÿ", k: "ä¹°å•" });
                prompts.push({ t: "ä¸æƒ³åšé¥­æƒ³å«å¤–å–ï¼Ÿ", k: "å¤–å–" });
            } else { 
                prompts.push({ t: "åŠå¤œå›å®¶è¦æ‰“Uberï¼Ÿ", k: "æ‰“è½¦" });
                prompts.push({ t: "èº«ä½“ä¸èˆ’æœæƒ³çœ‹åŒ»ç”Ÿï¼Ÿ", k: "æ•‘å‘½" });
                prompts.push({ t: "é‡åˆ°ç´§æ€¥æƒ…å†µï¼Ÿ", k: "è­¦å¯Ÿ" });
            }

            prompts.sort(() => Math.random() - 0.5);
            let idx = 0;
            updatePlaceholder();

            setInterval(() => {
                if (document.activeElement === input && input.value !== "") return; 
                input.classList.add('fade-text');
                setTimeout(() => {
                    idx = (idx + 1) % prompts.length;
                    updatePlaceholder();
                    input.classList.remove('fade-text');
                }, 500); 
            }, 5000);

            function updatePlaceholder() {
                const item = prompts[idx];
                input.setAttribute('placeholder', `${item.t} æœ "${item.k}" è¯•è¯•...`);
            }
        }

        // ä¿®æ”¹ speakDirect æ”¯æŒè¯­é€Ÿ
        function speakDirect(text, callback, rate = 0.9) { 
            window.speechSynthesis.cancel(); 
            const hasEnglishContext = /[a-zA-Z]{2,}/.test(text); 
            const utterance = new SpeechSynthesisUtterance(text); 
            utterance.lang = hasEnglishContext ? 'en-US' : 'zh-CN'; 
            utterance.rate = rate; 
            if(callback) utterance.onend = callback; 
            window.speechSynthesis.speak(utterance); 
        }
        function speakWholeSentence(wordId,p,x){const wordEl=document.getElementById(wordId);if(wordEl)speakDirect(wordEl.parentElement.innerText);}

        function initSpeechRecognition() { if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) { const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition; recognition = new SpeechRecognition(); recognition.lang = 'en-US'; recognition.interimResults = false; recognition.maxAlternatives = 1; recognition.onresult = (e) => { console.log(e.results[0][0].transcript); }; } }
        function injectChatDOM() { const div = document.createElement('div'); div.id = 'chatOverlay'; div.className = 'chat-overlay'; div.innerHTML = `<div class="chat-header"><span>ğŸ¤– AI Oral Tutor</span><span onclick="toggleChat()" style="cursor:pointer;font-size:1.2em;">âœ•</span></div><div class="chat-body" id="chatBody"></div><div class="chat-footer"><button id="chatMicBtn" class="mic-wave" onclick="manualMicClick()">ğŸ™ï¸</button><button class="nav-btn" onclick="endChat(false)" style="background:#ff3b30;color:white;border:none;">End</button></div>`; document.body.appendChild(div); }
        function addUserMsg(text) { const b=document.getElementById('chatBody'); const d=document.createElement('div'); d.className='msg user'; d.innerText=text; b.appendChild(d); b.scrollTop=b.scrollHeight; }
        function startChatListening() { if (!recognition) return; if (!aiState.active) return; const btn = document.getElementById('chatMicBtn'); btn.classList.add('active'); try { recognition.start(); } catch(e) {} recognition.onresult = (event) => { const last = event.results.length - 1; const text = event.results[last][0].transcript; processAnswer(text); }; recognition.onend = () => { btn.classList.remove('active'); }; }
        function getFullChineseSentence(u, s, cnWord, suffix) { let cw = cnWord; let sfx = suffix || "ã€‚"; let full = ""; if(sfx === 'å—' || sfx === '?') sfx = "å—ï¼Ÿ"; switch(u) { case 1: full = (s===1) ? `å—¨ï¼Œæˆ‘æ˜¯${cw}ã€‚` : `æˆ‘ä½åœ¨${cw}ã€‚`; break; case 2: full = (s===1) ? `æ‰“æ‰°ä¸€ä¸‹ï¼Œæˆ‘åœ¨æ‰¾${cw}ã€‚` : `èƒ½å‘Šè¯‰æˆ‘${cw}${sfx}`; break; case 3: full = (s===1) ? `æˆ‘èƒ½å€Ÿç”¨ä¸€ä¸‹æ‚¨çš„${cw}${sfx}` : `çœŸçš„å¾ˆæœ‰${cw}ã€‚`; break; case 4: full = (s===1) ? `æˆ‘æƒ³${cw}ã€‚` : `è¿™æ˜¯æˆ‘çš„${cw}ã€‚`; break; case 5: full = (s===1) ? `æˆ‘æƒ³ç”¨${cw}æ”¯ä»˜ã€‚` : `ä½ ä»¬æä¾›${cw}${sfx}`; break; case 6: full = (s===1) ? `æˆ‘æƒ³è¦${cw}ã€‚` : `è¯·ä¸è¦${cw}ã€‚`; break; case 7: full = (s===1) ? `å’±ä»¬${cw}å§ã€‚` : `ä»Šå¤©${cw}ã€‚`; break; case 8: full = (s===1) ? `å¥½ä¹…ä¸è§ï¼${cw}æ€ä¹ˆæ ·ï¼Ÿ` : `æˆ‘ä»¬åº”è¯¥${cw}ã€‚`; break; case 9: full = (s===1) ? `æˆ‘è¦å»${cw}ã€‚` : `å°±åœ¨${cw}ä¸‹è½¦ã€‚`; break; case 10: full = (s===1) ? `æˆ‘éœ€è¦${cw}ã€‚` : `æˆ‘æ„Ÿåˆ°${cw}ã€‚`; break; case 11: full = (s===1) ? `èƒ½${cw}å—ï¼Ÿ` : `æˆ‘ä¸${cw}ã€‚`; break; case 12: full = (s===1) ? `æˆ‘æƒ³${cw}ã€‚` : `å®ƒ${cw}ã€‚`; break; case 13: full = (s===1) ? `æˆ‘æƒ³${cw}ã€‚` : `åœ¨${cw}ã€‚`; break; default: full = cw + sfx; } if(u===3 && s===2) { if(cw.includes('æ€¥')) full = "çœŸçš„å¾ˆç´§æ€¥ã€‚"; if(cw.includes('å¿«')) full = "ä¼šå¾ˆå¿«å°±å¥½ã€‚"; } return full; }
        function startAiSession() { aiState.active = true; aiState.score = 0; aiState.total = 0; document.getElementById('chatBody').innerHTML = ''; addBotMsg("Hi there! I'm your AI tutor. Want to practice English?", [{ text: "Yes, let's go!", action: askForScenario }, { text: "Not now", action: () => { toggleChat(); aiState.active = false; } }]); }
        function askForScenario() { addUserMsg("Yes, let's go!"); let ops = []; for(let i=1; i<=13; i++) { const c = document.getElementById(`u${i}`); if(c) { const name = c.getAttribute('data-name'); ops.push({ text: name, action: () => startUnitPractice(i) }); } } addBotMsg("Great! Which scenario do you want to practice?", ops); }
        function startUnitPractice(uid) { addUserMsg(`Unit ${uid}`); aiState.currentUnit = uid; aiState.currentStep = 1; addBotMsg("Awesome choice! Let's start!"); setTimeout(askQuestion, 1500); }
        function resetIdleTimer() { if(aiState.active) return; if(aiState.idleTimer) clearTimeout(aiState.idleTimer); aiState.idleTimer = setTimeout(triggerIdleAlert, 60000); }
        let idleLoopTimer = null;
        function triggerIdleAlert() { if(aiState.active) return; document.getElementById('robotBadge').style.display = 'block'; const bubble = document.getElementById('robotBubble'); if(bubble) { bubble.classList.add('visible'); triggerHaptic(); setTimeout(() => { bubble.classList.remove('visible'); idleLoopTimer = setTimeout(triggerIdleAlert, 60000); }, 10000); } }
        function addFloatingControls() { const c=document.querySelector('.float-controls'); const w=document.createElement('div'); w.style.position='relative'; const b=document.createElement('div'); b.id='robotBubble'; b.className='robot-speech-bubble'; b.innerText='å˜¿ï¼æƒ³ç»ƒç»ƒå£è¯­å—ï¼Ÿç‚¹æˆ‘ï¼'; w.appendChild(b); const btn=document.createElement('button'); btn.className='fab-robot'; btn.innerHTML='ğŸ¤–<div class="robot-badge" id="robotBadge"></div>'; btn.title="AI é™ªç»ƒ"; btn.onclick=()=>{ triggerHaptic(); resetIdleTimer(); toggleChat(); if(document.getElementById('chatBody').innerHTML.trim()==="") startAiSession(); }; w.appendChild(btn); c.insertBefore(w, c.firstChild); const t=document.createElement('button'); t.className='fab-tools'; t.innerHTML='ğŸ§°'; t.onclick=openToolbox; c.insertBefore(t, c.firstChild); }
        function toggleChat() { const el = document.getElementById('chatOverlay'); const isHidden = el.style.display === 'none' || el.style.display === ''; el.style.display = isHidden ? 'flex' : 'none'; document.getElementById('robotBadge').style.display = 'none'; if(isHidden) { const body = document.getElementById('chatBody'); body.scrollTop = body.scrollHeight; } }
        function injectToolboxDOM(){if(document.getElementById('toolOverlay'))return;const d=document.createElement('div');d.id='toolOverlay';d.className='tool-overlay';d.onclick=(e)=>{if(e.target===d)d.style.display='none';};d.innerHTML=`<div class="tool-card"><div class="tool-tabs"><div class="tool-tab active" onclick="switchTool(0)">ğŸŒ¡ï¸ æ¢ç®—</div><div class="tool-tab" onclick="switchTool(1)">ğŸ’µ å°è´¹</div><div class="tool-tab" onclick="switchTool(2)">ğŸ’¾ å¤‡ä»½</div></div><div class="tool-section active" id="tool-calc"><div class="calc-row"><input type="number" class="calc-input" id="inp-f" placeholder="Â°F" oninput="convert('f')"><span class="calc-label">Â°F</span><span class="calc-eq">â‡Œ</span><input type="number" class="calc-input" id="inp-c" placeholder="Â°C" oninput="convert('c')"><span class="calc-label">Â°C</span></div><div class="calc-row"><input type="number" class="calc-input" id="inp-lb" placeholder="lb" oninput="convert('lb')"><span class="calc-label">lb</span><span class="calc-eq">â‡Œ</span><input type="number" class="calc-input" id="inp-kg" placeholder="kg" oninput="convert('kg')"><span class="calc-label">kg</span></div><div class="calc-row"><input type="number" class="calc-input" id="inp-oz" placeholder="oz" oninput="convert('oz')"><span class="calc-label">oz</span><span class="calc-eq">â‡Œ</span><input type="number" class="calc-input" id="inp-ml" placeholder="ml" oninput="convert('ml')"><span class="calc-label">ml</span></div></div><div class="tool-section" id="tool-tip"><div class="calc-row" style="justify-content:center;"><span style="font-weight:bold;">æ¶ˆè´¹ $</span><input type="number" class="calc-input" id="inp-bill" placeholder="0.00" style="width:150px;" oninput="calcTip()"></div><div class="tip-grid"><div class="tip-box"><span class="tip-pct">15%</span><span class="tip-val" id="tip-15">$0</span></div><div class="tip-box"><span class="tip-pct">18%</span><span class="tip-val" id="tip-18">$0</span></div><div class="tip-box"><span class="tip-pct">20%</span><span class="tip-val" id="tip-20">$0</span></div></div></div><div class="tool-section" id="tool-backup" style="text-align:center;"><p style="color:var(--text-sub); font-size:0.9em; margin-bottom:20px;">æ¢æ‰‹æœºæˆ–æ¸…ç¼“å­˜å‰ï¼Œè¯·å…ˆå¯¼å‡ºå¤‡ä»½ã€‚</p><div style="display:flex; gap:15px; justify-content:center;"><button onclick="backupData()" style="padding:12px 20px; background:var(--primary); color:white; border:none; border-radius:12px; font-weight:bold;">ğŸ“¤ å¯¼å‡ºæ•°æ®</button><button onclick="restoreData()" style="padding:12px 20px; background:var(--display-area); color:var(--text-main); border:1px solid var(--border); border-radius:12px; font-weight:bold;">ğŸ“¥ æ¢å¤æ•°æ®</button></div></div></div>`;document.body.appendChild(d);}
        function switchTool(idx){triggerHaptic();document.querySelectorAll('.tool-tab').forEach((t,i)=>t.classList.toggle('active',i===idx));document.querySelectorAll('.tool-section').forEach((s,i)=>s.classList.toggle('active',i===idx));}
        function convert(t){const f=document.getElementById('inp-f'),c=document.getElementById('inp-c'),lb=document.getElementById('inp-lb'),kg=document.getElementById('inp-kg'),oz=document.getElementById('inp-oz'),ml=document.getElementById('inp-ml');if(t==='f')c.value=f.value?((f.value-32)*5/9).toFixed(1):'';if(t==='c')f.value=c.value?((c.value*9/5)+32).toFixed(1):'';if(t==='lb')kg.value=lb.value?(lb.value*0.453).toFixed(1):'';if(t==='kg')lb.value=kg.value?(kg.value/0.453).toFixed(1):'';if(t==='oz')ml.value=oz.value?(oz.value*29.57).toFixed(1):'';if(t==='ml')oz.value=ml.value?(ml.value/29.57).toFixed(1):'';}
        function calcTip(){const b=parseFloat(document.getElementById('inp-bill').value)||0;document.getElementById('tip-15').innerText='$'+(b*1.15).toFixed(2);document.getElementById('tip-18').innerText='$'+(b*1.18).toFixed(2);document.getElementById('tip-20').innerText='$'+(b*1.20).toFixed(2);}
        function openToolbox(){triggerHaptic();document.getElementById('toolOverlay').style.display='flex';}
        function closeToolbox(){document.getElementById('toolOverlay').style.display='none';}
        function initGlobalClickListeners() { document.body.addEventListener('click', function(e) { const comboBtn = e.target.closest('.combo-audio-btn'); if (comboBtn) { e.stopPropagation(); triggerHaptic(); const container = comboBtn.closest('.combo-box'); if (container) { const textEl = container.querySelector('.combo-text'); if (textEl) speakDirect(textEl.innerText); } return; } }); }
        function backupData() { triggerHaptic(); let backup = {}; for (let i = 0; i < localStorage.length; i++) { const key = localStorage.key(i); if (key.startsWith('custom_chips_') || key.startsWith('u') || key === 'unit_usage' || key === 'theme' || key === 'user_xp') { backup[key] = localStorage.getItem(key); } } const dataStr = JSON.stringify(backup); navigator.clipboard.writeText(dataStr).then(() => { alert("âœ… æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\nè¯·ç²˜è´´ä¿å­˜åˆ°å¤‡å¿˜å½•æˆ–å¾®ä¿¡ã€‚"); }).catch(err => { prompt("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š", dataStr); }); }
        function restoreData() { triggerHaptic(); const dataStr = prompt("è¯·ç²˜è´´ä¹‹å‰å¤‡ä»½çš„æ•°æ®å­—ç¬¦ä¸²ï¼š"); if (!dataStr) return; try { const backup = JSON.parse(dataStr); for (let key in backup) { localStorage.setItem(key, backup[key]); } alert("ğŸ‰ æ•°æ®æ¢å¤æˆåŠŸï¼é¡µé¢å°†åˆ·æ–°ã€‚"); location.reload(); } catch (e) { alert("âŒ æ•°æ®æ ¼å¼é”™è¯¯ï¼Œæ¢å¤å¤±è´¥ã€‚"); } }
        function injectSmartKeywords(){/*...*/}
        function injectShowCardDOM(){if(!document.getElementById('showCardOverlay')){const d=document.createElement('div');d.id='showCardOverlay';d.className='show-card-overlay';d.onclick=closeShowCard;d.innerHTML=`<div class="show-card-text" id="showCardEng"></div><div class="show-card-sub" id="showCardCn"></div><div class="show-card-hint">ç‚¹å‡»ä»»æ„å¤„å…³é—­</div>`;document.body.appendChild(d);}}
        function openShowCard(e,c){document.getElementById('showCardEng').innerText=e;document.getElementById('showCardCn').innerText=c;document.getElementById('showCardOverlay').style.display='flex';}
        function closeShowCard(){document.getElementById('showCardOverlay').style.display='none';}
        function showToast(m){let t=document.getElementById('speechToast');if(!t){t=document.createElement('div');t.id='speechToast';t.className='speech-result-toast';document.body.appendChild(t);}t.innerText=m;t.style.display='block';setTimeout(()=>{t.style.display='none';},3000);}
        function triggerHaptic(){if(navigator.vibrate)navigator.vibrate(15);}
        function initScrollHints(){const cards=document.querySelectorAll('.unit-card');cards.forEach(card=>{if(card.scrollHeight>card.clientHeight)card.querySelector('.scroll-hint')?.classList.add('visible');card.addEventListener('scroll',function(){this.querySelector('.scroll-hint')?.classList.remove('visible');});});}
        function dismissBubble(e){if(e){e.classList.add('fade-out');setTimeout(()=>{e.remove();},1000);}}
        function addCustomChip(u,s,p,x){triggerHaptic();const e=prompt("English:");if(!e)return;const c=prompt("Chinese:");if(!c)return;const d={unitNum:u,stepNum:s,eng:e,cn:c,prefix:p,suffix:x};const k=`custom_chips_u${u}_s${s}`;let l=JSON.parse(localStorage.getItem(k)||"[]");l.push(d);localStorage.setItem(k,JSON.stringify(l));renderAndClickChip(d,true);}
        function toggleEmergency(){triggerHaptic();document.getElementById('emergencyOverlay').classList.toggle('active');}
        function loadUsageData(){usageData=JSON.parse(localStorage.getItem('unit_usage')||"{}");}
        function incrementUsage(u){usageData[u]=(usageData[u]||0)+1;localStorage.setItem('unit_usage',JSON.stringify(usageData));}
        function checkMonthlyReport(){/*...*/ }
        function showMonthlySummary(m){/*...*/ }
        function startRandomDrill(){triggerHaptic();const u=Math.floor(Math.random()*13)+1;const c=document.getElementById(`u${u}`);if(!c){startRandomDrill();return;}document.getElementById('modalQuestion').innerText=c.querySelector('.unit-header').innerText;document.getElementById('randomModal').style.display='flex';currentRandomUnit=u;}
        function closeModal(id){document.getElementById(id).style.display='none';}
        function revealRandomAnswer(){closeModal('randomModal');scrollToUnit(`u${currentRandomUnit}`);}
        function scrollToUnit(id){document.getElementById(id)?.scrollIntoView({behavior:'smooth',block:'nearest',inline:'center'});}
        function toggleTheme(){triggerHaptic();const h=document.documentElement;const n=h.getAttribute('data-theme')==='light'?'dark':'light';h.setAttribute('data-theme',n);localStorage.setItem('theme',n);}
        function loadTheme(){const s=localStorage.getItem('theme');if(s)document.documentElement.setAttribute('data-theme',s);}
        function filterUnits(){const filter=document.getElementById('searchBox').value.toLowerCase();const cards=document.getElementsByClassName('unit-card');for(let card of cards){const text=card.innerText.toLowerCase();const keys=card.getAttribute('data-keywords')||"";card.style.display=(text.includes(filter)||keys.includes(filter))?"":"none";} document.getElementById('content-area').scrollTo(0,0);}
        function loadCustomChips(){for(let u=1;u<=13;u++)for(let s=1;s<=2;s++)JSON.parse(localStorage.getItem(`custom_chips_u${u}_s${s}`)||"[]").forEach(d=>renderAndClickChip(d,false));}
        function renderAndClickChip(d,t){const c=document.getElementById(`u${d.unitNum}-s${d.stepNum}-chips`);if(!c)return;const b=document.createElement('div');b.className='chip';b.innerText=d.eng;b.onclick=()=>{updateUnit(d.unitNum,d.stepNum,d.eng,d.cn,d.prefix,d.suffix,b);};const w=c.querySelector('.add-btn-wrapper');c.insertBefore(b,w||c.firstChild);if(t)b.click();}
        function updateCustomChipInStorage(d,n){const k=`custom_chips_u${d.unitNum}_s${d.stepNum}`;let l=JSON.parse(localStorage.getItem(k)||"[]");if(n==="")l=l.filter(i=>i.eng!==d.eng);else{const i=l.findIndex(x=>x.eng===d.eng);if(i>-1)l[i].eng=n;}localStorage.setItem(k,JSON.stringify(l));}
        function toggleQuizMode(){triggerHaptic();document.body.classList.toggle('quiz-mode');}
        function updateUnit(unitNum,stepNum,engWord,cnWord,prefixEng,suffixCn,element,playSound=true){triggerHaptic();incrementUsage(unitNum);const wordId=`u${unitNum}-s${stepNum}-word`;const displayEl=document.getElementById(wordId);if(displayEl)displayEl.innerText=engWord;const fullCn=getFullChineseSentence(unitNum,stepNum,cnWord,suffixCn);document.getElementById(`u${unitNum}-s${stepNum}-trans`).innerText=fullCn;let container=element.parentElement;container.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));if(element.classList.contains('chip'))element.classList.add('active');localStorage.setItem(`u${unitNum}-s${stepNum}`,JSON.stringify({engWord,cnWord,prefix:prefixEng,suffix:suffixCn}));if(playSound)speakDirect(engWord);}
        function restoreSelection(unitNum,stepNum){const savedData=localStorage.getItem(`u${unitNum}-s${stepNum}`);if(savedData){const data=JSON.parse(savedData);const container=document.getElementById(`u${unitNum}-s${stepNum}-chips`);if(container){const chips=container.querySelectorAll('.chip');for(let chip of chips){if(chip.innerText===data.engWord){updateUnit(unitNum,stepNum,data.engWord,data.cnWord,data.prefix,data.suffix,chip,false);break;}}}}}
        function speakWholeSentence(wordId,p,x){const wordEl=document.getElementById(wordId);if(wordEl)speakDirect(wordEl.parentElement.innerText);}
    </script>
</body>
</html>
