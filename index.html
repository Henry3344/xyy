<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Survival English Guide v25.0</title>
    <style>
        /* --- CSS å˜é‡ --- */
        :root {
            --bg-body: #f2f2f7;
            --bg-card: #ffffff;
            --text-main: #1c1c1e;
            --text-sub: #8e8e93;
            --primary: #007aff;
            --primary-light: #e5f1ff;
            --border: #c6c6c8;
            --chip-bg: #ffffff;
            --chip-border: #d1d1d6;
            --nav-bg: rgba(255,255,255,0.95);
            --shadow: rgba(0,0,0,0.08);
            --display-area: #f2f2f7;
            --danger: #ff3b30;
            --accent: #5856d6;
        }

        [data-theme="dark"] {
            --bg-body: #000000;
            --bg-card: #1c1c1e;
            --text-main: #ffffff;
            --text-sub: #aeaeb2;
            --primary: #0a84ff;
            --primary-light: #1c1c1e;
            --border: #38383a;
            --chip-bg: #2c2c2e;
            --chip-border: #3a3a3c;
            --nav-bg: rgba(28,28,30,0.95);
            --shadow: rgba(255,255,255,0.05);
            --display-area: #2c2c2e;
            --danger: #ff453a;
            --accent: #5e5ce6;
        }

        /* --- åŸºç¡€å¸ƒå±€ --- */
        html, body { height: 100%; overflow: hidden; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-color: var(--bg-body); 
            color: var(--text-main); 
            margin: 0; padding: 0;
            display: flex;
            flex-direction: column;
            transition: background 0.3s, color 0.3s; 
            -webkit-tap-highlight-color: transparent;
        }
        
        /* --- é¡¶éƒ¨æ§åˆ¶å° --- */
        .header-container { 
            flex: 0 0 auto;
            background: var(--nav-bg); 
            backdrop-filter: blur(15px); 
            z-index: 1000; 
            border-bottom: 1px solid var(--border); 
            box-shadow: 0 4px 15px var(--shadow); 
            padding-top: env(safe-area-inset-top);
        }
        
        .top-row { display: flex; align-items: center; justify-content: space-between; padding: 10px 15px; max-width: 650px; margin: 0 auto; }
        .app-title { font-size: 1.1em; font-weight: 800; color: var(--text-main); margin: 0; }
        .header-actions { display: flex; gap: 12px; }
        .icon-btn { background: none; border: 1px solid var(--border); color: var(--text-main); width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 1em; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .icon-btn.danger { border-color: var(--danger); color: var(--danger); font-weight: bold; }
        
        .search-row { padding: 0 15px 8px 15px; max-width: 650px; margin: 0 auto; }
        .search-input { width: 100%; padding: 8px 12px; border-radius: 10px; border: 1px solid var(--border); background: var(--bg-body); color: var(--text-main); font-size: 0.95em; box-sizing: border-box; outline: none; transition: border 0.2s; }
        .search-input:focus { border-color: var(--primary); }

        .nav-scroll { display: flex; overflow-x: auto; padding: 0 15px 10px 15px; gap: 8px; max-width: 650px; margin: 0 auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .nav-scroll::-webkit-scrollbar { display: none; }
        .nav-btn { flex: 0 0 auto; background: var(--primary-light); color: var(--primary); border: 1px solid transparent; padding: 5px 10px; border-radius: 14px; font-weight: 600; font-size: 0.8em; text-decoration: none; transition: all 0.2s; white-space: nowrap; cursor: pointer; }
        [data-theme="dark"] .nav-btn { border-color: var(--border); }
        .nav-btn.active-nav { background: var(--primary); color: white; }

        /* --- ä¸»å†…å®¹åŒº --- */
        #content-area {
            flex: 1;
            display: flex;
            overflow-x: auto;
            overflow-y: hidden;
            scroll-snap-type: x mandatory; 
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            padding: 15px 7.5vw; 
            gap: 15px;
            align-items: flex-start;
        }
        #content-area::-webkit-scrollbar { display: none; }

        /* --- å•å…ƒå¡ç‰‡ --- */
        .unit-card { 
            flex: 0 0 85vw; 
            max-width: 500px;
            background: var(--bg-card); 
            border-radius: 20px; 
            padding: 20px; 
            box-shadow: 0 8px 30px var(--shadow); 
            border: 1px solid var(--border); 
            scroll-snap-align: center; 
            scroll-snap-stop: always;
            box-sizing: border-box;
            height: 98%; 
            max-height: 85vh; 
            overflow-y: auto; 
            overflow-x: hidden;
            position: relative;
            transition: transform 0.2s;
            padding-bottom: 40px; /* ç•™å‡ºåº•éƒ¨ç©ºé—´ç»™æç¤ºè¯­ */
        }
        .unit-card::-webkit-scrollbar { display: none; }

        .unit-header { font-size: 1.3em; font-weight: 800; color: var(--primary); margin-bottom: 15px; border-bottom: 2px solid var(--display-area); padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .sort-rank { font-size: 0.6em; color: var(--text-sub); font-weight: normal; opacity: 0.5; background: var(--display-area); padding: 2px 6px; border-radius: 4px; }

        /* --- æ­¥éª¤åŒºåŸŸ --- */
        .step-container { margin-bottom: 20px; width: 100%; }
        .step-label { font-size: 0.75em; color: var(--text-sub); font-weight: 700; margin-bottom: 6px; display: block; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .pattern-box { 
            font-family: "Menlo", monospace; color: #d63031; background: #ffeaea; padding: 2px 6px; border-radius: 4px; font-size: 1em; margin-left: 5px; border: 1px solid #ffcccc; display: inline-block; margin-top: 4px; 
            white-space: normal; word-wrap: break-word; 
        }
        [data-theme="dark"] .pattern-box { background: #3e1a1a; border-color: #5c1e1e; color: #ff6b6b; }

        /* --- ä¸»å¥æ˜¾ç¤ºåŒº --- */
        .display-area { 
            background-color: var(--display-area); padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; gap: 10px; transition: background 0.3s; border: 1px solid var(--border); 
            width: 100%; box-sizing: border-box; 
        }
        .text-content { flex-grow: 1; min-width: 0; }
        .english-sentence { 
            font-size: 1.25em; font-weight: 600; line-height: 1.3; color: var(--text-main); margin-bottom: 4px; 
            white-space: normal; word-wrap: break-word; 
        }
        .highlight { color: var(--primary); text-decoration: underline; text-decoration-thickness: 3px; text-underline-offset: 4px; cursor: pointer; }
        .translation { color: var(--text-sub); font-size: 0.9em; white-space: normal; }
        
        /* --- æŒ‰é’® --- */
        .btn-audio { flex-shrink: 0; background: var(--bg-card); border: 1px solid var(--border); border-radius: 50%; width: 40px; height: 40px; min-width: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.1em; box-shadow: 0 2px 5px var(--shadow); color: var(--primary); }
        .btn-audio:active { transform: scale(0.92); }
        
        /* --- è¯æ±‡ç‚¹å‡»åŒº --- */
        .chips-container { display: flex; flex-wrap: wrap; gap: 8px; width: 100%; }
        .chip { 
            background: var(--chip-bg); border: 1px solid var(--chip-border); 
            padding: 6px 12px; border-radius: 16px; 
            font-size: 0.9em; cursor: pointer; font-weight: 600; color: var(--text-main); 
            transition: all 0.2s; user-select: none; 
            max-width: 100%; white-space: normal; word-wrap: break-word; 
        }
        .chip:hover { transform: translateY(-1px); border-color: var(--primary); }
        .chip.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 2px 8px rgba(0,122,255,0.3); transform: scale(1.02); }
        
        .add-btn-wrapper { position: relative; display: inline-block; vertical-align: middle; }
        .add-btn-wrapper.has-bubble { margin-bottom: 60px; display: block; width: 100%; } 
        
        .add-chip-btn { border: 1px dashed var(--text-sub); color: var(--text-sub); background: transparent; padding: 6px 10px; }
        
        /* æ°”æ³¡æç¤º (æ›´æ–°æ–‡æ¡ˆï¼ŒåŠ å®½) */
        .bubble-tip { 
            position: absolute; top: 45px; left: 50%; transform: translateX(-50%); 
            background: var(--danger); color: white; padding: 8px 12px; border-radius: 10px; 
            font-size: 0.7em; font-weight: bold; box-shadow: 0 4px 12px rgba(255, 59, 48, 0.4); 
            animation: bounce 1.5s infinite; z-index: 99; 
            width: 220px; /* åŠ å®½ä»¥å®¹çº³é•¿æ–‡æ¡ˆ */
            white-space: normal; text-align: center; line-height: 1.4; 
            opacity: 0.95; transition: opacity 1s ease;
            pointer-events: none;
        }
        .bubble-tip.fade-out { opacity: 0; }
        .bubble-tip::after { content: ''; position: absolute; bottom: 100%; left: 50%; margin-left: -6px; border-width: 6px; border-style: solid; border-color: transparent transparent var(--danger) transparent; }
        @keyframes bounce { 0%, 100% { transform: translateX(-50%) translateY(0); } 50% { transform: translateX(-50%) translateY(5px); } }

        /* --- åˆ†éš”çº¿ --- */
        .divider { height: 1px; background: var(--border); margin: 20px 0; border: none; }

        /* --- è¿æ‹›æ€»ç»“ --- */
        .combo-box { 
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 15px; border-radius: 16px; margin-top: 20px; position: relative; box-shadow: 0 8px 15px rgba(0,0,0,0.2); 
            width: 100%; box-sizing: border-box;
        }
        [data-theme="dark"] .combo-box { background: linear-gradient(135deg, #1c1c1e 0%, #2c2c2e 100%); border: 1px solid #38383a; }
        .combo-title { font-size: 0.8em; font-weight: bold; opacity: 0.8; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; color: #ecf0f1; }
        .combo-text { font-size: 1.1em; font-weight: 600; line-height: 1.4; padding-right: 45px; margin-bottom: 10px; transition: all 0.3s; white-space: normal; word-wrap: break-word; }
        .structure-box { background: rgba(255,255,255,0.1); padding: 8px; border-radius: 8px; font-size: 0.8em; color: #bdc3c7; border: 1px dashed rgba(255,255,255,0.3); transition: all 0.3s; white-space: normal; }
        .struct-tag { display: inline-block; background: #e67e22; color: white; padding: 1px 5px; border-radius: 3px; font-size: 0.85em; margin-right: 4px; font-weight: bold; margin-bottom: 4px; }
        .struct-arrow { margin: 0 4px; color: #ecf0f1; }
        .combo-audio-btn { position: absolute; top: 15px; right: 15px; background: #27ae60; border: none; color: white; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.1em; box-shadow: 0 4px 8px rgba(39, 174, 96, 0.4); }
        
        /* --- æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š æç¤º --- */
        .scroll-hint {
            position: absolute; bottom: 10px; left: 0; width: 100%;
            text-align: center; color: var(--primary); font-size: 0.8em; font-weight: 600;
            pointer-events: none; opacity: 0; transition: opacity 0.3s;
            animation: bounce-hint 2s infinite; z-index: 50;
        }
        .scroll-hint.visible { opacity: 0.8; }
        @keyframes bounce-hint { 
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 
            40% {transform: translateY(-5px);} 
            60% {transform: translateY(-3px);} 
        }

        /* --- æ‚¬æµ®æ§åˆ¶ç»„ --- */
        .float-controls { position: fixed; bottom: 40px; right: 20px; display: flex; flex-direction: column; gap: 15px; z-index: 2000; align-items: flex-end; }
        .fab-quiz { background: var(--danger); color: white; padding: 8px 16px; border-radius: 30px; font-weight: bold; box-shadow: 0 4px 15px rgba(255, 59, 48, 0.4); cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 6px; border: none; font-size: 0.85em; }
        .fab-quiz:active { transform: scale(0.95); }
        .fab-random { background: var(--accent); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2em; box-shadow: 0 4px 15px rgba(88, 86, 214, 0.4); border: none; cursor: pointer; }
        .quiz-active-text, body.quiz-mode .quiz-default-text { display: none; }
        body.quiz-mode .quiz-active-text { display: inline; }
        body.quiz-mode .fab-quiz { background: #34c759; box-shadow: 0 4px 15px rgba(52, 199, 89, 0.4); }

        /* --- ç‰¹è®­æ¨¡å¼ --- */
        body.quiz-mode .english-sentence { color: transparent !important; text-shadow: 0 0 13px rgba(128,128,128,0.5); user-select: none; }
        body.quiz-mode .english-sentence:active { color: var(--text-main) !important; text-shadow: none; }
        body.quiz-mode .pattern-box { color: transparent !important; background-color: var(--border); border-color: var(--border); user-select: none; }
        body.quiz-mode .pattern-box:active { color: #d63031 !important; background-color: #ffeaea; }
        body.quiz-mode .combo-text { color: transparent !important; text-shadow: 0 0 10px rgba(255,255,255,0.4); user-select: none; background: rgba(255,255,255,0.1); border-radius: 4px; }
        body.quiz-mode .combo-text:active { color: white !important; text-shadow: none; background: none; }
        body.quiz-mode .structure-box { color: transparent !important; text-shadow: 0 0 8px rgba(255,255,255,0.5); user-select: none; }
        body.quiz-mode .structure-box * { opacity: 0; }
        body.quiz-mode .structure-box:active { color: #bdc3c7 !important; text-shadow: none; }
        body.quiz-mode .structure-box:active * { opacity: 1; }

        /* --- åº”æ€¥æ¨¡å¼ Overlay --- */
        .emergency-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: none; flex-direction: column; padding: 20px; box-sizing: border-box; }
        .emergency-overlay.active { display: flex; }
        .emergency-close { position: absolute; top: 20px; right: 20px; color: white; font-size: 2em; cursor: pointer; padding: 10px; }
        .emergency-card { flex: 1; display: flex; align-items: center; justify-content: center; text-align: center; border-bottom: 1px solid #333; cursor: pointer; }
        .emergency-text { font-size: 2.2em; color: white; font-weight: bold; line-height: 1.2; text-transform: uppercase; margin-bottom: 10px; }
        .emergency-sub { font-size: 1.2em; color: #aaa; }

        /* --- å¼¹çª—é€šç”¨ --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 5000; display: none; align-items: center; justify-content: center; }
        .modal-card { background: var(--bg-card); width: 85%; max-width: 400px; padding: 25px; border-radius: 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 1px solid var(--border); animation: popIn 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .modal-title { font-size: 1.2em; font-weight: bold; color: var(--text-sub); margin-bottom: 20px; text-transform: uppercase; }
        .modal-content-text { font-size: 1.2em; color: var(--text-main); margin-bottom: 30px; line-height: 1.5; }
        .modal-actions { display: flex; gap: 10px; justify-content: center; }
        .modal-btn { padding: 8px 16px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; font-size: 1em; }
        .btn-reveal { background: var(--primary); color: white; }
        .btn-close { background: var(--border); color: var(--text-main); }

        /* åº•éƒ¨ç‰ˆæƒ - æç®€æçª„ç‰ˆ */
        .fixed-footer { 
            flex: 0 0 auto;
            text-align: center; color: var(--text-sub); font-size: 0.6em; 
            padding: 3px 0; 
            border-top: 1px solid var(--border); 
            background: var(--bg-body);
            opacity: 0.5;
        }
    </style>
</head>
<body>

    <div class="header-container" id="mainHeader">
        <div class="top-row">
            <div class="app-title">ğŸ‡ºğŸ‡¸ Survival English Guide</div>
            <div class="header-actions">
                <button class="icon-btn danger" onclick="toggleEmergency()" title="åº”æ€¥æ¨¡å¼">âš¡</button>
                <button class="icon-btn" onclick="toggleTheme()" title="åˆ‡æ¢æ¨¡å¼">ğŸŒ—</button>
            </div>
        </div>
        
        <div class="search-row">
            <input type="text" class="search-input" id="searchBox" placeholder="ğŸ” æœç´¢åœºæ™¯ (å¦‚: é€€è´§, coffee...)" onkeyup="filterUnits()">
        </div>

        <div class="nav-scroll">
            <a onclick="scrollToUnit('u1')" class="nav-btn">é‚»å±…</a>
            <a onclick="scrollToUnit('u2')" class="nav-btn">ä½ç½®</a>
            <a onclick="scrollToUnit('u3')" class="nav-btn">æ´—æ‰‹é—´</a>
            <a onclick="scrollToUnit('u4')" class="nav-btn">é“¶è¡Œ</a>
            <a onclick="scrollToUnit('u5')" class="nav-btn">ç»“è´¦</a>
            <a onclick="scrollToUnit('u6')" class="nav-btn">ç‚¹é¤</a>
            <a onclick="scrollToUnit('u7')" class="nav-btn">èšé¤</a>
            <a onclick="scrollToUnit('u8')" class="nav-btn">å™æ—§</a>
            <a onclick="scrollToUnit('u9')" class="nav-btn">æ‰“è½¦</a>
            <a onclick="scrollToUnit('u10')" class="nav-btn">æ€¥æ•‘</a>
            <a onclick="scrollToUnit('u11')" class="nav-btn">æ²¡å¬æ‡‚</a>
            <a onclick="scrollToUnit('u12')" class="nav-btn">é€€è´§</a>
            <a onclick="scrollToUnit('u13')" class="nav-btn">é¢„çº¦</a>
        </div>
    </div>

    <div class="emergency-overlay" id="emergencyOverlay">
        <div class="emergency-close" onclick="toggleEmergency()">âœ•</div>
        <div class="emergency-card" onclick="speakDirect('I need help! Please call 911.')">
            <div>
                <div class="emergency-text" style="color: #ff3b30;">I NEED HELP!<br>CALL 911</div>
                <div class="emergency-sub">æ•‘å‘½ï¼è¯·æ‰“911</div>
            </div>
        </div>
        <div class="emergency-card" onclick="speakDirect('I do not speak English. Please use a translation app.')">
            <div>
                <div class="emergency-text">I DON'T SPEAK ENGLISH</div>
                <div class="emergency-sub">æˆ‘ä¸ä¼šè‹±è¯­ (è¯·ç”¨ç¿»è¯‘è½¯ä»¶)</div>
            </div>
        </div>
        <div class="emergency-card" onclick="speakDirect('I am lost. Can you help me?')">
            <div>
                <div class="emergency-text">I AM LOST<br>CAN YOU HELP?</div>
                <div class="emergency-sub">æˆ‘è¿·è·¯äº†ï¼Œèƒ½å¸®æˆ‘å—ï¼Ÿ</div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="randomModal">
        <div class="modal-card">
            <div class="modal-title">ğŸ² éšæœºåœºæ™¯æŒ‘æˆ˜</div>
            <div class="modal-content-text" id="modalQuestion" style="font-weight:bold; font-size: 1.4em;">...</div>
            <div class="modal-actions">
                <button class="modal-btn btn-close" onclick="closeModal('randomModal')">å…³é—­</button>
                <button class="modal-btn btn-reveal" onclick="revealRandomAnswer()">æŸ¥çœ‹ç­”æ¡ˆ</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="reportModal">
        <div class="modal-card">
            <div class="modal-title">ğŸ“… æœˆåº¦æš–å¿ƒå°ç»“</div>
            <div class="modal-content-text" id="reportContent" style="text-align: left; font-size: 1em;">...</div>
